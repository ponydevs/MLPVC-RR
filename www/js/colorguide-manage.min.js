DocReady.push(function(){"use strict";function e(e){return $.mk("span").attr({"class":"tag id-"+e.tid+(e.type?" typ-"+e.type:"")+(e.synonym_of?" synonym":""),title:e.title}).text(e.name)}function t(e,t,a){var n="Create new tag",r=e.closest(".tags"),o=r.closest("[id^=p]"),s=o.attr("id").substring(1),l=m?$content.children("h1").text():r.siblings("strong").text().trim();$.Dialog.request(n,b.clone(!0,!0),"edit-tag","Create",function(e){e.children(".edit-only").replaceWith($.mk("label").append($.mk("input").attr({type:"checkbox",name:"addto"}).val(s).prop("checked","string"==typeof t),document.createTextNode(' Add this tag to the appearance "'+l+'" after creation'))),"string"==typeof a&&"undefined"!=typeof c[a]&&e.find("input[name=type][value="+a+"]").prop("checked",!0).trigger("change"),"string"==typeof t&&e.find("input[name=name]").val(t),e.on("submit",function(t){t.preventDefault();var a=e.mkData();$.Dialog.wait(!1,"Creating tag"),$.post("/colorguide/maketag"+g,a,$.mkAjaxHandler(function(){return this.status?(this.tags&&(r.children("[data-hasqtip]").qtip("destroy",!0),r.html(this.tags),window.tooltips(),i()),void $.Dialog.close()):$.Dialog.fail(!1,this.message)}))})})}function a(e,t){var a=this;if("undefined"!=typeof t){var n;if(t instanceof jQuery){var r=t.attr("id").substring(2);n=t.parents("[id^=p]").attr("id").substring(1)}else n=t}$.Dialog.request(e,D.clone(!0,!0),"cg-editor","Save",function(e){var o=e.find("input[name=label]"),s=e.find("input[name=major]"),l=e.find("input[name=reason]"),c="object"==typeof a&&a.label&&a.Colors;c&&(o.val(a.label),e.data("color_values",a.Colors).trigger("render-color-inputs")),e.on("submit",function(a){a.preventDefault();try{e.trigger("save-color-inputs",[!0])}catch(p){if(!(p instanceof h))throw p;var d=e.find(".clrs").data("editor");return d.gotoLine(p.lineNumber),d.navigateLineEnd(),$.Dialog.fail(!1,p.message),void d.focus()}var u={label:o.val(),Colors:e.data("color_values")};return c||(u.ponyid=n),0===u.Colors.length?$.Dialog.fail(!1,"You need to have at least 1 valid color"):(u.Colors=JSON.stringify(u.Colors),s.is(":checked")&&(u.major=!0,u.reason=l.val()),m&&(u.APPEARANCE_PAGE=!0),$.Dialog.wait(!1,"Saving changes"),void $.post("/colorguide/"+(c?"set":"make")+"cg"+(c?"/"+r:"")+g,u,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);if(this.cg||this.cgs){var e=$("#p"+n);if(this.cg?(t.children("[data-hasqtip]").qtip("destroy",!0),t.html(this.cg),this.update&&t.parents("li").find(".update").html(this.update)):this.cgs&&(this.update&&e.find(".update").html(this.update),e.find("ul.colors").html(this.cgs)),!m&&this.notes){var a=e.find(".notes");try{a.find(".cm-direction").qtip("destroy",!0)}catch(r){}a.html(this.notes)}if(window.tooltips(),i(),this.update&&window.updateTimes(),m&&this.cm_img){$.Dialog.success(!1,"Color group updated"),$.Dialog.wait(!1,"Updating cutie mark orientation image");var o=new Image;o.src=this.cm_img,$(o).on("load error",function(){$("#pony-cm").backgroundImageUrl(o.src),$.Dialog.close()})}else $.Dialog.close()}else $.Dialog.close()})))})})}function i(){q.children("span:not(.ctxmenu-bound)").ctxmenu([{text:"Edit tag",icon:"pencil",click:function(){var e=$(this),t=e.text().trim(),a=e.attr("class").match(/id-(\d+)(?:\s|$)/)[1],i="Editing tag: "+t;$.Dialog.wait(i,"Retrieveing tag details from server"),$.post("/colorguide/gettag/"+a+g,$.mkAjaxHandler(function(){var e=this;this.status?$.Dialog.request(i,b.clone(!0,!0).data("tag",e),"edit-tag","Save",function(t){t.find("input[name=type][value="+e.type+"]").prop("checked",!0),t.find("input[type=text][name], textarea[name]").each(function(){var t=$(this);t.val(e[t.attr("name")])}),t.on("submit",function(e){e.preventDefault();var i=t.mkData();$.Dialog.wait(!1,"Saving changes"),$.post("/colorguide/settag/"+a+g,i,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=this,t=$(".id-"+e.tid);t.qtip("destroy",!0),e.title?t.attr("title",e.title):t.removeAttr("title"),t.text(e.name).data("ctxmenu-items").eq(0).text("Tag: "+e.name),t.each(function(){this.className=this.className.replace(/typ-[a-z]+/,e.type?"typ-"+e.type:""),$(this)[e.synonym_of?"addClass":"removeClass"]("synonym").parent().reorderTags()}),window.tooltips(),$.Dialog.close()}))})}):$.Dialog.fail(i,this.message)}))}},{text:"Remove tag",icon:"minus",click:function(){var e=$(this),t=e.attr("class").match(/id-(\d+)(?:\s|$)/);if(!t)return!1;t=t[1];var a=e.closest("[id^=p]").attr("id").replace(/\D/g,""),i=e.text().trim(),n="Remove tag: "+i;$.Dialog.confirm(n,"The tag <strong>"+i+"</strong> will be removed from this appearance.<br>Are you sure?",["Remove it","Nope"],function(i){if(i){var r={tag:t};$.Dialog.wait(n,"Removing tag"),m&&(r.APPEARANCE_PAGE=!0),$.post("/colorguide/untag/"+a+g,r,$.mkAjaxHandler(function(){return this.status?(this.needupdate===!0&&o.html(this.eps).parent()[this.eps.length?"show":"hide"](),e.qtip("destroy",!0),e.remove(),void $.Dialog.close()):$.Dialog.fail(n,this.message)}))}})}},{text:"Delete tag",icon:"trash",click:function(){var e=$(this),t=e.text().trim(),a=e.attr("class").match(/id-(\d+)(?:\s|$)/)[1],i="Detele tag: "+t;$.Dialog.confirm(i,"Deleting this tag will also remove it from every appearance where it's been used.<br>Are you sure?",["Delete it","Nope"],function(e){if(e){var t={};m&&(t.APPEARANCE_PAGE=!0),function n(e){$.Dialog.wait(i,"Sending removal request"),$.post("/colorguide/deltag/"+a+g,e,$.mkAjaxHandler(function(){if(this.status){this.needupdate===!0&&o.html(this.eps).parent()[this.eps.length?"show":"hide"]();var t=$(".id-"+a);t.qtip("destroy",!0),t.remove(),$.Dialog.close()}else this.confirm?$.Dialog.confirm(!1,this.message,["NUKE TAG","Nevermind"],function(t){t&&(e.sanitycheck=!0,n(e))}):$.Dialog.fail(i,this.message)}))}(t)}})}},$.ctxmenu.separator,{text:"Create new tag",icon:"plus",click:function(){$.ctxmenu.triggerItem($(this).parent(),1)}}],function(e){return"Tag: "+e.text().trim()});var e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"/colorguide/gettags?s=%QUERY",wildcard:"%QUERY"}}),n=[Key.Enter,Key.Comma];q.children(".addtag").each(function(){var a=$(this),r=a.closest("[id^=p]").attr("id").substring(1);a.typeahead(null,{name:"tags",display:"name",source:e,templates:{suggestion:Handlebars.compile('<span class="tag id-{{tid}} {{type}} {{#if synonym_of}}synonym{{else}}monospace{{/if}}">{{name}} <span class="uses">{{#if synonym_of}}<span class="typcn typcn-flow-children"></span>{{synonym_target}}{{else}}{{uses}}{{/if}}</span></span>')}}),a.on("keydown",function(e){if(-1!==n.indexOf(e.keyCode)){e.preventDefault();var s=a.val().trim(),l=a.parents(".tags"),c=l.children(".tag"),p="Adding tag: "+s;if(c.filter(function(){return this.innerHTML.trim()===s}).length>0)return $.Dialog.fail(p,"This appearance already has this tag");$.Dialog.setFocusedElement(a.attr("disabled",!0)),a.parent().addClass("loading");var d={tag_name:s};m&&(d.APPEARANCE_PAGE=!0),$.post("/colorguide/tag/"+r+g,d,$.mkAjaxHandler(function(){if(a.removeAttr("disabled").parent().removeClass("loading"),this.status)this.needupdate===!0&&o.html(this.eps).parent().show(),l.children("[data-hasqtip]").qtip("destroy",!0),l.children(".tag").remove(),l.append($(this.tags).filter("span")),window.tooltips(),i(),a.typeahead("val","").focus();else{if("string"==typeof this.cancreate){var e=this.cancreate,n=this.typehint;return p=p.replace(s,e),$.Dialog.confirm(p,this.message,function(i){i&&t(a,e,n)})}$.Dialog.fail(p,this.message)}}))}}),a.nextAll(".tt-menu").on("click",".tag",function(){a.trigger({type:"keydown",keyCode:13})})}),r=$("ul.colors").attr("data-color",l),r.filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Re-order "+l+" groups",icon:"arrow-unsorted",click:function(){var e=$(this),t=e.closest("[id^=p]"),a=t.attr("id").substring(1),n=m?$content.children("h1").text():t.children().last().children("strong").text().trim(),r="Re-order "+l+" groups on appearance: "+n;$.Dialog.wait(r,"Retrieving color group list from server"),$.post("/colorguide/getcgs/"+a+g,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(this.message);var t=x.clone(),n=$.mk("ol");$.each(this.cgs,function(e,t){n.append($.mk("li").attr("data-id",t.groupid).text(t.label))}),$.mk("div").attr("class","cgs").append('<p class="align-center">Drag to re-arrange</p>',n).prependTo(t),new Sortable(n.get(0),{ghostClass:"moving",scroll:!1,animation:150}),$.Dialog.request(r,t,"cg-reorder","Save",function(t){t.on("submit",function(n){n.preventDefault();var r={cgs:[]},o=t.children(".cgs");return o.length?(o.find("ol").children().each(function(){r.cgs.push($(this).attr("data-id"))}),r.cgs=r.cgs.join(","),$.Dialog.wait(!1,"Saving changes"),m&&(r.APPEARANCE_PAGE=!0),void $.post("/colorguide/setcgs/"+a+g,r,$.mkAjaxHandler(function(){return this.status?(e.html(this.cgs),window.tooltips(),i(),void $.Dialog.close()):$.Dialog.fail(null,this.message)}))):$.Dialog.fail(!1,"There are no color groups to re-order")})})}))}},{text:"Create new group",icon:"folder-add",click:function(){a("Create "+l+" group",$(this).closest("[id^=p]").attr("id").substring(1))}},{text:"Apply template (if empty)",icon:"document-add",click:function(){var e=$(this).closest("[id^=p]").attr("id").substring(1);$.Dialog.confirm("Apply template on appearance","Add common color groups to this appearance?<br>Note: This will only work if there are no color groups currently present.",function(t){t&&($.Dialog.wait(!1,"Applying template"),$.post("/colorguide/applytemplate/"+e+g,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var t=$("#p"+e);t.find("ul.colors").html(this.cgs),window.tooltips(),i(),$.Dialog.close()})))})}}],s+" groups"),r.children("li").filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Edit "+l+" group",icon:"pencil",click:function(){var e=$(this),t=e.closest("li"),i=t.attr("id").substring(2),n=e.children().first().text().replace(/:\s?$/,""),r="Editing "+l+" group: "+n;$.Dialog.wait(r,"Retrieving "+l+" group details from server"),$.post("/colorguide/getcg/"+i+g,$.mkAjaxHandler(function(){return this.status?void a.call(this,r,t):$.Dialog.fail(r,this.message)}))}},{text:"Delete "+l+" group",icon:"trash",click:function(){var e=$(this).closest("li"),t=e.attr("id").substring(2),a=e.children().first().text().replace(/:\s?$/,""),i="Delete "+l+" group: "+a;$.Dialog.confirm(i,"By deleting this "+l+" group, all "+l+"s within will be removed too.<br>Are you sure?",function(a){a&&($.Dialog.wait(i,"Sending removal request"),$.post("/colorguide/delcg/"+t+g,$.mkAjaxHandler(function(){this.status?(e.children("[data-hasqtip]").qtip("destroy",!0),e.remove(),$.Dialog.close()):$.Dialog.fail(i,this.message)})))})}},$.ctxmenu.separator,{text:"Re-order "+l+" groups",icon:"arrow-unsorted",click:function(){$.ctxmenu.triggerItem($(this).parent(),1)}},{text:"Create new group",icon:"folder-add",click:function(){$.ctxmenu.triggerItem($(this).parent(),2)}}],function(e){return s+" group: "+e.children().first().text().trim().replace(":","")});var c=r.children("li").find(".valid-color");$.ctxmenu.addItems(c.filter(".ctxmenu-bound"),$.ctxmenu.separator,{text:"Edit "+l+" group",icon:"pencil",click:function(){$.ctxmenu.triggerItem($(this).parent().closest(".ctxmenu-bound"),1)}},{text:"Delete "+l+" group",icon:"trash",click:function(){$.ctxmenu.triggerItem($(this).parent().closest(".ctxmenu-bound"),2)}},$.ctxmenu.separator,{text:"Re-order "+l+" groups",icon:"arrow-unsorted",click:function(){$.ctxmenu.triggerItem($(this).parent().closest(".ctxmenu-bound"),3)}},{text:"Create new group",icon:"folder-add",click:function(){$.ctxmenu.triggerItem($(this).parent().closest(".ctxmenu-bound"),4)}}),$(".upload-wrap").filter(":not(.ctxmenu-bound)").each(function(){var e=$(this),t=e.closest("li");t.length||(t=$content.children("[id^=p]"));var a=t.attr("id").substring(1);!function(e,t){var a,i,n=function(){a=e.find("img").attr("src"),i=-1===a.indexOf("blank-pixel.png"),e[i?"removeClass":"addClass"]("nosprite"),$.ctxmenu.setDefault(e,i?1:3)};e.uploadZone({requestKey:"sprite",title:"Upload sprite",accept:"image/png",target:"/colorguide/setsprite/"+t}).on("uz-uploadstart",function(){$.Dialog.close()}).on("uz-uploadfinish",function(){n()}).ctxmenu([{text:"Open image in new tab",icon:"arrow-forward",attr:{href:e.find("img").attr("src"),target:"_blank"}},{text:"Copy image URL",icon:"clipboard",click:function(){$.copy($.urlToAbsolute(e.find("img").attr("src")))}},{text:"Upload new sprite",icon:"upload",click:function(){var a="Upload sprite image",i=e.find('input[type="file"]');$.Dialog.request(a,f.clone(),"sprite-img","Download image",function(e){var n=e.find("input[name=image_url]");e.find("a").on("click",function(e){e.preventDefault(),e.stopPropagation(),i.trigger("click",[!0])}),e.on("submit",function(e){e.preventDefault();var r=n.val();$.Dialog.wait(a,"Downloading external image to the server"),$.post("/colorguide/setsprite/"+t+g,{image_url:r},$.mkAjaxHandler(function(){this.status?i.trigger("set-image",[this.path]):$.Dialog.fail(a,this.message)}))})})}},{text:"Remove sprite image",icon:"times",click:function(){$.Dialog.confirm("Remove sprite image","Are you sure you want to <strong>permanently delete</strong> the sprite image from the server?",["Wipe it","Nope"],function(a){a&&($.Dialog.wait(!1,"Removing image"),$.post("/colorguide/delsprite/"+t,$.mkAjaxHandler(function(){return this.status?(e.find("img").attr("src",this.sprite),n(),void $.Dialog.close()):$.Dialog.fail(!1,this.message)})))})}}],"Sprite image").attr("title",d?" ":"").on("click",function(t,a){return a===!0?!0:(t.preventDefault(),void $.ctxmenu.runDefault(e))}),n()}(e,a)})}function n(){$("button.edit").on("click",function(){var e=$(this),t=e.closest("[id^=p]"),a=t.attr("id").substring(1),i=m?$content.children("h1").text():e.parent().text().trim(),n="Editing appearance: "+i;$.Dialog.wait(n,"Retrieving appearance details from server"),$.post("/colorguide/get/"+a+g,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var t=this;t.ponyID=a,y(e,n,t)}))}).next(".delete").on("click",function(){var e=$(this),t=e.closest("[id^=p]"),a=t.attr("id").substring(1),i=m?$content.children("h1").text():e.parent().text().trim(),n="Deleting appearance: "+i;$.Dialog.confirm(n,"Deleting this appearance will remove <strong>ALL</strong> of its color groups, the colors within them, and the sprite file, if any.<br>Delete anyway?",function(e){e&&($.Dialog.wait(n,"Sending removal request"),$.post("/colorguide/delete/"+a+g,$.mkAjaxHandler(function(){if(this.status){t.remove(),$.Dialog.success(n,this.message);var e=window.location.pathname;0===v.children().length&&(e=e.replace(/(\d+)$/,function(e){return e>1?e-1:e})),m?($.Dialog.wait("Navigation","Loading page 1"),HandleNav("/colorguide/1",function(){$.Dialog.close()})):$.toPage(e,!0,!0)}else $.Dialog.fail(n,this.message)})))})}),q=$(".tags").ctxmenu([{text:"Create new tag",icon:"plus",click:function(){t($(this))}}],"Tags"),i()}var r,o,s=window.Color,l=window.color,c=window.TAG_TYPES_ASSOC,p=window.HEX_COLOR_PATTERN,d="WebkitAppearance"in document.documentElement.style,u=window.EQG,g=u?"?eqg":"",m=!!window.AppearancePage,h=function(e,t,a){this.message="Parse error on line "+t+' (shown below)<pre style="font-size:16px"><code>'+e.replace(/</g,"&lt;")+"</code></pre>"+(a&&!a[2]?"The color name is missing from this line.":"Please check for any errors before continuing."),this.lineNumber=t},f=$.mk("form").attr("id","sprite-img").html('<p class="align-center"><a href="#upload">Click here to upload a file</a> (max. '+window.MAX_SIZE+') or enter a URL below.</p><label><input type="text" name="image_url" placeholder="External image URL" required></label><p class="align-center">The URL will be checked against the supported provider list, and if an image is found, it\'ll be downloaded to the server and set as this appearance\'s sprite image.</p>');m&&(o=$("#ep-appearances").children("p")),$.fn.reorderTags=function(){return this.each(function(){$(this).children(".tag").sort(function(e,t){var a=/^.*typ-([a-z]+).*$/;return e=[e.className.replace(a,"$1"),e.innerHTML.trim()],t=[t.className.replace(a,"$1"),t.innerHTML.trim()],e[0]===t[0]?e[1].localeCompare(t[1]):e[0].localeCompare(t[0])}).appendTo(this)})};var v=$(".appearance-list"),k=$.mk("form").attr("id","pony-editor").append($.mk("label").append("<span>Name (4-70 chars.)</span>",$.mk("input").attr({name:"label",placeholder:"Enter a name",pattern:PRINTABLE_ASCII_REGEX.replace("+","{4,70}"),required:!0,maxlength:70})),$.mk("label").append("<span>Additional notes (1000 chars. max, optional)</span>",$.mk("textarea").attr({name:"notes",maxlength:1e3})),$.mk("label").append("<span>Link to cutie mark (optional)</span>",$.mk("input").attr({name:"cm_favme",placeholder:"DeviantArt submission URL"}).on("change blur paste keyup",function(){var e=0===this.value.trim().length,t=$(this).parent().next();t.find("input").attr("disabled",e),t.next().find("input").attr("disabled",e)})),$.mk("div").attr("class","align-center").append("<p>Cutie mark orientation</p>",$.mk("div").attr("class","radio-group").append($.mk("label").append($.mk("input").attr({type:"radio",name:"cm_dir",value:"ht",required:!0}),"<span>Head-Tail</span>"),$.mk("label").append($.mk("input").attr({type:"radio",name:"cm_dir",value:"th",required:!0}),"<span>Tail-Head</span>"))),$.mk("label").append("<span>Link to CM preview image (optional)</span>",$.mk("input").attr({name:"cm_preview",placeholder:"Separate preview image"})),'<p class="notice info">The preview of the linked CM above will be used if the preview field is left empty.</p>'),y=function(e,t,a){var i,n=!!a,r=e.parents("[id^=p]"),o=r.find(".notes");if(m){if(!n)return;i=$content.children("h1")}else i=e.parent();$.Dialog.request(t,k.clone(!0,!0),"pony-editor","Save",function(e){if(n){e.find("input[name=label]").val(a.label);var r=e.find("textarea");r.val(a.notes),0===parseInt(a.ponyID,10)&&r.removeAttr("maxlength");var s=e.find("input[name=cm_favme]");a.cm_favme&&s.val(a.cm_favme),s.triggerHandler("change"),a.cm_preview&&e.find("input[name=cm_preview]").val(a.cm_preview),a.cm_dir&&e.find("input[name=cm_dir][value="+a.cm_dir+"]").prop("checked",!0),e.append($.mk("div").attr("class","align-center").append($.mk("button").attr("class","blue typcn typcn-image").text("Update rendered image").on("click",function(e){e.preventDefault(),$.Dialog.close(),$.Dialog.wait("Clear appearance image cache","Clearing cache"),$.post("/colorguide/clearrendercache/"+a.ponyID,$.mkAjaxHandler(function(){return this.status?void $.Dialog.success(!1,this.message,!0):$.Dialog.fail(!1,this.message)}))})))}else e.append($.mk("label").append($.mk("input").attr({type:"checkbox",name:"template"})," Pre-fill with common color groups"));e.on("submit",function(r){r.preventDefault();var s=e.mkData();$.Dialog.wait(!1,"Saving changes"),m&&(s.APPEARANCE_PAGE=!0),$.post("/colorguide/"+(n?"set/"+a.ponyID:"make")+g,s,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);if(n)m?($.Dialog.wait(!1,"Reloading page",!0),HandleNav.reload(function(){$.Dialog.close()})):(i.children().first().text(this.label),o.html(this.notes),window.tooltips(),$.Dialog.close());else{var e=this.id,a=this.info;$.Dialog.success(t,"Appearance added"),$.Dialog.wait(t,"Loading appearance page"),HandleNav("/colorguide/appearance/"+e,function(){a?$.Dialog.info(t,a):$.Dialog.close()})}}))})})},x=$.mk("form").attr("id","cg-reorder").append($.mk("div").attr("class","notice").hide().html("<p></p>"));$("#new-appearance-btn").on("click",function(){y($(this),"Add new "+(u?"Character":"Pony"))});var b=$.mk("form").attr("id","edit-tag");b.append('<label><span>Tag name (4-30 chars.)</span><input type="text" name="name" required pattern="^.{4,30}$" maxlength="30"></label>');var w=$.mk("div").addClass("type-selector");$.each(c,function(e,t){var a=$.mk("label"),i=$.mk("input").attr({type:"checkbox",name:"type",value:e}).on("change",function(){this.checked&&$(this).parent().siblings().find("input").prop("checked",!1)});a.append(i,$.mk("span").addClass("tag typ-"+e).text(t)).appendTo(w)}),b.append($.mk("div").addClass("align-center").append("<span>Tag type (optional)</span><br>",w),$.mk("label").append('<span>Tag description (max 255 chars., optional)</span><br><textarea name="title" maxlength="255"></textarea>'),$.mk("div").attr("class","align-center edit-only").append($.mk("button").attr("class","blue typcn typcn-flow-merge merge").html("Merge&hellip;"),$.mk("button").attr("class","blue typcn typcn-flow-children synon").html("Synonymize&hellip;")).on("click","button",function(t){t.preventDefault();var a=$(this).closest("form"),n=a.data("tag"),r=n.name,o=n.tid,s=this.className.split(" ").pop();$.Dialog.close(function(){window.CGTagEditing(r,o,s,function(t){var a=$(".tag.id-"+o);if(a.length)switch(t){case"synon":a.addClass("synonym");var n=this.target,r=a.eq(0).clone().removeClass("ctxmenu-bound"),s=e(n),l=a.add($(".tag.id-"+n.tid)).closest(".tags");l.filter(function(){return 0===$(this).children(".id-"+o).length}).append(r).reorderTags(),l.filter(function(){return 0===$(this).children(".id-"+n.tid).length}).append(s).reorderTags(),window.tooltips(),i();break;case"unsynon":this.keep_tagged?a.removeClass("synonym"):a.remove();break;case"merge":a.replaceWith(e(this))}$.Dialog.close()})})}));var D=$.mk("form").attr("id","cg-editor"),A=$.mk("span").attr("class","clrp"),C=PRINTABLE_ASCII_REGEX.replace("+","{3,30}"),_=$.mk("input").attr({"class":"clri",autocomplete:"off",spellcheck:"false"}).patternAttr(p).on("keyup change input",function(e,t){var a=$(this),i=a.prev(),n=("string"==typeof t?t:this.value).trim(),r=p.test(n);r?i.removeClass("invalid").css("background-color",n.replace(p,"#$1")):i.addClass("invalid"),a.next().attr("required",r)}).on("paste blur keyup",function(e){var t=this,a=function(){var a=$.hexpand(t.value);if(p.test(a)){a=a.replace(p,"#$1").toUpperCase();var i=$(t);switch(e.type){case"paste":i.next().focus();case"blur":i.val(a)}i.trigger("change",[a]).patternAttr(SHORT_HEX_COLOR_PATTERN.test(t.value)?SHORT_HEX_COLOR_PATTERN:p)}};"paste"===e.type?setTimeout(a,10):a()}),E=$.mk("input").attr({"class":"clrl",pattern:C}),T=$.mk("div").attr("class","clra").append($.mk("span").attr("class","typcn typcn-minus remove red").on("click",function(){$(this).closest(".clr").remove()})).append($.mk("span").attr("class","typcn typcn-arrow-move move blue")),R=function(e){var t=A.clone(),a=_.clone(!0,!0),i=E.clone(),n=T.clone(!0,!0),r=$.mk("div").attr("class","clr");return"object"==typeof e&&(e.hex&&a.val(e.hex),e.label&&i.val(e.label)),r.append(t,a,i,n),a.trigger("change"),r},P=$.mk("button").attr("class","typcn typcn-plus green add-color").text("Add new color").on("click",function(e){e.preventDefault();var t=$(this).parents("#cg-editor"),a=t.children(".clrs");if(a.length||t.append(a=$.mk("div").attr("class","clrs")),a.hasClass("ace_editor")){var i=a.data("editor");i.clearSelection(),i.navigateLineEnd();var n=i.getCursorPosition(),r=n.row+1,o=0===n.column,s=window.copyHashEnabled();o||r++,i.insert((o?"":"\n")+(s?"#":"")+"	Color Name"),i.gotoLine(r,Number(s)),i.focus()}else{var l=R();a.append(l),l.find(".clri").focus()}}),N=function(e){for(var t=[],a=e.split("\n"),i=0,n=a.length;n>i;i++){var r=a[i];if(!/^(\/\/.*)?$/.test(r)){var o=r.trim().match(/^#([a-f\d]{6}|[a-f\d]{3})(?:\s*([a-z\d][ -~]{2,29}))?$/i);if(!o||!o[2])throw new h(r,i+1,o);t.push({hex:$.hexpand(o[1]),label:o[2]})}}return t},H=$.mk("button").attr("class","typcn typcn-document-text darkblue").text("Plain text editor").on("click",function(e){e.preventDefault();var t=$(this),a=t.parents("#cg-editor");t.disable();try{a.trigger("save-color-inputs")}catch(i){if(!(i instanceof h))throw i;t.enable();var n=a.find(".clrs").data("editor");return n.gotoLine(i.lineNumber),n.navigateLineEnd(),$.Dialog.fail(!1,i.message),void n.focus()}t.enable().toggleClass("typcn-document-text typcn-pencil").toggleHtml(["Plain text editor","Interactive editor"]),$.Dialog.clearNotice(/Parse error on line \d+ \(shown below\)/)});D.append($.mk("label").append($.mk("span").text("Group name (2-30 chars.)"),mk("br"),$.mk("input").attr({type:"text",name:"label",pattern:PRINTABLE_ASCII_REGEX.replace("+","{2,30}"),required:!0})),$.mk("label").append($.mk("input").attr({type:"checkbox",name:"major"}).on("click",function(){$(this).parent().next()[this.checked?"show":"hide"]().children("input").attr("disabled",!this.checked)}),$.mk("span").text("This is a major change")),$.mk("label").append($.mk("span").text("Change reason (1-255 chars.)"),mk("br"),$.mk("input").attr({type:"text",name:"reason",pattern:PRINTABLE_ASCII_REGEX.replace("+","{1,255}"),required:!0,disabled:!0})).hide(),$.mk("p").attr("class","align-center").text("The # symbol is optional, rows with invalid "+l+"s will be ignored. Each color must have a short (3-30 chars.) description of its intended use."),$.mk("div").attr("class","btn-group").append(P,H),$.mk("div").attr("class","clrs")).on("render-color-inputs",function(){var e=$(this),t=e.data("color_values"),a=e.children(".clrs").empty();$.each(t,function(e,t){a.append(R(t))}),a.data("sortable",new Sortable(a.get(0),{handle:".move",ghostClass:"moving",scroll:!1,animation:150}))}).on("save-color-inputs",function(e,t){var a,i=$(this),n=i.children(".clrs"),r=n.hasClass("ace_editor");if(r){if(a=n.data("editor"),i.data("color_values",N(a.getValue())),t)return;a.destroy(),n.empty().removeClass("ace_editor ace-colorguide").removeData("editor").unbind(),i.trigger("render-color-inputs")}else{var o=[];if(i.find(".clr").each(function(){var e=$(this),t=e.children(".clri"),a=$.hexpand(t.val());p.test(a)&&o.push({hex:a.replace(p,"#$1").toUpperCase(),label:e.children(".clrl").val()})}),i.data("color_values",o),t)return;var s=["// One color per line","// e.g. #012ABC Fill"];$.each(o,function(e,t){var a=[];"object"==typeof t&&(a.push(t.hex?t.hex:"#_____"),t.label&&a.push(t.label)),s.push(a.join("	"))});var l=n.data("sortable");"undefined"!=typeof l&&l.destroy(),n.unbind().text(s.join("\n")+"\n"),a=ace.edit(n[0]),a.$blockScrolling=1/0;var c=a.getSession();a.setTheme("ace/theme/colorguide"),a.setShowPrintMargin(!1),c.setMode("ace/mode/colorguide"),c.setTabSize(8),c.setUseSoftTabs(!1),a.navigateFileEnd(),a.focus(),n.data("editor",a)}}),window.ctxmenus=function(){i()};var q;v.on("page-switch",n),n()});
//# sourceMappingURL=colorguide-manage.min.js.map
