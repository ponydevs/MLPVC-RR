$(function(){function t(t){if(!document.queryCommandSupported("copy"))return prompt("Copy with Ctrl+C, close with Enter",t),!0;var e=$(document.createElement("textarea")),i=!1;e.css({opacity:0,width:0,height:0,position:"absolute",left:"-10px",top:"-10px",display:"block"}).text(t).appendTo("body").focus(),e.get(0).select();try{i=document.execCommand("copy")}catch(n){}i||$.Dialog.fail("Copy to clipboard","Copying text to clipboard failed!"),setTimeout(function(){e.remove()},1)}function e(t){t.children().sort(function(t,e){var i=/^.*typ-([a-z]+).*$/;return t=[t.className.replace(i,"$1"),t.innerHTML.trim()],e=[e.className.replace(i,"$1"),e.innerHTML.trim()],t[0]===e[0]?t[1].localeCompare(e[1]):t[0].localeCompare(e[0])}).appendTo(t)}function i(){d.children(":not(.ctxmenu-bound)").ctxmenu([{text:"Edit tag",icon:"pencil",click:function(){var t=$(this),i=t.text().trim(),n=t.attr("class").match(/id-(\d+)(?:\s|$)/)[1],a="Editing tag: "+i;$.Dialog.wait(a,"Retrieveing tag details from server"),$.post("/colorguide/gettag/"+n,{},function(t){return"object"!=typeof t?console.log(t)&&$w.trigger("ajaxerror"):void(t.status?$.Dialog.request(a,c.clone(!0,!0),"edit-tag","Save",function(){var i=$("#edit-tag");i.find("input[name=type][value="+t.type+"]").prop("checked",!0),i.find("input[type=text][name], textarea[name]").each(function(){var e=$(this);e.val(t[e.attr("name")])}),i.on("submit",function(t){t.preventDefault();var i=$(this).serializeArray(),o={};$.each(i,function(t,e){o[e.name]=e.value}),$.Dialog.wait(a,"Saving changes"),$.post("/colorguide/settag/"+n,o,function(t){if("object"!=typeof t)return console.log(t)&&$w.trigger("ajaxerror");if(t.status){var i=$(".id-"+t.tid);i.qtip("destroy",!0),t.title?i.attr("title",t.title):i.removeAttr("title"),i.attr("class","tag id-"+t.tid+(t.type?" typ-"+t.type:"")).text(t.name),i.parent().each(function(){e($(this))}),window.tooltips(),$.Dialog.close()}else $.Dialog.fail(a,t.message)})})}):$.Dialog.fail(a,t.message))})}},{text:"Delete tag",icon:"trash",click:function(){var t=$(this),e=t.text().trim(),i=t.attr("class").match(/id-(\d+)(?:\s|$)/)[1],n="Detele tag: "+e;$.Dialog.confirm(n,"By deleting this tag, it'll be removed from every appearance where it's been used.<br>Are you sure?",["Delete it","Nope"],function(t){t&&($.Dialog.wait(n,"Sending removal request"),$.post("/colorguide/deltag/"+i,{},function(t){if("object"!=typeof t)return console.log(t)&&$w.trigger("ajaxerror");if(t.status){var e=$(".id-"+i);e.qtip("destroy",!0),e.remove(),$.Dialog.close()}else $.Dialog.fail(n,t.message)}))})}},!0,{text:"Create new tag",icon:"plus",click:function(){var t="Create new tag",e=$(this),n=e.closest("li"),a=e.closest("div:not([class])"),o=a.children(".tags"),r=n.attr("id").replace(/\D/g,""),l=a.children("strong").text().trim();$.Dialog.request(t,c.clone(!0,!0),"edit-tag","Create",function(){var e=$("#edit-tag");e.append($(document.createElement("label")).append("<input type=checkbox name=addto value="+r+'> Add this tag to the appearance "'+l+'" after creation')),$.Dialog.center(),e.on("submit",function(n){n.preventDefault();var a=e.serializeArray(),r={};$.each(a,function(t,e){r[e.name]=e.value}),$.Dialog.wait(t,"Creating tag"),$.post("/colorguide/maketag",r,function(e){return"object"!=typeof e?console.log(e)&&$w.trigger("ajaxerror"):void(e.status?(e.tags&&(o.children("[data-hasqtip]").qtip("destroy",!0),o.html(e.tags),window.tooltips(),i()),$.Dialog.close()):$.Dialog.fail(t,e.message))})})})}},{text:"Enable edit mode (TBI)",icon:"edit",click:function(){$(this).parent().prevAll("strong").children("button.edit").triggerHandler("click")}}],function(t){return"Tag: "+t.text().trim()}),n=$("ul.colors").children("li"),n.filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Edit "+o+" group (TBI)",icon:"pencil",click:function(){$.Dialog.info("Edit "+o+" group triggered","yay")}},{text:"Delete "+o+" group (TBI)",icon:"trash",click:function(){$.Dialog.info("Delete "+o+" group triggered","yay")}},{text:"Add new group (TBI)",icon:"folder-add",click:function(){$.Dialog.info("Add new group triggered","yay")}},{text:"Add new "+o+" (TBI)",icon:"plus",click:function(){$.Dialog.info("Add new color triggered","yay")}}],function(t){return a+" group: "+t.children().first().text().trim().replace(":","")}),n.children("span:not(:first-child)").off("click").on("click",function(e){e.preventDefault(),t(this.innerHTML.trim())}).filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Copy "+o,icon:"clipboard","default":!0,click:function(){t(this.innerHTML.trim())}},{text:"Edit "+o+" (TBI)",icon:"pencil (TBI)",click:function(){$.Dialog.info("Edit "+o+" triggered","yay")}},!0,{text:"Edit "+o+" group (TBI)",icon:"pencil",click:function(){$.ctxmenu.triggerItem($(this).parent(),1)}},{text:"Delete "+o+" group (TBI)",icon:"trash",click:function(){$.ctxmenu.triggerItem($(this).parent(),2)}},{text:"Add new group (TBI)",icon:"folder-add",click:function(){$.ctxmenu.triggerItem($(this).parent(),3)}},{text:"Add new "+o+" (TBI)",icon:"plus",click:function(){$.ctxmenu.triggerItem($(this).parent(),4)}}],function(t){return"Color: "+t.attr("oldtitle")})}var n,a=window.Color,o=window.color,r=window.TAG_TYPES_ASSOC;$("#list").find("button.edit").on("click",function(){$.Dialog.info("Edit mode triggered","yay")}).next().on("click",function(){$.Dialog.info("Delete pony triggered","yay")});var c=$(document.createElement("form")).attr("id","edit-tag");c.append("<label><span>Tag name (4-30 chars.)</span><input type=text name=name required pattern=^.{4,30}$ maxlength=30></label>");var l=$(document.createElement("div")).addClass("type-selector");$.each(r,function(t,e){var i=$(document.createElement("label")),n=$(document.createElement("input")).attr({type:"checkbox",name:"type",value:t}).on("click",function(){this.checked&&$(this).parent().siblings().find("input").prop("checked",!1)});i.append(n,$(document.createElement("span")).addClass("tag typ-"+t).text(e)).appendTo(l)}),c.append($(document.createElement("div")).addClass("align-center").append("<span>Tag type (optional)</span><br>",l)),c.append($(document.createElement("label")).append("<span>Tag description (max 255 chars., optional)</span><br><textarea name=title maxlength=255></textarea>"));var d=$(".tags");i(),window.ctxmenus=function(){i()}});
//# sourceMappingURL=colorguide-manage.min.js.map