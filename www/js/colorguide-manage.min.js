$(function(){function t(t){t.children().sort(function(t,e){var i=/^.*typ-([a-z]+).*$/;return t=[t.className.replace(i,"$1"),t.innerHTML.trim()],e=[e.className.replace(i,"$1"),e.innerHTML.trim()],t[0]===e[0]?t[1].localeCompare(e[1]):t[0].localeCompare(e[0])}).appendTo(t)}function e(){l.children(":not(.ctxmenu-bound)").ctxmenu([{text:"Edit tag",icon:"pencil",click:function(){var e=$(this),i=e.text().trim(),n=e.attr("class").match(/id-(\d+)(?:\s|$)/)[1],a="Editing tag: "+i;$.Dialog.wait(a,"Retrieveing tag details from server"),$.post("/colorguide/gettag/"+n,$.mkAjaxHandler(function(){this.status?$.Dialog.request(a,r.clone(!0,!0),"edit-tag","Save",function(){var e=$("#edit-tag");e.find("input[name=type][value="+data.type+"]").prop("checked",!0),e.find("input[type=text][name], textarea[name]").each(function(){var t=$(this);t.val(data[t.attr("name")])}),e.on("submit",function(e){e.preventDefault();var i=$(this).serializeArray(),o={};$.each(i,function(t,e){o[e.name]=e.value}),$.Dialog.wait(a,"Saving changes"),$.post("/colorguide/settag/"+n,o,function(e){if("object"!=typeof e)return console.log(e)&&$w.trigger("ajaxerror");if(e.status){var i=$(".id-"+e.tid);i.qtip("destroy",!0),e.title?i.attr("title",e.title):i.removeAttr("title"),i.attr("class","tag id-"+e.tid+(e.type?" typ-"+e.type:"")).text(e.name),i.parent().each(function(){t($(this))}),window.tooltips(),$.Dialog.close()}else $.Dialog.fail(a,e.message)})})}):$.Dialog.fail(a,this.message)}))}},{text:"Delete tag",icon:"trash",click:function(){var t=$(this),e=t.text().trim(),i=t.attr("class").match(/id-(\d+)(?:\s|$)/)[1],n="Detele tag: "+e;$.Dialog.confirm(n,"By deleting this tag, it'll be removed from every appearance where it's been used.<br>Are you sure?",["Delete it","Nope"],function(t){t&&($.Dialog.wait(n,"Sending removal request"),$.post("/colorguide/deltag/"+i,$.mkAjaxHandler(function(){if(this.status){var t=$(".id-"+i);t.qtip("destroy",!0),t.remove(),$.Dialog.close()}else $.Dialog.fail(n,this.message)})))})}},!0,{text:"Create new tag",icon:"plus",click:function(){var t="Create new tag",i=$(this),n=i.closest("li"),a=i.closest("div:not([class])"),o=a.children(".tags"),c=n.attr("id").replace(/\D/g,""),l=a.children("strong").text().trim();$.Dialog.request(t,r.clone(!0,!0),"edit-tag","Create",function(){var i=$("#edit-tag");i.append($(document.createElement("label")).append("<input type=checkbox name=addto value="+c+'> Add this tag to the appearance "'+l+'" after creation')),$.Dialog.center(),i.on("submit",function(n){n.preventDefault();var a=i.serializeArray(),r={};$.each(a,function(t,e){r[e.name]=e.value}),$.Dialog.wait(t,"Creating tag"),$.post("/colorguide/maketag",r,$.mkAjaxHandler(function(){this.status?(this.tags&&(o.children("[data-hasqtip]").qtip("destroy",!0),o.html(this.tags),window.tooltips(),e()),$.Dialog.close()):$.Dialog.fail(t,this.message)}))})})}},{text:"Enable edit mode (TBI)",icon:"edit",click:function(){$(this).parent().prevAll("strong").children("button.edit").triggerHandler("click")}}],function(t){return"Tag: "+t.text().trim()}),i=$("ul.colors").children("li"),i.filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Edit "+a+" group (TBI)",icon:"pencil",click:function(){$.Dialog.info("Edit "+a+" group triggered","yay")}},{text:"Delete "+a+" group (TBI)",icon:"trash",click:function(){$.Dialog.info("Delete "+a+" group triggered","yay")}},{text:"Add new group (TBI)",icon:"folder-add",click:function(){$.Dialog.info("Add new group triggered","yay")}},{text:"Add new "+a+" (TBI)",icon:"plus",click:function(){$.Dialog.info("Add new color triggered","yay")}}],function(t){return n+" group: "+t.children().first().text().trim().replace(":","")}),i.children("span:not(:first-child)").off("click").on("click",function(t){t.preventDefault(),$.copy(this.innerHTML.trim())}).filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Copy "+a,icon:"clipboard","default":!0,click:function(){$.copy(this.innerHTML.trim())}},{text:"Edit "+a+" (TBI)",icon:"pencil (TBI)",click:function(){$.Dialog.info("Edit "+a+" triggered","yay")}},!0,{text:"Edit "+a+" group (TBI)",icon:"pencil",click:function(){$.ctxmenu.triggerItem($(this).parent(),1)}},{text:"Delete "+a+" group (TBI)",icon:"trash",click:function(){$.ctxmenu.triggerItem($(this).parent(),2)}},{text:"Add new group (TBI)",icon:"folder-add",click:function(){$.ctxmenu.triggerItem($(this).parent(),3)}},{text:"Add new "+a+" (TBI)",icon:"plus",click:function(){$.ctxmenu.triggerItem($(this).parent(),4)}}],function(t){return"Color: "+t.attr("oldtitle")})}var i,n=window.Color,a=window.color,o=window.TAG_TYPES_ASSOC;$(".upload-wrap").each(function(){var t=$(this),e=t.closest("li").attr("id").substring(1);t.uploadZone({requestKey:"sprite",title:"Upload sprite",accept:"image/png",target:"/colorguide/setsprite/"+e}).ctxmenu([{text:"Upload new sprite",icon:"upload","default":!0,click:function(){t.find('input[type="file"]').trigger("click")}},{text:"Copy image URL",icon:"clipboard",click:function(){$.copy($.urlToAbsolute(t.find("img").attr("src")))}},{text:"Open image in new tab",icon:"arrow-forward",attr:{href:t.find("img").attr("src"),target:"_blank"}}],"Sprite image")}),$("#list").find("button.edit").on("click",function(){$.Dialog.info("Edit mode triggered","yay")}).next().on("click",function(){var t=$(this),e=t.closest("li"),i=e.attr("id").substring(1),n=t.parent().text().trim(),a="Deleting appearance: "+n;$.Dialog.confirm(a,"Deleting this appearance will remove <strong>ALL</strong> of its color groups, the colors within them, and the sprite file, if any.<br>Delete anyway?",function(t){t&&($.Dialog.wait(a,"Sending removal request"),$.post("/colorguide/delete/"+i,function(t){return"object"!=typeof t?console.log(t)&&$w.trigger("ajaxerror"):void(t.status?(e.remove(),$.Dialog.close()):$.Dialog.fail(a,t.message))}))})});var r=$(document.createElement("form")).attr("id","edit-tag");r.append("<label><span>Tag name (4-30 chars.)</span><input type=text name=name required pattern=^.{4,30}$ maxlength=30></label>");var c=$(document.createElement("div")).addClass("type-selector");$.each(o,function(t,e){var i=$(document.createElement("label")),n=$(document.createElement("input")).attr({type:"checkbox",name:"type",value:t}).on("click",function(){this.checked&&$(this).parent().siblings().find("input").prop("checked",!1)});i.append(n,$(document.createElement("span")).addClass("tag typ-"+t).text(e)).appendTo(c)}),r.append($(document.createElement("div")).addClass("align-center").append("<span>Tag type (optional)</span><br>",c)),r.append($(document.createElement("label")).append("<span>Tag description (max 255 chars., optional)</span><br><textarea name=title maxlength=255></textarea>"));var l=$(".tags");e(),window.ctxmenus=function(){e()}});
//# sourceMappingURL=colorguide-manage.min.js.map