"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};DocReady.push(function(){function e(e,t,n){var i="Create new tag",o=e.closest(".tags"),s=o.closest("[id^=p]"),l=s.attr("id").substring(1),c=u?$content.children("h1").text():o.siblings("strong").text().trim();$.Dialog.request(i,b.clone(!0,!0),"Create",function(e){e.children(".edit-only").replaceWith($.mk("label").append($.mk("input").attr({type:"checkbox",name:"addto"}).val(l).prop("checked","string"==typeof t),' Add this tag to the appearance "'+c+'" after creation')),"string"==typeof n&&"undefined"!=typeof r[n]&&e.find("input[name=type][value="+n+"]").prop("checked",!0).trigger("change"),"string"==typeof t&&e.find("input[name=name]").val(t),e.on("submit",function(t){t.preventDefault();var n=e.mkData();$.Dialog.wait(!1,"Creating tag"),n.addto&&u&&(n.APPEARANCE_PAGE=!0),$.post("/cg/maketag"+d,n,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);if(this.tags&&(o.children("[data-hasqtip]").qtip("destroy",!0),o.html(this.tags),window.tooltips(),a()),this.needupdate===!0){var e=$(this.eps);f.replaceWith(e),f=e}$._tagAutocompleteCache={},$.Dialog.close()}))})})}function t(e,t){var n=this,i=void 0,o=void 0;"undefined"!=typeof t&&(t instanceof jQuery?(o=t.attr("id").substring(2),i=t.parents("[id^=p]").attr("id").substring(1)):i=t),$.Dialog.request(e,k.clone(!0,!0),"Save",function(e){var r=e.find("input[name=label]"),s=e.find("input[name=major]"),l=e.find("input[name=reason]"),c="object"===("undefined"==typeof n?"undefined":_typeof(n))&&n.label&&n.Colors;c&&(r.val(n.label),e.data("color_values",n.Colors).trigger("render-color-inputs")),e.on("submit",function(n){n.preventDefault();try{e.trigger("save-color-inputs",[!0])}catch(p){if(!(p instanceof g))throw p;var m=e.find(".clrs").data("editor");return m.gotoLine(p.lineNumber),m.navigateLineEnd(),$.Dialog.fail(!1,p.message),void m.focus()}var f={label:r.val(),Colors:e.data("color_values")};return c||(f.ponyid=i),0===f.Colors.length?$.Dialog.fail(!1,"You need to have at least 1 valid color"):(f.Colors=JSON.stringify(f.Colors),s.is(":checked")&&(f.major=!0,f.reason=l.val()),u&&(f.APPEARANCE_PAGE=!0),$.Dialog.wait(!1,"Saving changes"),void $.post("/cg/"+(c?"set":"make")+"cg"+(c?"/"+o:"")+d,f,$.mkAjaxHandler(function(){var e=this;return this.status?void(this.cg||this.cgs?!function(){var n=$("#p"+i);if(e.cg?(t.children("[data-hasqtip]").qtip("destroy",!0),t.html(e.cg),e.update&&t.parents("li").find(".update").html(e.update)):e.cgs&&(e.update&&n.find(".update").html(e.update),n.find("ul.colors").html(e.cgs)),!u&&e.notes){var o=n.find(".notes");try{o.find(".cm-direction").qtip("destroy",!0)}catch(r){}o.html(e.notes)}window.tooltips(),a(),e.update&&Time.Update();var s=$("#pony-cm");u&&s.length&&e.cm_img?!function(){$.Dialog.success(!1,"Color group updated"),$.Dialog.wait(!1,"Updating cutie mark orientation image");var t=new Image;t.src=e.cm_img,$(t).on("load error",function(){s.backgroundImageUrl(t.src),$.Dialog.close()})}():$.Dialog.close()}():$.Dialog.close()):$.Dialog.fail(!1,this.message)})))})})}function a(){P.children("span:not(.ctxmenu-bound)").ctxmenu([{text:"Edit tag",icon:"pencil",click:function(){var e=$(this),t=e.text().trim(),a=e.attr("class").match(/id-(\d+)(?:\s|$)/)[1],n="Editing tag: "+t;$.Dialog.wait(n,"Retrieveing tag details from server"),$.post("/cg/gettag/"+a+d,$.mkAjaxHandler(function(){var e=this;this.status?$.Dialog.request(n,b.clone(!0,!0).data("tag",e),"Save",function(t){t.find("input[name=type][value="+e.type+"]").prop("checked",!0),t.find("input[type=text][name], textarea[name]").each(function(){var t=$(this);t.val(e[t.attr("name")])}),t.on("submit",function(e){e.preventDefault();var n=t.mkData();$.Dialog.wait(!1,"Saving changes"),$.post("/cg/settag/"+a+d,n,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=this,t=$(".id-"+e.tid);t.qtip("destroy",!0),e.title?t.attr("title",e.title):t.removeAttr("title"),t.text(e.name).data("ctxmenu-items").eq(0).text("Tag: "+e.name),t.each(function(){/typ-[a-z]+/.test(this.className)?this.className=this.className.replace(/typ-[a-z]+/,e.type?"typ-"+e.type:""):e.type&&(this.className+=" typ-"+e.type),$(this)[e.synonym_of?"addClass":"removeClass"]("synonym").parent().reorderTags()}),window.tooltips(),$.Dialog.close()}))})}):$.Dialog.fail(n,this.message)}))}},{text:"Remove tag",icon:"minus",click:function(){var e=$(this),t=e.attr("class").match(/id-(\d+)(?:\s|$)/);if(!t)return!1;t=t[1];var a=e.closest("[id^=p]").attr("id").replace(/\D/g,""),n=e.text().trim(),i="Remove tag: "+n;$.Dialog.confirm(i,"The tag <strong>"+n+"</strong> will be removed from this appearance.<br>Are you sure?",["Remove it","Nope"],function(n){if(n){var o={tag:t};$.Dialog.wait(i,"Removing tag"),u&&(o.APPEARANCE_PAGE=!0),$.post("/cg/untag/"+a+d,o,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(i,this.message);if(this.needupdate===!0){var a=$(this.eps);f.replaceWith(a),f=a}e.qtip("destroy",!0),e.remove(),$(".tag.synonym").filter("[data-syn-of="+t+"]").remove(),$.Dialog.close()}))}})}},{text:"Delete tag",icon:"trash",click:function(){var e=$(this),t=e.text().trim(),a=e.attr("class").match(/id-(\d+)(?:\s|$)/)[1],n="Detele tag: "+t;$.Dialog.confirm(n,"Deleting this tag will also remove it from every appearance where it's been used.<br>Are you sure?",["Delete it","Nope"],function(t){if(t){var i={};u&&(i.APPEARANCE_PAGE=e.closest("[id^=p]").attr("id").substring(1)),function o(e){$.Dialog.wait(n,"Sending removal request"),$.post("/cg/deltag/"+a+d,e,$.mkAjaxHandler(function(){if(this.status){if(this.needupdate===!0){var t=$(this.eps);f.replaceWith(t),f=t}var i=$(".id-"+a);i.qtip("destroy",!0),i.remove(),$._tagAutocompleteCache={},$.Dialog.close()}else this.confirm?$.Dialog.confirm(!1,this.message,["NUKE TAG","Nevermind"],function(t){t&&(e.sanitycheck=!0,o(e))}):$.Dialog.fail(n,this.message)}))}(i)}})}},$.ctxmenu.separator,{text:"Create new tag",icon:"plus",click:function(){$.ctxmenu.triggerItem($(this).parent(),1)}}],function(e){return"Tag: "+e.text().trim()});var n=[Key.Enter,Key.Comma];P.children(".addtag").each(function(){var t=$(this),i=t.closest("[id^=p]").attr("id").substring(1);t.autocomplete({minLength:3},[{name:"tags",display:"name",source:function(e,t){if("undefined"==typeof $._tagAutocompleteCache)$._tagAutocompleteCache={};else if("undefined"!=typeof $._tagAutocompleteCache[e])return t($._tagAutocompleteCache[e]);$.get("/cg/gettags?s="+encodeURIComponent(e),$.mkAjaxHandler(function(){t($._tagAutocompleteCache[e]=this)}))},templates:{suggestion:Handlebars.compile('<span class="tag id-{{tid}} {{type}} {{#if synonym_of}}synonym{{else}}monospace{{/if}}">{{name}} <span class="uses">{{#if synonym_of}}<span class="typcn typcn-flow-children"></span>{{synonym_target}}{{else}}{{uses}}{{/if}}</span></span>')}}]),t.on("keydown",function(o){if(n.includes(o.keyCode)){var r=function(){o.preventDefault();var n=t.val().trim(),r=t.parents(".tags"),s=r.children(".tag"),l="Adding tag: "+n;if(s.filter(function(){return this.innerHTML.trim()===n}).length>0)return{v:$.Dialog.fail(l,"This appearance already has this tag")};$.Dialog.setFocusedElement(t.attr("disabled",!0)),t.parent().addClass("loading"),t.autocomplete("val",n);var c={tag_name:n};u&&(c.APPEARANCE_PAGE=!0),$.post("/cg/tag/"+i+d,c,$.mkAjaxHandler(function(){var i=this;if(t.removeAttr("disabled").parent().removeClass("loading"),this.status){if(this.needupdate===!0){var o=$(this.eps);f.replaceWith(o),f=o}r.children("[data-hasqtip]").qtip("destroy",!0),r.children(".tag").remove(),r.append($(this.tags).filter("span")),window.tooltips(),a(),$._tagAutocompleteCache={},t.autocomplete("val","").focus()}else if("string"==typeof this.cancreate){var s=function(){var a=i.cancreate,o=i.typehint;return l=l.replace(n,a),{v:$.Dialog.confirm(l,i.message,function(n){n&&e(t,a,o)})}}();if("object"===("undefined"==typeof s?"undefined":_typeof(s)))return s.v}else $.Dialog.fail(l,this.message)}))}();if("object"===("undefined"==typeof r?"undefined":_typeof(r)))return r.v}}),t.nextAll(".aa-menu").on("click",".tag",function(){t.trigger({type:"keydown",keyCode:Key.Enter})})}),s=$("ul.colors").attr("data-color",o),s.filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Re-order "+o+" groups",icon:"arrow-unsorted",click:function(){var e=$(this),t=e.closest("[id^=p]"),n=t.attr("id").substring(1),i=u?$content.children("h1").text():t.children().last().children("strong").text().trim(),r="Re-order "+o+" groups on appearance: "+i;$.Dialog.wait(r,"Retrieving color group list from server"),$.post("/cg/getcgs/"+n+d,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(this.message);var t=$.mk("form","cg-reorder"),i=$.mk("ol");$.each(this.cgs,function(e,t){i.append($.mk("li").attr("data-id",t.groupid).text(t.label))}),t.append($.mk("div").attr("class","cgs").append('<p class="align-center">Drag to re-arrange</p>',i)),new Sortable(i.get(0),{ghostClass:"moving",scroll:!1,animation:150}),$.Dialog.request(r,t,"Save",function(t){t.on("submit",function(i){i.preventDefault();var o={cgs:[]},r=t.children(".cgs");return r.length?(r.find("ol").children().each(function(){o.cgs.push($(this).attr("data-id"))}),o.cgs=o.cgs.join(","),$.Dialog.wait(!1,"Saving changes"),u&&(o.APPEARANCE_PAGE=!0),void $.post("/cg/setcgs/"+n+d,o,$.mkAjaxHandler(function(){return this.status?(e.html(this.cgs),window.tooltips(),a(),void $.Dialog.close()):$.Dialog.fail(null,this.message)}))):$.Dialog.fail(!1,"There are no color groups to re-order")})})}))}},{text:"Create new group",icon:"folder-add",click:function(){t("Create "+o+" group",$(this).closest("[id^=p]").attr("id").substring(1))}},{text:"Apply template (if empty)",icon:"document-add",click:function(){var e=$(this).closest("[id^=p]").attr("id").substring(1);$.Dialog.confirm("Apply template on appearance","Add common color groups to this appearance?<br>Note: This will only work if there are no color groups currently present.",function(t){t&&($.Dialog.wait(!1,"Applying template"),$.post("/cg/applytemplate/"+e+d,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var t=$("#p"+e);t.find("ul.colors").html(this.cgs),window.tooltips(),a(),$.Dialog.close()})))})}}],i+" groups"),s.children("li").filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Edit "+o+" group",icon:"pencil",click:function(){var e=$(this),a=e.closest("li"),n=a.attr("id").substring(2),i=e.children().first().text().replace(/:\s?$/,""),r="Editing "+o+" group: "+i;$.Dialog.wait(r,"Retrieving "+o+" group details from server"),$.post("/cg/getcg/"+n+d,$.mkAjaxHandler(function(){return this.status?void t.call(this,r,a):$.Dialog.fail(r,this.message)}))}},{text:"Delete "+o+" group",icon:"trash",click:function(){var e=$(this).closest("li"),t=e.attr("id").substring(2),a=e.children().first().text().replace(/:\s?$/,""),n="Delete "+o+" group: "+a;$.Dialog.confirm(n,"By deleting this "+o+" group, all "+o+"s within will be removed too.<br>Are you sure?",function(a){a&&($.Dialog.wait(n,"Sending removal request"),$.post("/cg/delcg/"+t+d,$.mkAjaxHandler(function(){this.status?(e.children("[data-hasqtip]").qtip("destroy",!0),e.remove(),$.Dialog.close()):$.Dialog.fail(n,this.message)})))})}},$.ctxmenu.separator,{text:"Re-order "+o+" groups",icon:"arrow-unsorted",click:function(){$.ctxmenu.triggerItem($(this).parent(),1)}},{text:"Create new group",icon:"folder-add",click:function(){$.ctxmenu.triggerItem($(this).parent(),2)}}],function(e){return i+" group: "+e.children().first().text().trim().replace(":","")});var r=s.children("li").find(".valid-color");$.ctxmenu.addItems(r.filter(".ctxmenu-bound"),$.ctxmenu.separator,{text:"Edit "+o+" group",icon:"pencil",click:function(){$.ctxmenu.triggerItem($(this).parent().closest(".ctxmenu-bound"),1)}},{text:"Delete "+o+" group",icon:"trash",click:function(){$.ctxmenu.triggerItem($(this).parent().closest(".ctxmenu-bound"),2)}},$.ctxmenu.separator,{text:"Re-order "+o+" groups",icon:"arrow-unsorted",click:function(){$.ctxmenu.triggerItem($(this).parent().closest(".ctxmenu-bound"),3)}},{text:"Create new group",icon:"folder-add",click:function(){$.ctxmenu.triggerItem($(this).parent().closest(".ctxmenu-bound"),4)}}),$(".upload-wrap").filter(":not(.ctxmenu-bound)").each(function(){var e=$(this),t=e.closest("li");t.length||(t=$content.children("[id^=p]"));var a=t.attr("id").substring(1);!function(e,t){var a=void 0,n=void 0,i=function(){a=e.find("img").attr("src"),n=-1===a.indexOf("blank-pixel.png"),e[n?"removeClass":"addClass"]("nosprite"),$.ctxmenu.setDefault(e,n?1:3)};e.uploadZone({requestKey:"sprite",title:"Upload sprite",accept:"image/png",target:"/cg/setsprite/"+t}).on("uz-uploadstart",function(){$.Dialog.close()}).on("uz-uploadfinish",function(){i()}).ctxmenu([{text:"Open image in new tab",icon:"arrow-forward",click:function(){window.open(e.find("img").attr("src"),"_blank")}},{text:"Copy image URL",icon:"clipboard",click:function(){$.copy($.toAbsoluteURL(e.find("img").attr("src")))}},{text:"Upload new sprite",icon:"upload",click:function(){var a="Upload sprite image",n=e.find('input[type="file"]');$.Dialog.request(a,m.clone(),"Download image",function(e){var i=e.find("input[name=image_url]");e.find("a").on("click",function(e){e.preventDefault(),e.stopPropagation(),n.trigger("click",[!0])}),e.on("submit",function(e){e.preventDefault();var o=i.val();$.Dialog.wait(a,"Downloading external image to the server"),$.post("/cg/setsprite/"+t+d,{image_url:o},$.mkAjaxHandler(function(){this.status?n.trigger("set-image",[this.path]):$.Dialog.fail(a,this.message)}))})})}},{text:"Remove sprite image",icon:"times",click:function(){$.Dialog.confirm("Remove sprite image","Are you sure you want to <strong>permanently delete</strong> the sprite image from the server?",["Wipe it","Nope"],function(a){a&&($.Dialog.wait(!1,"Removing image"),$.post("/cg/delsprite/"+t,$.mkAjaxHandler(function(){return this.status?(e.find("img").attr("src",this.sprite),i(),void $.Dialog.close()):$.Dialog.fail(!1,this.message)})))})}}],"Sprite image").attr("title",c?" ":"").on("click",function(t,a){return a===!0?!0:(t.preventDefault(),void $.ctxmenu.runDefault(e))}),i()}(e,a)})}function n(){$("button.edit").on("click",function(){var e=$(this),t=e.closest("[id^=p]"),a=t.attr("id").substring(1),n=u?$content.children("h1").text():e.parent().text().trim(),i="Editing appearance: "+n;$.Dialog.wait(i,"Retrieving appearance details from server"),$.post("/cg/get/"+a+d,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var t=this;t.ponyID=a,y(e,i,t)}))}).next(".delete").on("click",function(){var e=$(this),t=e.closest("[id^=p]"),a=t.attr("id").substring(1),n=u?$content.children("h1").text():e.parent().text().trim(),i="Deleting appearance: "+n;$.Dialog.confirm(i,"Deleting this appearance will remove <strong>ALL</strong> of its color groups, the colors within them, and the sprite file, if any.<br>Delete anyway?",function(e){e&&($.Dialog.wait(i,"Sending removal request"),$.post("/cg/delete/"+a+d,$.mkAjaxHandler(function(){if(this.status){t.remove(),$.Dialog.success(i,this.message);var e=window.location.pathname;0===h.children().length&&(e=e.replace(/(\d+)$/,function(e){return e>1?e-1:e})),u?($.Dialog.wait("Navigation","Loading page 1"),$.Navigation.visit("/cg/1",function(){$.Dialog.close()})):$.toPage(e,!0,!0)}else $.Dialog.fail(i,this.message)})))})}),P=$(".tags").ctxmenu([{text:"Create new tag",icon:"plus",click:function(){e($(this))}}],"Tags"),a()}var i=window.Color,o=window.color,r=window.TAG_TYPES_ASSOC,s=void 0,l=window.HEX_COLOR_PATTERN,c="WebkitAppearance"in document.documentElement.style,p=window.EQG,d=p?"?eqg":"",u=!!window.AppearancePage,g=function(e,t,a){this.message="Parse error on line "+t+' (shown below)\n				<pre style="font-size:16px"><code>'+e.replace(/</g,"&lt;")+"</code></pre>"+(a&&!a[2]?"The color name is missing from this line.":"Please check for any errors before continuing."),this.lineNumber=t},m=$.mk("form","sprite-upload").html('<p class="align-center"><a href="#upload">Click here to upload a file</a> (max. '+window.MAX_SIZE+') or enter a URL below.</p>\n		<label><input type="text" name="image_url" placeholder="External image URL" required></label>\n		<p class="align-center">The URL will be checked against the supported provider list, and if an image is found, it\'ll be downloaded to the server and set as this appearance\'s sprite image.</p>'),f=void 0;u&&(f=$("#ep-appearances")),$.fn.reorderTags=function(){return this.each(function(){$(this).children(".tag").sort(function(e,t){var a=/^.*typ-([a-z]+).*$/;return e=[e.className.replace(a,"$1"),e.innerHTML.trim()],t=[t.className.replace(a,"$1"),t.innerHTML.trim()],e[0]===t[0]?e[1].localeCompare(t[1]):e[0].localeCompare(t[0])}).appendTo(this)})};var h=$(".appearance-list"),v=$.mk("form","pony-editor").append('<label>\n					<span>Name (4-70 chars.)</span>\n					<input type="text" name="label" placeholder="Enter a name" pattern="'+PRINTABLE_ASCII_PATTERN.replace("+","{4,70}")+'" required maxlength="70">\n				</label>\n				<label>\n					<span>Additional notes (1000 chars. max, optional)</span>\n					<textarea name="notes" maxlength="1000"></textarea>\n				</label>\n				<label>\n					<span>Link to cutie mark (optional)</span>\n					<input type="text" name="cm_favme" placeholder="DeviantArt submission URL">\n				</label>\n				<div class="align-center">\n					<p>Cutie mark orientation</p>\n					<label><input type="radio" name="cm_dir" value="ht" required><span>Head-Tail</span></label>\n					<label><input type="radio" name="cm_dir" value="th" required><span>Tail-Head</span></label>\n				</div>\n				<label>\n					<span>Link to CM preview image (optional)</span>\n					<input type="text" name="cm_preview" placeholder="Separate preview image">\n				</label>\n				<p class="notice info">The preview of the linked CM above will be used if the preview field is left empty.</p>'),y=function(e,t,a){var n=!!a,i=e.parents("[id^=p]"),o=i.find(".notes"),r=void 0;if(u){if(!n)return;r=$content.children("h1")}else r=e.siblings().first();$.Dialog.request(t,v.clone(!0,!0),"Save",function(e){var i=e.find("input[name=cm_favme]").on("change blur paste keyup",function(){var e=0===this.value.trim().length,t=$(this).parent().next();t.find("input").attr("disabled",e),t.next().find("input").attr("disabled",e)}),s=void 0;if(n){s=a.ponyID,e.find("input[name=label]").val(a.label);var l=e.find("textarea").val(a.notes);0===parseInt(s,10)&&l.removeAttr("maxlength"),a.cm_favme&&i.val(a.cm_favme),a.cm_preview&&e.find("input[name=cm_preview]").val(a.cm_preview),a.cm_dir&&e.find("input[name=cm_dir][value="+a.cm_dir+"]").prop("checked",!0),e.append($.mk("div").attr("class","align-center").append($.mk("button").attr("class","blue typcn typcn-image").text("Update rendered image").on("click",function(e){e.preventDefault(),$.Dialog.close(),$.Dialog.wait("Clear appearance image cache","Clearing cache"),$.post("/cg/clearrendercache/"+s,$.mkAjaxHandler(function(){return this.status?void $.Dialog.success(!1,this.message,!0):$.Dialog.fail(!1,this.message)}))})))}else e.append("<label><input type='checkbox' name='template'> Pre-fill with common color groups</label>");i.triggerHandler("change"),e.on("submit",function(a){a.preventDefault();var i=e.mkData();$.Dialog.wait(!1,"Saving changes"),u&&(i.APPEARANCE_PAGE=!0),$.post("/cg/"+(n?"set/"+s:"make")+d,i,$.mkAjaxHandler(function(){return this.status?(i=this,void(n?u?($.Dialog.wait(!1,"Reloading page",!0),$.Navigation.reload(function(){$.Dialog.close()})):(r.text(i.label),i.newurl&&r.attr("href",function(e,t){return t.replace(/\/[^\/]+$/,"/"+i.newurl)}),o.html(this.notes),window.tooltips(),$.Dialog.close()):($.Dialog.success(t,"Appearance added"),$.Dialog.wait(t,"Loading appearance page"),$.Navigation.visit("/cg/v/"+i.id,function(){i.info?$.Dialog.info(t,i.info):$.Dialog.close()})))):$.Dialog.fail(!1,this.message)}))})})};$("#new-appearance-btn").on("click",function(){y($(this),"Add new "+(p?"Character":"Pony"))});var b=$.mk("form","edit-tag");b.append('<label><span>Tag name (3-30 chars.)</span><input type="text" name="name" required pattern="^.{3,30}$" maxlength="30"></label>');var x='<div class=\'type-selector\'>\n			<label>\n				<input type="radio" name="type" value="" checked>\n				<span class="tag">Typeless</span>\n			</label>';$.each(r,function(e,t){x+='<label>\n				<input type="radio" name="type" value="'+e+'">\n				<span class="tag typ-'+e+'">'+t+"</span>\n			</label>"}),x+="</div>",b.append('<div class="align-center">\n			<span>Tag type</span><br>\n			'+x+'\n		</div>\n		<label>\n			<span>Tag description (max 255 chars., optional)</span>\n			<textarea name="title" maxlength="255"></textarea>\n		</label>',$.mk("div").attr("class","align-center edit-only").append($.mk("button").attr("class","blue typcn typcn-flow-merge merge").html("Merge&hellip;"),$.mk("button").attr("class","blue typcn typcn-flow-children synon").html("Synonymize&hellip;")).on("click","button",function(e){e.preventDefault();var t=$(this).closest("form"),n=t.data("tag"),i=n.name,o=n.tid,r=this.className.split(" ").pop();$.Dialog.close(function(){window.CGTagEditing(i,o,r,function(e){var t=$(".tag.id-"+o),n=void 0;if(t.length)switch(e){case"synon":n=this.target,t.addClass("synonym");var i=t.eq(0).clone().removeClass("ctxmenu-bound"),r=new w(n),s=t.add($(".tag.id-"+n.tid)).closest(".tags");s.filter(function(){return 0===$(this).children(".id-"+o).length}).append(i).reorderTags(),s.filter(function(){return 0===$(this).children(".id-"+n.tid).length}).append(r).reorderTags(),window.tooltips(),a();break;case"unsynon":this.keep_tagged?t.removeClass("synonym"):t.remove();break;case"merge":n=this.target,t.each(function(){var e=$(this);0===e.siblings(".id-"+n.tid).length?e.replaceWith(new w(n)):e.remove()}),window.tooltips(),a()}$.Dialog.close()})})}));var w=function(e){function t(e){var a,n;return _classCallCheck(this,t),n=(a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,'<span class="tag id-'+e.tid+(e.type?" typ-"+e.type:"")+(e.synonym_of?" synonym":"")+'" data-syn-of="'+e.synonym_of+'">'))).attr("title",e.title).text(e.name),_possibleConstructorReturn(a,n)}return _inherits(t,e),t}(jQuery),k=$.mk("form","cg-editor"),D=$.mk("input").attr({"class":"clri",autocomplete:"off",spellcheck:"false"}).patternAttr(l).on("keyup change input",function(e,t){var a=$(this),n=a.prev(),i=("string"==typeof t?t:this.value).trim(),o=l.test(i);o?n.removeClass("invalid").css("background-color",i.replace(l,"#$1")):n.addClass("invalid"),a.next().attr("required",o)}).on("paste blur keyup",function(e){var t=this,a=function(){var a=$.hexpand(t.value);l.test(a)&&!function(){a=a.replace(l,"#$1").toUpperCase();var n=$(t),i=$.hex2rgb(a);switch($.each(i,function(e,t){3>=t?i[e]=0:t>=252&&(i[e]=255)}),a=$.rgb2hex(i),e.type){case"paste":n.next().focus();case"blur":n.val(a)}n.trigger("change",[a]).patternAttr(SHORT_HEX_COLOR_PATTERN.test(t.value)?SHORT_HEX_COLOR_PATTERN:l)}()};"paste"===e.type?setTimeout(a,10):a()}),A=$.mk("input").attr({"class":"clrl",pattern:PRINTABLE_ASCII_PATTERN.replace("+","{3,30}")}),_=$.mk("div").attr("class","clra").append($.mk("span").attr("class","typcn typcn-minus remove red").on("click",function(){$(this).closest(".clr").remove()})).append($.mk("span").attr("class","typcn typcn-arrow-move move blue")),C=function(e){var t=D.clone(!0,!0),a=A.clone(),n=_.clone(!0,!0),i=$.mk("div").attr("class","clr");return"object"===("undefined"==typeof e?"undefined":_typeof(e))&&(e.hex&&t.val(e.hex),e.label&&a.val(e.label)),i.append("<span class='clrp'></span>",t,a,n),t.trigger("change"),i},E=$.mk("button").attr("class","typcn typcn-plus green add-color").text("Add new color").on("click",function(e){e.preventDefault();var t=$(this).parents("#cg-editor"),a=t.children(".clrs");if(a.length||t.append(a=$.mk("div").attr("class","clrs")),a.hasClass("ace_editor")){var n=a.data("editor");n.clearSelection(),n.navigateLineEnd();var i=n.getCursorPosition(),o=i.row+1,r=0===i.column,s=window.copyHashEnabled();r||o++,n.insert((r?"":"\n")+(s?"#":"")+"	Color Name"),n.gotoLine(o,Number(s)),n.focus()}else{var l=C();a.append(l),l.find(".clri").focus()}}),T=function(e){for(var t=[],a=e.split("\n"),n=0,i=a.length;i>n;n++){var o=a[n];if(!/^(\/\/.*)?$/.test(o)){var r=o.trim().match(/^#([a-f\d]{6}|[a-f\d]{3})(?:\s*([a-z\d][ -~]{2,29}))?$/i);if(!r||!r[2])throw new g(o,n+1,r);t.push({hex:$.hexpand(r[1]),label:r[2]})}}return t},R=$.mk("button").attr("class","typcn typcn-document-text darkblue").text("Plain text editor").on("click",function(e){e.preventDefault();var t=$(this),a=t.parents("#cg-editor");t.disable();try{a.trigger("save-color-inputs")}catch(n){if(!(n instanceof g))throw n;var i=a.find(".clrs").data("editor");return i.gotoLine(n.lineNumber),i.navigateLineEnd(),$.Dialog.fail(!1,n.message),i.focus(),void t.enable()}t.toggleClass("typcn-document-text typcn-pencil").toggleHtml(["Plain text editor","Interactive editor"]).enable(),$.Dialog.clearNotice(/Parse error on line \d+ \(shown below\)/)});k.append('<label>\n			<span>Group name (2-30 chars.)</span>\n			<input type="text" name="label" pattern="'+PRINTABLE_ASCII_PATTERN.replace("+","{2,30}")+'" required>\n		</label>',$.mk("label").append($.mk("input").attr({type:"checkbox",name:"major"}).on("click",function(){$(this).parent().next()[this.checked?"show":"hide"]().children("input").attr("disabled",!this.checked)}),"<span>This is a major change</span>"),"<label class=\"hidden\">\n			<span>Change reason (1-255 chars.)</span>\n			<input type='text' name='reason' pattern=\""+PRINTABLE_ASCII_PATTERN.replace("+","{1,255}")+'" required disabled>\n		</label>\n		<p class="align-center">The # symbol is optional, rows with invalid '+o+"s will be ignored. Each color must have a short (3-30 chars.) description of its intended use.</p>",$.mk("div").attr("class","btn-group").append(E,R),"<div class='clrs'/>").on("render-color-inputs",function(){var e=$(this),t=e.data("color_values"),a=e.children(".clrs").empty();$.each(t,function(e,t){a.append(C(t))}),a.data("sortable",new Sortable(a.get(0),{handle:".move",ghostClass:"moving",scroll:!1,animation:150}))}).on("save-color-inputs",function(e,t){var a=$(this),n=a.children(".clrs"),i=n.hasClass("ace_editor"),o=void 0;if(i){if(o=n.data("editor"),a.data("color_values",T(o.getValue())),t)return;o.destroy(),n.empty().removeClass("ace_editor ace-colorguide").removeData("editor").unbind(),a.trigger("render-color-inputs")}else{var r=function(){var e=[];if(a.find(".clr").each(function(){var t=$(this),a=t.children(".clri"),n=$.hexpand(a.val()).toUpperCase();l.test(n)&&e.push({hex:n.replace(l,"#$1"),label:t.children(".clrl").val()})}),a.data("color_values",e),t)return{v:void 0};var i=["// One color per line","// e.g. #012ABC Fill"];$.each(e,function(e,t){var a=[];"object"===("undefined"==typeof t?"undefined":_typeof(t))&&(a.push(t.hex?t.hex:"#_____"),t.label&&a.push(t.label)),i.push(a.join("	"))});var r=n.data("sortable");"undefined"!=typeof r&&r.destroy(),n.unbind().text(i.join("\n")+"\n"),o=ace.edit(n[0]),o.$blockScrolling=1/0;var s=o.getSession();o.setTheme("ace/theme/colorguide"),o.setShowPrintMargin(!1),s.setMode("ace/mode/colorguide"),s.setTabSize(8),s.setUseSoftTabs(!1),o.navigateFileEnd(),o.focus(),n.data("editor",o)}();if("object"===("undefined"==typeof r?"undefined":_typeof(r)))return r.v}});var P=void 0;window.ctxmenus=function(){a()},h.on("page-switch",n),n(),$(".cg-export").on("click",function(){$.mk("form").attr({method:"POST",action:"/cg/export",target:"_blank"}).html($.mk("input").attr("name","CSRF_TOKEN").val($.getCSRFToken())).submit()})});
//# sourceMappingURL=colorguide-manage.min.js.map
