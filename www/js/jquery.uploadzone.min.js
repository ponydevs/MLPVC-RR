"use strict";!function(){var e={requestKey:"file",title:"Image upload",accept:"image/*",target:"",helper:!0};$.fn.uploadZone=function(a){a=$.extend(!0,{},e,a);var t,r=a.title,n=$(this).first(),o=$.mk("input").attr({type:"file",name:a.requestKey,accept:a.accept});return a.helper&&(t=$.mk("div").addClass("helper")),o.on("set-image",function(e,a){$.Dialog.close(function(){n.removeClass("uploading"),o.prev().attr("href",a).children("img").fadeTo(200,0,function(){var e=$(this);e.attr("src",a).on("load",function(){e.fadeTo(200,1)}),n.trigger("uz-uploadfinish")})})}),o.on("dragenter dragleave",function(e){e.stopPropagation(),e.preventDefault(),n["dragenter"===e.type?"addClass":"removeClass"]("drop")}),o.on("change drop",function(e){var i=e.target.files||e.originalEvent.dataTransfer.files;if("undefined"==typeof i[0]||!(i[0]instanceof File))return!0;n.trigger("uz-uploadstart").removeClass("drop").addClass("uploading");var s=new FormData;s.append("sprite",i[0]),s.append("CSRF_TOKEN",$.getCSRFToken());var l={url:a.target,type:"POST",contentType:!1,processData:!1,cache:!1,data:s,success:$.mkAjaxHandler(function(){t.removeAttr("data-progress"),o.val(""),this.status?o.trigger("set-image",[this.path]):($.Dialog.fail(r,this.message),n.trigger("uz-uploadfinish").removeClass("uploading"))}),error:function(e){500!==e.status&&401!==e.status&&$.Dialog.fail(r,"Upload failed (HTTP "+e.status+")")}};a.helper&&(l.xhr=function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){if(!e.lengthComputable)return!0;var a=e.loaded||e.position,r=e.total;t.attr("data-progress",Math.round(a/r*100))},!1),e}),$.ajax(l)}),n.append(o),a.helper&&n.append(t),n}}(jQuery);
//# sourceMappingURL=/js/jquery.uploadzone.min.js.map
