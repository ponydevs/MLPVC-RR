DocReady.push(function(){"use strict";function e(){var e;c=d.children(".part-switch"),c.length&&(e=l.find(".resp-embed-wrap").children(),c.on("click",function(){e.toggleClass("hidden"),c.toggleHtml(["Part 2","Part 1"])}))}function t(e,r,l){e.children("button.reserve-request").off("click").on("click",function(i){i.preventDefault();var a="Reserving request",n=function(i){$.Dialog.wait(a,"Sending reservation to the server"),$.post("/reserving/request/"+r,i,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var i=$(this.li);e.replaceWith(i),window.updateTimes(),t(i,r,l),$.Dialog.close()}))};"string"==typeof s&&i.shiftKey?$.Dialog.request(a,'<form id="reserve-as"><label><span>Reserve as</span><input type="text" name="post_as" placeholder="Username" pattern="'+s+'" required></label></form>',"reserve-as","Reserve",function(e){e.on("submit",function(t){t.preventDefault(),n(e.mkData())})}):n({})}),e.children("em").children("a").last().on("click",function(e){e.preventDefault(),history.replaceState(history.state,"",this.href),a()});var c=e.find(".actions").children();c.filter(".cancel").off("click").on("click",function(){$.Dialog.confirm("Cancel reservation","Are you sure you want to cancel this reservation?",function(i){i&&($.Dialog.wait(!1,"Cancelling reservation"),$.post("/reserving/"+l+"/"+r+"?cancel",$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);if(this.remove===!0)return $.Dialog.close(),e.remove();var i=$(this.li);e.replaceWith(i),window.updateTimes(),t(i,r,l),$.Dialog.close()})))})}),c.filter(".finish").off("click").on("click",function(){$.Dialog.request("Finish reservation",'<form id="finish-res"><input type="text" name="deviation" placeholder="Deviation URL"></form>',"finish-res","Finish",function(e){e.on("submit",function(t){t.preventDefault();var a=e.find("[name=deviation]").val();if("string"!=typeof a||0===a.length)return $.Dialog.fail(!1,"Please enter a deviation URL");$.Dialog.wait(!1,"Marking reservation as finished");var s="/reserving/"+l+"/"+r+"?finish";$.post(s,{deviation:a},$.mkAjaxHandler(function(){var e=this,t=function(){$.Dialog.success(!1,"Reservation has been marked as finished"),i(l,n,o,function(){"string"==typeof e.message?$.Dialog.success(!1,e.message,!0):$.Dialog.close()})};e.status?t():e.retry?$.Dialog.confirm(!1,e.message,["Continue","Cancel"],function(i){i&&$.post(s,{deviation:a,allow_overwrite_reserver:!0},$.mkAjaxHandler(function(){return this.status?(e=this,void t()):$.Dialog.fail(!1,this.message)}))}):$.Dialog.fail(!1,e.message)}))})})}),c.filter(".unfinish").off("click").on("click",function(){var e=$(this),t=e.hasClass("delete-only"),a=l.charAt(0).toUpperCase()+l.substring(1),s=l.replace(/s$/,"");$.Dialog.request((t?"Delete":"Un-finish")+" "+s,'<form id="unbind-check"><p>Are you sure you want to '+(t?"delete this reservation":"mark this "+s+" as unfinished")+'?</p><hr><label><input type="checkbox" name="unbind"> Unbind '+s+" from user</label></form>","unbind-check","Un-finish",function(){var e=$("#unbind-check"),s=e.find("[name=unbind]");t||e.prepend('<div class="notice info">By removing the "finished" flag, the post will be moved back to the "List of '+a+'" section</div>'),"reservations"===l?(s.on("click",function(){$("#dialogButtons").children().first().val(this.checked?"Delete":"Un-finish")}),t&&s.trigger("click").off("click").on("click keydown touchstart",function(){return!1}).css("pointer-events","none").parent().hide(),e.append('<div class="notice warn">Because this '+(t?"reservation was added directly, it cannot be marked un-finished, only deleted.":"is a reservation, unbinding it from the user will <strong>delete</strong> it permanently.")+"</div>")):e.append('<div class="notice info">If this is checked, any user will be able to reserve this request again afterwards. If left unchecked, only the current reserver <em>(and Vector Inspectors)</em> will be able to mark it as finished until the reservation is cancelled.</div>'),$w.trigger("resize"),e.on("submit",function(e){e.preventDefault();var t=s.prop("checked");$.Dialog.wait(!1,'Removing "finished" flag'+(t?" & unbinding from user":"")),$.post("/reserving/"+l+"/"+r+"?unfinish"+(t?"&unbind":""),$.mkAjaxHandler(function(){return this.status?($.Dialog.success(!1,"undefined"!=typeof this.message?this.message:'"finished" flag removed successfully'),void i(l,n,o)):$.Dialog.fail(!1,this.message)}))})})}),c.filter(".check").off("click").on("click",function(e){e.preventDefault();var t=$(this);$.Dialog.wait("Deviation acceptance status","Checking"),$.post("/reserving/"+l+"/"+r+"?lock",$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);t.closest("li").children(".image").children("a").append($.mk("span").attr({"class":"typcn typcn-tick",title:"This submission has been accepted into the group gallery"}));var e=t.parent(),i=e.children(".edit").detach();i.text(i.attr("title")).removeAttr("title"),e.empty().append(i),this.message?$.Dialog.success(!1,this.message,!0):$.Dialog.close()}))}),c.filter(".delete").on("click",function(){var e=$(this);$.Dialog.confirm("Deleteing request","You are about to permanently delete this request.<br>Are you sure about this?",function(t){t&&($.Dialog.wait(!1,"Sending deletion request"),$.post("/reserving/request/"+r+"?delete",$.mkAjaxHandler(function(){return this.status?($.Dialog.close(),void e.closest("li").fadeOut(1e3,function(){$(this).remove()})):$.Dialog.fail(!1,this.message)})))})}),c.filter(".edit").on("click",function(){var e=$(this),t=e.parents("li"),a=t.attr("id").split("-"),s=a[1],r=a[0];$.Dialog.wait("Editing "+r+" #"+s,"Retrieving "+r+" details"),$.post("/post/get-"+r+"/"+s,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=this,a=$.mk("form").attr("id","post-edit-form").append($.mk("label").append($.mk("span").text("Description (3-255 chars."+("reservation"===r?", optional":"")+")"),$.mk("input").attr({type:"text",maxlength:255,pattern:"^.{3,255}$",name:"label",required:"reservation"!==r})));"request"===r&&a.append($.mk("label").append($.mk("span").text("Request type"),$.mk("select").attr({name:"type",required:!0}).append($.mk("option").attr("value","chr").text("Character"),$.mk("option").attr("value","obj").text("Object"),$.mk("option").attr("value","bg").text("Backgound")))),"string"==typeof e.posted&&a.append($.mk("label").append($.mk("span").text("Post timestamp"),$.mk("input").attr({type:"datetime",name:"date",required:!0,spellcheck:!1}))),0===t.children(".image").find(".typcn-tick").length&&a.append($.mk("label").append($.mk("a").text("Update Image").attr({href:"#update","class":"btn darkblue typcn typcn-pencil"}).on("click",function(e){e.preventDefault(),$.Dialog.close();var a=t.children(".image").find("img"),l=$.mk("form").attr("id","img-update-form").append($.mk("div").attr("class","align-center").append($.mk("span").text("Current image"),a.clone().one("load",function(){$.Dialog.center()})),$.mk("label").append($.mk("span").text("New image URL"),$.mk("input").attr({type:"text",maxlength:255,pattern:"^.{2,255}$",name:"image_url",required:!0,autocomplete:"off",spellcheck:"false"})));$.Dialog.request("Update image of "+r+" #"+s,l,"img-update-form","Update",function(e){e.on("submit",function(t){t.preventDefault();var a=e.mkData();$.Dialog.wait(!1,"Replacing image"),$.post("/post/set-"+r+"-image/"+s,a,$.mkAjaxHandler(function(){return this.status?($.Dialog.success(!1,"Image has been updated"),void i(r,n,o)):$.Dialog.fail(!1,this.message)}))})})}))),$.Dialog.request(!1,a,"post-edit-form","Save",function(i){var a,n=i.find("[name=label]"),o=i.find("[name=type]");if(e.label&&n.val(e.label),e.type&&o.children("option").filter(function(){return this.value===e.type}).attr("selected",!0),"string"==typeof e.posted){a=i.find("[name=date]");var l=moment(e.posted);a.val(l.format("YYYY-MM-DDTHH:mm:SSZ"))}i.on("submit",function(i){i.preventDefault();var l={label:n.val()};if("request"===r&&(l.type=o.val()),"string"==typeof e.posted){if(l.posted=new Date(a.val()),isNaN(l.posted.getTime()))return $.Dialog.fail(!1,"Post timestamp is invalid");l.posted=l.posted.toISOString()}$.Dialog.wait(!1,"Saving changes"),$.post("/post/set-"+r+"/"+s,l,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);if(this.label&&t.children(".label").text(this.label),this.type&&!t.parent().parent().hasClass("finished")){var e=$("#group-"+this.type).children("ul"),i=function(e){return new Date($(e).children("em").find("time").attr("datetime")).getTime()};e.append(t),e.children().sort(function(e,t){return i(e)-i(t)}).appendTo(e)}this.posted&&(t.children("em").find("time").attr("datetime",this.posted),window.updateTimes()),$.Dialog.close()}))})})}))})}function i(e,t,i,a){var n=e.charAt(0).toUpperCase()+e.substring(1);$.Dialog.wait(n,"Updating list"),$.post("/episode/"+e.replace(/([^s])$/,"$1s")+"/S"+t+"E"+i,$.mkAjaxHandler(function(){if(!this.status)return window.location.reload();var t=$("#"+e.replace(/([^s])$/,"$1s")),i=$(this.render).filter("section").children();t.empty().append(i).rebindHandlers().find(".post-form").data("type",e).formBind(),window.updateTimes(),"function"==typeof a?a():$.Dialog.close()}))}function a(e){$(".highlight").removeClass("highlight");var t=$(location.hash);t.length&&(t.addClass("highlight"),setTimeout(function(){$.scrollTo(t.offset().top-$navbar.outerHeight()-10,500,function(){"object"==typeof e&&"load"===e.type&&$.Dialog.close()})},1))}var n=window.SEASON,o=window.EPISODE,s=window.USERNAME_PATTERN,r="S"+n+"E"+o,l=$content.children("section.episode");$("#video").on("click",function(){$.Dialog.wait("Video links","Requesting links from the server"),$.post("/episode/getvideos/"+r,$.mkAjaxHandler(function(){var t=this;if(!t.status)return $.Dialog.fail(!1,t.message);var i=$.mk("form").attr("id","vidlinks").attr("class","align-center").append($.mk("p").text("Enter vido links below, leave any input blank to remove that video from the episode page."),$.mk("input").attr({type:"url","class":"yt",name:"yt_1",placeholder:"YouTube"}),$.mk("input").attr({type:"url","class":"dm",name:"dm_1",placeholder:"Dailymotion"}));if(t.twoparter){$.mk("p").html("<strong>~ Part 1 ~</strong>").insertBefore(i.children("input").first());var a={$yt:$.mk("input").attr({type:"url","class":"yt",name:"yt_2",placeholder:"YouTube"}),$dm:$.mk("input").attr({type:"url","class":"dm",name:"dm_2",placeholder:"Dailymotion"})};i.append($.mk("p").text("Check below if either link contains the full episode instead of just one part"),$.mk("div").append("<label><input type='checkbox' name='yt_1_full'> YouTube</label> &nbsp; <label><input type='checkbox' name='dm_1_full'> Dailymotion</label>"),$.mk("p").html("<strong>~ Part 2 ~</strong>"),a.$yt,a.$dm),i.find('input[type="checkbox"]').on("change",function(){a["$"+$(this).attr("name").replace(/^([a-z]+)_.*$/,"$1")].attr("disabled",this.checked)}),t.fullep.length>0&&$.each(t.fullep,function(e,t){i.find('input[type="checkbox"]').filter('[name="'+t+'_1_full"]').attr("checked",!0).trigger("change")})}if(Object.keys(t.vidlinks).length>0){var n=i.children("input").attr("spellcheck","false");$.each(t.vidlinks,function(e,t){n.filter("[name="+e+"]").val(t)})}$.Dialog.request(!1,i,"vidlinks","Save",function(t){t.on("submit",function(i){i.preventDefault();var a=t.mkData();$.Dialog.wait(!1,"Saving links"),$.post("/episode/setvideos/"+r,a,$.mkAjaxHandler(function(){return this.status?(this.epsection?(l.length||(l=$.mk("section").addClass("episode").insertBefore($content.children("section").first())),l.html($(this.epsection).filter("section").html()),e()):l.length&&l.remove(),void $.Dialog.close()):$.Dialog.fail(!1,this.message)}))})})}))});var c,d=l.children("h2");e();var u,p=$(".episode").find(".showplayers").on("scroll-video-into-view",function(){var e=$header.outerHeight();$.scrollTo(u.offset().top-($w.height()-$footer.outerHeight()-e-u.outerHeight())/2-e,500)}),h=p.parent();p.length&&p.on("click",function(t){if(t.preventDefault(),"undefined"==typeof u)$.Dialog.wait(p.text()),$.post("/episode/videos/"+r,$.mkAjaxHandler(function(){return this.status?(2===this[0]&&d.append('<button class="blue part-switch">Part 2</button>'),u=$.mk("div").attr("class","resp-embed-wrap").html(this[1]).insertAfter(h),e(),p.removeClass("typcn-eye green").addClass("typcn-eye-outline blue").text("Hide on-site player").triggerHandler("scroll-video-into-view"),void $.Dialog.close()):$.Dialog.fail(!1,this.message)}));else{var i=p.hasClass("typcn-eye");u.add(c)[i?"show":"hide"](),p.toggleClass("typcn-eye typcn-eye-outline").toggleHtml(["Show on-site player","Hide on-site player"]),i&&p.triggerHandler("scroll-video-into-view")}});var f=$("#voting"),m=f.children(".rate");if(m.on("click",function(e){e.preventDefault();var t=function(e){return $.mk("label").append($.mk("input").attr({type:"radio",name:"vote",value:e}),$.mk("span")).on("mouseenter mouseleave",function(e){var t=$(this),i=t.parent().find("input:checked"),a=i.parent(),n=t.closest("div").next().children("strong");switch(e.type){case"mouseleave":if(0===a.length){t.siblings().addBack().find(".typcn").attr("class",""),n.text("?");break}t=a;case"mouseenter":t.prevAll().addBack().children("span").attr("class","active"),t.nextAll().children("span").attr("class",""),n.text(t.children("input").attr("value"))}t.siblings().addBack().removeClass("selected"),a.addClass("selected")})},i=$.mk("form").attr("id","star-rating").append($.mk("p").text("Rate the episode on a scale of 1 to 5. This cannot be changed later."),$.mk("div").attr("class","rate").append(t(1),t(2),t(3),t(4),t(5)),$.mk("p").css("font-size","1.1em").append("Your rating: <strong>?</strong>/5"));$.Dialog.request("Rating "+r,i,"star-rating","Rate",function(e){e.on("submit",function(t){t.preventDefault();var i=e.mkData();return"undefined"==typeof i.vote?$.Dialog.fail(!1,"Please choose a rating by clicking on one of the muffins"):($.Dialog.wait(!1,"Submitting your rating"),void $.post("/episode/vote/"+r,i,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=m.closest("section");e.children("h2").nextAll().remove(),e.append(this.newhtml),f.bindDetails(),$.Dialog.close()})))})})}),f.find("time").data("dyntime-beforeupdate",function(e){return e.past===!0?m.length?void 0:($.post("/episode/vote/"+r+"?html",$.mkAjaxHandler(function(){return this.status?(f.children("h2").nextAll().remove(),f.append(this.html),void f.bindDetails()):$.Dialog.fail("Display voting buttons",this.message)})),$(this).removeData("dyntime-beforeupdate"),!1):void 0}),$.fn.bindDetails=function(){$(this).find("a.detail").on("click",function(e){e.preventDefault(),$.Dialog.wait("Voting details","Getting vote distribution information"),$.post("/episode/vote/"+r+"?detail",$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=$.mk("canvas").css({width:200,height:200,display:"block",margin:"0 auto"}),t=e.get(0).getContext("2d"),i=$.mk("p").attr("class","tooltip").html("&nbsp;");$.Dialog.info(!1,[$.mk("p").text("Here's a chart showing how the votes are distributed."),$.mk("div").attr("id","vote-distrib").append(e,i)]);var a=[void 0,"#FF5454","#FFB554","#FFFF54","#8CD446","#4DC742"],n=this.data,o=0;return $.each(n,function(e,t){$.extend(n[e],{color:a[parseInt(t.label,10)]}),o+=parseInt(t.value,10)}),0===o?(e.remove(),void i.text("There are no votes for this episode yet")):void new Chart(t).Pie(n,{animationEasing:"easeInOutExpo",customTooltips:function(e){if(!e)return void i.css("color","").html("&nbsp;");var t=e.text.split(": "),n=Math.round(parseInt(t[1],10)/o*1e3)/10;i.css("color",a[parseInt(t[0],10)]).empty().append($.mk("span").text(t[1]+" Ã—"),$.mk("span").attr("class","muffins cnt-"+t[0]),$.mk("span").text("("+n+"%)"))}})}))})},f.bindDetails(),$.fn.rebindHandlers=function(){var e=$(this);return e.find("li[id]").each(function(){var e=$(this),i=parseInt(e.attr("id").replace(/\D/g,"")),a=e.closest("section[id]").attr("id");$("section .unfinished .screencap > a").fluidbox({immediateOpen:!0,loader:!0}).on("openstart.fluidbox",function(){$body.addClass("no-distractions")}).on("closestart.fluidbox",function(){$body.removeClass("no-distractions")}),t(e,i,a)}),e},$("#requests, #reservations").rebindHandlers(),$.fn.formBind=function(){function e(e){var t=u.data("prev-url"),i="string"==typeof t&&t.trim()===u.val().trim();if(s.attr("disabled",e===!0||i),e===!0||i?s.attr("title","You need to change the URL before chacking again."):s.removeAttr("title"),"keyup"===e.type){var a=u.val();k.test(a)&&u.val(u.val().replace(k,""))}}function t(){var t=u.val(),i=v+" process";s.removeClass("red"),e(!0),$.Dialog.wait(i,"Checking image"),$.post("/post",{image_url:t},$.mkAjaxHandler(function(){function e(n,o){$.Dialog.wait(i,"Checking image availability"),m.attr("src",n.preview).show().off("load error").on("load",function(){h.children("p:not(.keep)").remove(),u.data("prev-url",t),n.title&&!p.val().trim()?$.Dialog.confirm("Confirm "+g+" title",'The image you just checked had the following title:<br><br><p class="align-center"><strong>'+n.title+"</strong></p><br>Would you like to use this as the "+g+"'s description?<br>Keep in mind that it should describe the thing(s) "+("request"===g?"being requested":"you plan to vector")+".<p>This dialog will not appear if you give your "+g+" a description before clicking the "+y+" button.</p>",function(e){return e?(p.val(n.title),void $.Dialog.close()):a.find("input[name=label]").focus()}):$.Dialog.close(function(){a.find("input[name=label]").focus()})}).on("error",function(){return 1>o?($.Dialog.wait("Can't load image","Image could not be loaded, retrying in 2 seconds"),void setTimeout(function(){e(n,o+1)},2e3)):void $.Dialog.fail(i,"There was an error while attempting to load the image. Make sure the URL is correct and try again!")})}var n=this;return n.status?void e(n,0):(h.children("p:not(.keep)").remove(),h.prepend($.mk("p").attr("class","color-red").html(n.message)).show(),m.hide(),$.Dialog.close())}))}var a=$(this),s=a.find(".check-img"),l=a.find(".upload-stash"),c=a.find(".img-preview"),d=a.find("[name=label]"),u=a.find("[name=image_url]"),p=a.find("[name=label]"),h=c.children(".notice"),f=h.html(),m=c.children("img"),g=a.data("type"),v=g.charAt(0).toUpperCase()+g.substring(1);0===m.length&&(m=$(new Image).appendTo(c)),$("#"+g+"-btn").on("click",function(){a.is(":visible")||(a.show(),d.focus(),$.scrollTo(a.offset().top-$navbar.outerHeight()-10,500))}),"reservation"===g&&$("#add-reservation-btn").on("click",function(){$.Dialog.request("Add a reservation",'<form id="add-reservation"><div class="notice info">This feature should only be used when the vector was made before the episode was displayed here, and all you want to do is link your already-made vector under the newly posted episode.</div><div class="notice warn">If you already posted the reservation, use the <strong class="typcn typcn-attachment">I\'m done</strong> button to mark it as finished instead of adding it here.</div><input type="text" name="deviation" placeholder="Deviation URL"></form>',"add-reservation","Finish",function(e){e.on("submit",function(t){t.preventDefault();var a=e.find("[name=deviation]").val();return"string"!=typeof a||0===a.length?$.Dialog.fail(!1,"Please enter a deviation URL"):($.Dialog.wait(!1,"Adding reservation"),void $.post("/reserving/reservation?add="+r,{deviation:a},$.mkAjaxHandler(function(){return this.status?($.Dialog.success(!1,this.message),void i(g,n,o)):$.Dialog.fail(!1,this.message)})))})})}),u.on("keyup change paste",e);var k=/^https?:\/\/www\.deviantart\.com\/users\/outgoing\?/,y='<strong class="typcn typcn-arrow-repeat" style="display:inline-block">Check image</strong>';s.on("click",function(e){e.preventDefault(),t()}),l.on("click",function(e){e.preventDefault(),$.Dialog.wait("Link from your Sta.sh","Looking for your Sta.sh uploads"),$.post("/upload-stash/get",$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=$.mk("form").attr("id","stash-item-select").append($.mk("p").html("<p>Select an image from the list below then click <strong>Use</strong>. Most recent images are shown first.</p><div class='notice info'>Since you've enabled Sta.sh upload, using a link from <em>your own</em> Sta.sh instead of selecting an image here will have the same effect.</div>")),i=$.mk("div").attr("class","selector").appendTo(e);$.each(this.items,function(e,t){i.append($.mk("label").append($.mk("input").attr({type:"radio",name:"itemid",value:t.itemid,required:!0}),$.mk("img").attr({src:t.image,title:t.name})))}),$.Dialog.request(!1,e,"stash-item-select","Use",function(e){e.on("submit",function(i){i.preventDefault();var a=e.mkData();s.attr("disabled",!1),u.val("http://sta.sh/"+parseInt(a.itemid).toString(36)),$.Dialog.close(),t()})})}))}),l.next("a.typcn-lock-open").on("click",function(e){e.preventDefault();var t=$(this),i=$(this).attr("data-redirect"),a=" authHandle"+i.replace(/^.*(\d{5})$/,"$1");$.Dialog.confirm("Enable Sta.sh upload","<p>In order to be able to link files from your Sta.sh, you must allow the site to read your files there. Don't worry, we won't delete or change them in any way.</p><p>This is neccessary because when you just paste the link into the field below, the site does not receive the URL of the full image afterwards, only a version which has its width capped at 1024px. If you use this method, your 1080p screenshots will be available here in full resolution.</p><p>If you don't feel comfortable allowing our site to read your Sta.sh, <strong>you can keep using links</strong>, but be aware that the resolution will be lower than you'd expect!</p><p><strong>If you want to revoke our acesss to your Sta.sh afterwards</strong>, go to your <a href='/u/'>Account</a> page and click the unlink button at the bottom of the page, then log in again.</p>",["Okay","I'd rather not"],function(e){if(e){$.Dialog.wait(!1,"Opening authorization request window"),window[a]=function(e){return e?(t.remove(),l.removeAttr("disabled").toggleClass("typcn-folder typcn-folder-open"),void $.Dialog.success(!1,"Authorization complete, you can now link from your Sta.sh",!0)):$.Dialog.fail(!1,"Sta.sh linking could not be enabled")};var n=window.open(i,"_blank");return!n||n.closed||"undefined"==typeof n.closed?$.Dialog.fail(!1,"It appears you have a pop-up blocker which didn't allow the authorization dialog to open. Please disable it and try again."):void $.Dialog.info(!1,'A new window/tab was opened to ask for your premission to access the files stored in your Sta.sh. Click "Allow" or "Deny", then come back to this page.')}})}),a.on("submit",function(e,t,s){e.preventDefault();var r=v+" process";if(!t&&u.data("prev-url")!==u.val())return $.Dialog.confirm(r,"You modified the image URL without clicking the "+y+" button.<br>Do you want to continue with the last checked URL?",function(e){e&&a.triggerHandler("submit",[!0])});if("undefined"==typeof u.data("prev-url"))return $.Dialog.fail(r,"Please click the "+y+" button before submitting your "+g+"!");if(!s&&"request"===g){var l=d.val(),c=a.find("select");if(l.indexOf("character")>-1&&"chr"!==c.val())return $.Dialog.confirm(r,"Your request label contains the word \"character\", but the request type isn't set to Character.<br>Are you sure you're not requesting one (or more) character(s)?",["Let me change the type","Carray on"],function(e){return e?void $.Dialog.close(function(){c.focus()}):a.triggerHandler("submit",[t,!0])})}var p=a.mkData({what:g,episode:o,season:n,image_url:u.data("prev-url")});$.Dialog.wait(r,"Submitting "+g),$.post("/post",p,$.mkAjaxHandler(function(){return this.status?($.Dialog.success(!1,v+" posted successfully"),void i(g,n,o)):$.Dialog.fail(!1,this.message)}))}).on("reset",function(){s.attr("disabled",!1).addClass("red"),h.html(f).show(),m.hide(),u.removeData("prev-url"),$(this).hide()})},$(".post-form").each($.fn.formBind),$w.on("hashchange",a),location.hash.length){var g=$content.find("img"),v=g.length,k=0;if(v>0&&$(location.hash).length>0){$.Dialog.wait("Scroll post into view","Waiting for page to load");var y=$.mk("progress").attr({max:v,value:0}).css({display:"block",width:"100%",marginTop:"5px"});$("#dialogContent").children("div:not([id])").last().addClass("align-center").append(y),$content.imagesLoaded().progress(function(e,t){t.isLoaded?y.attr("value",++k):y.attr("max",--v)}).always(function(){a({type:"load"})})}}});
//# sourceMappingURL=episode.min.js.map
