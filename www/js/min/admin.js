"use strict";DocReady.push(function(){function t(t){if("undefined"==typeof i){var e="<select name='minrole' required>\n\t\t\t\t\t<option value='' selected style='display:none'>Select one</option>\n\t\t\t\t\t<optgroup label=\"Available roles\">";$.each(l,function(t,n){"guest"!==t&&"ban"!==t&&(e+='<option value="'+t+'">'+n+"</option>")}),e+="</optgroup></select>",i=$.mk("form","link-editor").html('<label>\n\t\t\t\t\t<span>Label (3-35 chars.)</span>\n\t\t\t\t\t<input type="text" name="label" maxlength="35" pattern="'+a.replace("+","{3,35}")+'" required>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>URL (3-255 chars.)</span>\n\t\t\t\t\t<input type="text" name="url" maxlength="255" pattern="'+a.replace("+","{3,255}")+'" required>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>Title (optional, 3-70 chars.)</span>\n\t\t\t\t\t<input type="text" name="title" maxlength="70" pattern="'+a.replace("+","{3,70}")+'">\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>Role required to view</span>\n\t\t\t\t\t'+e+"\n\t\t\t\t</label>").on("submit",function(e){e.preventDefault();var n=$(this).serialize();$.Dialog.wait(!1),$.post("/admin/usefullinks/"+(t?"set/"+t:"make"),n,$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))})}return i.clone(!0,!0)}var e=$(".useful-links").find("ol"),n=$("#sidebar").find(".welcome .links"),i=void 0,a=$.attributifyRegex(window.PRINTABLE_ASCII_PATTERN),l=window.ROLES_ASSOC;e.on("click",".edit-link",function(){var e=$(this).closest("[id^=ufl-]").attr("id").substring(4);$.Dialog.wait("Editing link #"+e,"Retrieving link information from server"),$.post("/admin/usefullinks/get/"+e,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var n=this;$.Dialog.request(!1,t(e),"Save changes",function(t){t.find("input[name=label]").val(n.label),t.find("input[name=url]").val(n.url),t.find("input[name=title]").val(n.title),t.find("select[name=minrole]").val(n.minrole)})}))}),e.on("click",".delete-link",function(){var t=$(this).closest("[id^=ufl-]"),e=t.attr("id").substring(4);$.Dialog.confirm("Delete link #"+e,"Are you sure you want to delete this link?",function(i){i&&($.Dialog.wait(!1,"Removing link"),$.post("/admin/usefullinks/del/"+e,$.mkAjaxHandler(function(){return this.status?(t.remove(),$("#s-ufl-"+e).remove(),n.is(":empty")&&n.hide(),void $.Dialog.close()):$.Dialog.fail(!1,this.message)})))})}),$("#add-link").on("click",function(){$.Dialog.request("Add a link",t(),"Add")});var o=$("#reorder-links");o.on("click",function(){o.hasClass("typcn-tick")?!function(){$.Dialog.wait("Re-ordering links");var t=[];e.children().each(function(){t.push($(this).find(".typcn-arrow-move").remove().end().attr("id").split("-").pop())}),$.post("/admin/usefullinks/reorder",{list:t.join(",")},$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))}():(o.removeClass("typcn-arrow-unsorted darkblue").addClass("typcn-tick green").html("Save"),e.addClass("sorting").children().find(".buttons").append('<span class="btn darkblue typcn typcn-arrow-move"></span>'),new Sortable(e.get(0),{ghostClass:"moving",scroll:!0,animation:150,handle:".typcn-arrow-move"}))}),function(){function t(t){t=t.replace(/<img[^>]+>/g,"").match(e);var i={};$.each(t,function(t,e){var a=e.match(n);a&&"undefined"==typeof i[a[1]]&&(i[a[1]]=!0)});var a=Object.keys(i);return a?($.Dialog.wait("Bulk approve posts","Attempting to approve "+a.length+" post"+(1!==a.length?"s":"")),void $.post("/post/mass-approve",{ids:a.join(",")},$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var t=this.message,e=function(){t?$.Dialog.success(!1,t,!0):$.Dialog.close()};this.reload?($.Dialog.wait(!1,"Reloading page"),$.Navigation.reload(e)):e()}))):$.Dialog.fail("No deviations found on the pasted page.")}$(".mass-approve").children(".textarea").on("paste",function(e){var n=void 0,i=void 0,a=void 0,l=this;if(e.originalEvent.clipboardData&&e.originalEvent.clipboardData.types&&e.originalEvent.clipboardData.getData&&(n=e.originalEvent.clipboardData.types,n instanceof DOMStringList&&n.contains("text/html")||n.indexOf&&n.indexOf("text/html")!==-1))return i=e.originalEvent.clipboardData.getData("text/html"),t(i),e.stopPropagation(),e.preventDefault(),!1;for(a=document.createDocumentFragment();l.childNodes.length>0;)a.appendChild(l.childNodes[0]);return function o(e,n){if(e.childNodes&&e.childNodes.length>0){var i=e.innerHTML;e.innerHTML="",e.appendChild(n),t(i)}else setTimeout(function(){o(e,n)},20)}(l,a),!0});var e=/(?:[A-Za-z\-\d]+\.)?deviantart\.com\/art\/(?:[A-Za-z\-\d]+-)?(\d+)/g,n=/\/(?:[A-Za-z\-\d]+-)?(\d+)$/}()});
//# sourceMappingURL=/js/min/admin.js.map
