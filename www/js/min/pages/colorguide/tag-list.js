"use strict";$(function(){var u=window.TAG_TYPES_ASSOC,a=$("#tags").children("tbody"),h=function(t,e){if(!this.status)return $.Dialog.fail(!1,this.message);if("function"==typeof t)return t.call(this,e);t.remove(),$.Dialog.success(!1,this.message);var n=window.location.pathname;0===a.children().length&&(n=n.replace(/(\d+)$/,function(t){return 1<t?t-1:t})),$.toPage(n,!0,!0)},n=function(t){return $.mkAjaxHandler(function(){if(this.status||$.Dialog.fail(!1,this.message),this.counts){var n=this.counts;a.children().each(function(){var t=$(this).children(),e=parseInt(t.first().text().trim(),10);void 0!==n[e]&&t.last().children("span").text(n[e])})}t?$.Dialog.success(!1,this.message,!0):$.Dialog.close()})};window.CGTagEditing=function(a,r,l,c){switch(l){case"delete":$.Dialog.confirm("Delete tag: "+a,"Deleting this tag will also remove it from every appearance where it's been used.<br>Are you sure?",["Delete it","Nope"],function(t){t&&($.Dialog.wait(!1,"Sending removal request"),$.post("/cg/tag/del/"+r,$.mkAjaxHandler(function(){h.call(this,c,l)})))});break;case"synon":case"merge":var g="merge"===l,e=g?"Merge":"Synonymize";$.Dialog.wait(e+" "+a+" "+(g?"into":"with")+" another tag","Retrieving tag list from server"),$.get("/api/cg/tags",{not:r,action:l},$.mkAjaxHandler(function(){if(!this.length)return this.undo?window.CGTagEditing.call(this,a,r,"unsynon",c):$.Dialog.fail(!1,this.message);var t=$.mk("form","tag-"+l),i=$.mk("select").attr("required",!0).attr("name","targetid"),o={},s=[];$.each(this,function(t,e){var n=e.type,a='<option value="'+e.id+'">'+e.name+"</option>";if(!n)return i.append(a);void 0===o[n]&&(o[n]=$.mk("optgroup").attr("label",u[n]),s.push(n)),o[n].append(a)}),$.each(s,function(t,e){i.append(o[e])}),t.append("<p>"+(g?"Merging a tag into another will permanently delete it, while replacing it with the merge target on every appearance which used it.":"Synonymizing a tag will keep both tags in the database, but when searching, the source tag will automatically redirect to the target tag.")+"</p>",$.mk("label").append("<span>"+e+" <strong>"+a+"</strong> "+(g?"into":"with")+" the following:</span>",i)),$.Dialog.request(!1,t,e,function(n){n.on("submit",function(t){t.preventDefault();var e=n.mkData();$.Dialog.wait(!1,(g?"Merging":"Synonymizing")+" tags"),$.post("/cg/tag/"+l+"/"+r,e,$.mkAjaxHandler(function(){h.call(this,c,l)}))})})}));break;case"unsynon":var i=this.message;$.Dialog.close(function(){$.Dialog.confirm("Remove synonym from "+a,i,["Yes, continueâ€¦","Cancel"],function(t){if(t){var e=$.mk("div").html(i).find("strong").prop("outerHTML"),n=$.mk("form","synon-remove").html("<p>If you leave the option below checked, <strong>"+a+"</strong> will be added to all appearances where "+e+" is used, preserving how the tags worked while the synonym was active.</p>\n\t\t\t\t\t\t\t\t<p>If you made these tags synonyms by accident and don't want <strong>"+a+"</strong> to be added to each appearance where "+e+' is used, you should uncheck the box below.</p>\n\t\t\t\t\t\t\t\t<label><input type="checkbox" name="keep_tagged" checked><span>Preserve current tag connections</span></label>');$.Dialog.request(!1,n,"Remove synonym",function(n){n.on("submit",function(t){t.preventDefault();var e=n.mkData();$.Dialog.wait(!1,"Removing synonym"),$.post("/cg/tag/unsynon/"+r,e,$.mkAjaxHandler(function(){h.call(this,c,l)}))})})}})});break;case"refresh":$.Dialog.wait("Refresh use count of "+a,"Updating use count"),$.post("/cg/tags/recount-uses",{tagids:r},n())}},a.on("click","button",function(t){t.preventDefault();var e=$(this).parents("tr"),n=e.children().eq(1).text().trim(),a=parseInt(e.children().first().text().trim(),10),i=this.className.split(" ").pop();window.CGTagEditing(n,a,i,e)}),$(".refresh-all").on("click",function(){var t=[];a.children().each(function(){t.push($(this).children().first().text().trim())}),$.Dialog.wait("Recalculate tag usage data","Updating use count"+(1!==t.length?"s":"")),$.post("/cg/tags/recount-uses",{tagids:t.join(",")},n(!0))})});
//# sourceMappingURL=/js/min/pages/colorguide/tag-list.js.map
