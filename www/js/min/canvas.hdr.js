"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};/*!
 * 'hdr2d' Canvas Context
 * Copyright (c) 2012 Brian Reavis, http://thirdroute.com/
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * 'Software'), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
!function(a){var t=function(t){return void 0!==a[t]||("undefined"!=typeof console&&console.log("Warning: 'hdr2d' canvas context not supported ("+t+" needed)"),!1)};if(t("HTMLCanvasElement")&&t("ArrayBuffer")&&t("Float32Array")){a.HDR2D_BLEND_SRC=0,a.HDR2D_BLEND_DST=1,a.HDR2D_BLEND_CLEAR=2,a.HDR2D_BLEND_XOR=3,a.HDR2D_BLEND_OVER=4,a.HDR2D_BLEND_IN=5,a.HDR2D_BLEND_OUT=6,a.HDR2D_BLEND_ATOP=7,a.HDR2D_BLEND_DST_OVER=8,a.HDR2D_BLEND_DST_IN=9,a.HDR2D_BLEND_DST_OUT=10,a.HDR2D_BLEND_DST_ATOP=11,a.HDR2D_BLEND_ADD=12,a.HDR2D_BLEND_SUBTRACT=13,a.HDR2D_BLEND_MULTIPLY=14,a.HDR2D_BLEND_AVERAGE=15,a.HDR2D_BLEND_SCREEN=16,a.HDR2D_BLEND_SOFTLIGHT=17,a.HDR2D_BLEND_HARDLIGHT=18,a.HDR2D_BLEND_OVERLAY=19;var e=document.createElement("canvas");e.width=1,e.height=1;var n=e.getContext("2d").getImageData(0,0,1,1),h=function(a,t){this.width=a,this.height=t,this.data=new Float32Array(new ArrayBuffer(a*t*16))},o=function(){var a={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0000ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},t=function(a,t,e){return e<0&&e++,e>1&&e--,6*e<1?a+(t-a)*e*6:2*e<1?t:3*e<2?a+(t-a)*(2/3-e)*6:a};return function(e){if(e=e.replace(/^\s\s*/,"").replace(/\s*\s$/,"").toLowerCase(),a.hasOwnProperty(e)&&(e="#"+a[e]),"#"===e.charAt(0))return 4===e.length&&(e=["#",e.charAt(1),e.charAt(1),e.charAt(2),e.charAt(2),e.charAt(3),e.charAt(3)].join("")),{r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16),a:255};var i=e.indexOf("("),n=e.indexOf(")",i),h=e.substring(0,i).replace(/\s/g,""),o=e.substring(i+1,n).split(","),r=o.length>3?255*parseFloat(o[3]):255;switch(h){case"rgb":case"rgba":return{r:parseFloat(o[0]),g:parseFloat(o[1]),b:parseFloat(o[2]),a:r};case"hsl":case"hsla":var d=parseFloat(o[0])/360,f=parseFloat(o[1])/100,l=parseFloat(o[2])/100,D=l<=.5?l*(f+1):l+f-l*f,g=2*l-D;return{r:255*t(g,D,d+1/3),g:255*t(g,D,d),b:255*t(g,D,d-1/3),a:r}}return{r:0,g:0,b:0,a:0}}}(),r=function(a){console.log("new instance"),this.canvas=a,this.initialize()};r.prototype.fillStyle="#000000",r.prototype.globalAlpha=1,r.prototype.globalBlendMode=HDR2D_BLEND_OVER,r.prototype.range={r:{low:0,high:255},g:{low:0,high:255},b:{low:0,high:255},a:{low:0,high:255}},r.prototype.getBlendFunction=function(){var a={};return a[HDR2D_BLEND_SRC]={component:function(a,t,e){return a*e},alpha:function(a){return a}},a[HDR2D_BLEND_DST]={component:function(a,t,e,i){return t*i},alpha:function(a,t){return t}},a[HDR2D_BLEND_CLEAR]={component:function(){return 0},alpha:function(){return 0}},a[HDR2D_BLEND_XOR]={component:function(a,t,e,i){return a*e*(1-i)+t*i*(1-e)},alpha:function(a,t){return a+t-2*a*t}},a[HDR2D_BLEND_OVER]={component:function(a,t,e,i){return a*e+t*i*(1-e)},alpha:function(a,t){return a+t-a*t}},a[HDR2D_BLEND_IN]={component:function(a,t,e,i){return a*e*i},alpha:function(a,t){return a*t}},a[HDR2D_BLEND_OUT]={component:function(a,t,e,i){return a*e*(1-i)},alpha:function(a,t){return a*(1-t)}},a[HDR2D_BLEND_ATOP]={component:function(a,t,e,i){return a*e*i+t*i*(1-e)},alpha:function(a,t){return t}},a[HDR2D_BLEND_DST_OVER]={component:function(a,t,e,i){return t*i+a*e*(1-i)},alpha:function(a,t){return a+t-a*t}},a[HDR2D_BLEND_DST_IN]={component:function(a,t,e,i){return t*i*e},alpha:function(a,t){return a*t}},a[HDR2D_BLEND_DST_OUT]={component:function(a,t,e,i){return t*i*(1-e)},alpha:function(a,t){return t*(1-a)}},a[HDR2D_BLEND_DST_ATOP]={component:function(a,t,e,i){return t*i*e+a*e*(1-i)},alpha:function(a){return a}},a[HDR2D_BLEND_ADD]={component:function(a,t,e,i){return t*i+a*e},alpha:a[HDR2D_BLEND_OVER].alpha},a[HDR2D_BLEND_SUBTRACT]={component:function(a,t,e,i){return t*i-a*e},alpha:a[HDR2D_BLEND_OVER].alpha},a[HDR2D_BLEND_MULTIPLY]={component:function(a,t,e,i){return a*t/255*e+t*i*(1-e)},alpha:a[HDR2D_BLEND_OVER].alpha},a[HDR2D_BLEND_AVERAGE]={component:function(a,t,e,i){return(a+t)/2*e+t*i*(1-e)},alpha:a[HDR2D_BLEND_OVER].alpha},a[HDR2D_BLEND_SCREEN]={component:function(a,t,e,i){return(255-(Math.round((255-a)*(255-t))>>8))*e+t*i*(1-e)},alpha:a[HDR2D_BLEND_OVER].alpha},a[HDR2D_BLEND_OVERLAY]={component:function(a,t,e,i){return(a>128?2*t*a/255:255-2*(255-t)*(255-a)/255)*e+t*i*(1-e)},alpha:a[HDR2D_BLEND_OVER].alpha},a[HDR2D_BLEND_SOFTLIGHT]={component:function(a,t,e,i){return(t<128?2*(64+(Math.round(a)>>1))*(t/255):255-2*(255-(64+(Math.round(a)>>1)))*(255-t)/255)*e+t*i*(1-e)},alpha:a[HDR2D_BLEND_OVER].alpha},a[HDR2D_BLEND_HARDLIGHT]={component:function(a,t,e,i){return(a<128?2*t*a/255:255-2*(255-t)*(255-a)/255)*e+t*i*(1-e)},alpha:a[HDR2D_BLEND_OVER].alpha},function(t){return a[t]}}(),r.prototype.initialize=function(){this._context=this.canvas.getContext("2d"),this._imageData=this._context.getImageData(0,0,this.canvas.width,this.canvas.height),this.imageData=new h(this.canvas.width,this.canvas.height)},r.prototype.clearRect=function(a,t,e,i){var n=void 0,h=void 0,o=void 0,r=Math.max(0,Math.min(this.imageData.width,a)),d=Math.max(0,Math.min(this.imageData.height,t)),f=Math.max(0,Math.min(this.imageData.width,a+e)),l=Math.max(0,Math.min(this.imageData.height,t+i));for(h=d;h<l;h++)for(o=r;o<f;o++)n=4*(h*this.imageData.width+o),this.imageData.data[n]=0,this.imageData.data[n+1]=0,this.imageData.data[n+2]=0,this.imageData.data[n+3]=0;this.invalidate(r,d,f-r,l-d)},r.prototype.fillRect=function(a,t,e,i){"object"!==_typeof(this.fillStyle)&&(this.fillStyle=o(this.fillStyle));var n=void 0,h=void 0,r=void 0,d=Math.max(0,Math.min(this.imageData.width,a)),f=Math.max(0,Math.min(this.imageData.height,t)),l=Math.max(0,Math.min(this.imageData.width,a+e)),D=Math.max(0,Math.min(this.imageData.height,t+i)),g=this.getBlendFunction(this.globalBlendMode);for(h=f;h<D;h++)for(r=d;r<l;r++){n=4*(h*this.imageData.width+r);var s=this.imageData.data[n+3]/255,m=this.fillStyle.a*this.globalAlpha/255;this.imageData.data[n]=g.component(this.fillStyle.r,this.imageData.data[n],m,s),this.imageData.data[n+1]=g.component(this.fillStyle.g,this.imageData.data[n+1],m,s),this.imageData.data[n+2]=g.component(this.fillStyle.b,this.imageData.data[n+2],m,s),this.imageData.data[n+3]=255*g.alpha(m,s)}this.invalidate(d,f,l-d,D-f)},r.prototype.setPixel=function(a,t,e){var i=4*(Math.round(a)+Math.round(t)*this.imageData.width),h=this.getBlendFunction(this.globalBlendMode);void 0===e.a&&(e.a=255);var o=this.imageData.data[i+3]/255,r=e.a*this.globalAlpha/255;this.imageData.data[i]=h.component(e.r,this.imageData.data[i],r,o),this.imageData.data[i+1]=h.component(e.g,this.imageData.data[i+1],r,o),this.imageData.data[i+2]=h.component(e.b,this.imageData.data[i+2],r,o),this.imageData.data[i+3]=255*h.alpha(r,o),this._imageData.data[i]=n.data[0]=(this.imageData.data[i]-this.range.r.low)/(this.range.r.high-this.range.r.low)*255,this._imageData.data[i+1]=n.data[1]=(this.imageData.data[i+1]-this.range.g.low)/(this.range.g.high-this.range.g.low)*255,this._imageData.data[i+2]=n.data[2]=(this.imageData.data[i+2]-this.range.b.low)/(this.range.b.high-this.range.b.low)*255,this._imageData.data[i+3]=n.data[3]=(this.imageData.data[i+3]-this.range.a.low)/(this.range.a.high-this.range.a.low)*255,this._context.putImageData(n,a,t,0,0,1,1)},r.prototype.getPixel=function(a,t){var e=4*(Math.round(a)+Math.round(t)*this.imageData.width);return{r:this.imageData.data[e],g:this.imageData.data[e+1],b:this.imageData.data[e+2],a:this.imageData.data[e+3]}},r.prototype.getImageData=function(a,t,e,i){if(0===a&&0===t&&e===this.imageData.width&&i===this.imageData.height)return this.imageData;var n=Math.min(e,this.imageData.width-a),o=Math.min(i,this.imageData.height-t),r=a+n,d=t+o,f=new h(n,o),l=void 0,D=void 0,g=void 0,s=0;for(D=t;D<d;D++)for(l=a;l<r;l++)g=4*(D*this.imageData.width+l),f.data[s++]=this.imageData.data[g],f.data[s++]=this.imageData.data[g+1],f.data[s++]=this.imageData.data[g+2],f.data[s++]=this.imageData.data[g+3];return f},r.prototype.drawImage=function(a,t,e,i,n){var h=arguments,o=a.width,r=a.height;arguments.length>5&&(o=h[3],r=h[4],t=h[5],e=h[6],i=h[7],n=h[8]),t=t||0,e=e||0,i=i||o,n=n||r;var d=document.createElement("canvas");d.width=this.imageData.width,d.height=this.imageData.height;var f=d.getContext("2d");f.globalAlpha=1,f.drawImage.apply(f,h);var l=void 0,D=void 0,g=void 0,s=void 0,m=void 0,c=this.getBlendFunction(this.globalBlendMode),u=f.getImageData(0,0,this.imageData.width,this.imageData.height).data,p=Math.max(0,Math.floor(t)),_=Math.max(0,Math.floor(e)),b=Math.min(this.imageData.width,Math.ceil(t+i)),w=Math.min(this.imageData.height,Math.ceil(e+n));for(g=_;g<w;g++)for(D=p;D<b;D++)l=4*(g*this.imageData.width+D),m=this.imageData.data[l+3]/255,s=u[l+3]*this.globalAlpha/255,this.imageData.data[l]=c.component(u[l],this.imageData.data[l],s,m),this.imageData.data[l+1]=c.component(u[l+1],this.imageData.data[l+1],s,m),this.imageData.data[l+2]=c.component(u[l+2],this.imageData.data[l+2],s,m),this.imageData.data[l+3]=255*c.alpha(s,m);this.invalidate(p,_,b-p,w-_)},r.prototype.invalidate=function(a,t,e,n){var h=void 0,o=void 0,r=void 0,d=void 0,f=void 0,l=[this.range.r,this.range.g,this.range.b,this.range.a];if(void 0===a&&(a=0),void 0===t&&(t=0),void 0===e&&(e=this.imageData.width),void 0===n&&(n=this.imageData.height),0===a&&0===t&&e===this.imageData.width&&n===this.imageData.height)for(var D=0,g=this.imageData.data.length;D<g;D++)f=l[D%4],this._imageData.data[D]=(this.imageData.data[D]-f.low)/(f.high-f.low)*255;else for(r=Math.min(a+e,this.imageData.width),d=Math.min(t+n,this.imageData.height),o=t;o<d;o++)for(h=a;h<r;h++)i=4*(o*this.imageData.width+h),this._imageData.data[i]=(this.imageData.data[i]-l[0].low)/(l[0].high-l[0].low)*255,this._imageData.data[i+1]=(this.imageData.data[i+1]-l[1].low)/(l[1].high-l[1].low)*255,this._imageData.data[i+2]=(this.imageData.data[i+2]-l[2].low)/(l[2].high-l[2].low)*255,this._imageData.data[i+3]=(this.imageData.data[i+3]-l[3].low)/(l[3].high-l[3].low)*255;this._context.putImageData(this._imageData,0,0)},a.ImageDataHDR=h,a.CanvasRenderingContextHDR2D=r,HTMLCanvasElement.prototype.getContext=function(){var a=HTMLCanvasElement.prototype.getContext;return function(){return"hdr2d"===arguments[0]?(void 0===this.__hdr2ctx&&(this.__hdr2ctx=new r(this)),this.__hdr2ctx):a.apply(this,arguments)}}()}}(window);
//# sourceMappingURL=/js/min/canvas.hdr.js.map
