"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();!function(e,t){var o={menubar:void 0,statusbar:void 0,picker:void 0},i=window.parent.Key,a={min:.004,max:32,step:1.1},n=function(){function t(){var o=this;_classCallCheck(this,t),this._$menubar=e("#menubar"),this._$menubar.children().children("a").on("click",function(t){t.preventDefault(),t.stopPropagation(),o._$menubar.addClass("open"),e(t.target).trigger("mouseenter")}).on("mouseenter",function(t){o._$menubar.hasClass("open")&&(o._$menubar.find("a.active").removeClass("active"),e(t.target).addClass("active").next().removeClass("hidden"))}),this._$filein=e.mk("input","screenshotin").attr({type:"file",accept:"image/png,image/jpeg",tabindex:-1,class:"fileinput"}).appendTo($body),this._$openImage=e("#open-image").on("click",function(e){e.preventDefault(),o._$filein.trigger("click")}),this._$clearImage=e("#clear-image").on("click",function(t){t.preventDefault(),e.Dialog.confirm("Clear image","Are you sure you want to clear the current image?",function(e){e&&(r.getInstance().clearImage(),o._$clearImage.addClass("disabled"))})}),this._$filein.on("change",function(){o._$filein.val()&&(o._$openImage.addClass("disabled"),o.setFile(o._$filein[0].files[0],function(e){o._$openImage.removeClass("disabled"),!0===e&&o._$clearImage.removeClass("disabled")}))}),$body.on("click",function(){o._$menubar.removeClass("open"),o._$menubar.find("a.active").removeClass("active"),o._$menubar.children("li").children("ul").addClass("hidden")})}return _createClass(t,[{key:"setFile",value:function(t,o){if(!/^image\/(png|jpeg)$/.test(t.type))return e.Dialog.fail("Invalid file","You may only use PNG or JPG images with this tool"),void o(!1);var i=new FileReader;i.onload=function(){r.getInstance().setImage(i.result,o)},i.readAsDataURL(t)}}],[{key:"getInstance",value:function(){return void 0===o.menubar&&(o.menubar=new t),o.menubar}}]),t}(),s=function(){function t(){var o=this;_classCallCheck(this,t),this._$el=e("#statusbar"),this._$info=this._$el.children(".info"),this._$pos=this._$el.children(".pos"),this._$colorat=this._$el.children(".colorat").children(),this.infoLocked=!1,this.Pos={mouse:"mousepos",imageTopLeft:"imagetl",imageCenter:"imagec",pickerCenter:"pickerc"},this["_$"+this.Pos.mouse]=this._$pos.children(".mouse"),this["_$"+this.Pos.imageTopLeft]=this._$pos.children(".image-top-left"),this["_$"+this.Pos.imageCenter]=this._$pos.children(".image-center"),this["_$"+this.Pos.pickerCenter]=this._$pos.children(".picker-center"),e.each(this.Pos,function(e){o.setPosition(e)})}return _createClass(t,[{key:"lockInfo",value:function(){this.infoLocked=!0}},{key:"unlockInfo",value:function(){this.infoLocked=!1}},{key:"setInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.infoLocked||this._$info.text(e)}},{key:"setPosition",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{top:"?",left:"?"},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=this.Pos[t];if("string"!=typeof a)throw new Error("[Statusbar.setPosition] Invalid position display key: "+t);1!==i&&(o.left*=i,o.top*=i),this["_$"+a].text((isNaN(o.left)?"?":e.roundTo(o.left,2))+","+(isNaN(o.top)?"?":e.roundTo(o.top,2)))}},{key:"setColorAt",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t.length?this._$colorat.css({backgroundColor:t,color:e.yiq(t)>127?"black":"white"}):this._$colorat.css({backgroundColor:"",color:""}),this._$colorat.text(t||"UNKNOWN")}},{key:"debug",value:function(e){this._$pos[e?"addClass":"removeClass"]("debug")}}],[{key:"getInstance",value:function(){return void 0===o.statusbar&&(o.statusbar=new t),o.statusbar}}]),t}(),r=function(){function t(){var o=this;_classCallCheck(this,t),this._mousepos={top:NaN,left:NaN},this._zoomlevel=1,this._movehandler=null,this._hasImage=!1,this._$picker=e("#picker"),this._wrapheight=this._$picker.height(),this._wrapwidth=this._$picker.width(),this._$imageOverlay=e.mk("div").attr("class","image-overlay").appendTo(this._$picker),this._$imageCanvas=e.mk("canvas").attr("class","image-element"),this._$imgcExpected=e.mk("span").attr("class","imgc-expected"),this._$svgElement=e(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr({class:"svg-element",version:"1.1",xmlns:"http://www.w3.org/2000/svg"}),this._$svgWrap=e.mk("div").attr("class","svg-wrap").append(this._$svgElement),this._$zoomperc=e.mk("span").attr({class:"zoom-perc","data-info":"Current zoom level (Click to enter a custom value)",contenteditable:!0}).text("100%").on("keydown",function(t){if(e.isKey(i.Enter,t)){t.preventDefault();var a=parseFloat(o._$zoomperc.text());isNaN(a)||o.setZoomLevel(a/100),o.updatePositions()}}).on("mousedown",function(){o._$zoomperc.data("mousedown",!0)}).on("mouseup",function(){o._$zoomperc.data("mousedown",!1)}).on("click",function(){!0!==o._$zoomperc.data("focused")&&(o._$zoomperc.data("focused",!0),o._$zoomperc.select())}).on("dblclick",function(e){e.preventDefault(),o._$zoomperc.select()}).on("blur",function(){o._$zoomperc.data("mousedown")||o._$zoomperc.data("focused",!1),0===o._$zoomperc.html().trim().length&&o.updateZoomLevel(),e.clearSelection()}),this._$zoomfit=e.mk("button").attr({class:"zoom-fit typcn typcn typcn-arrow-minimise","data-info":"Fit in view (Ctrl+0)"}).on("click",function(e){e.preventDefault(),o.setZoomFit()}),this._$zoomorig=e.mk("button").attr({class:"zoom-orig typcn typcn typcn-zoom","data-info":"Original size (Ctrl+1)"}).on("click",function(e){e.preventDefault(),o.setZoomOriginal()}),this._$zoomin=e.mk("button").attr({class:"zoom-in typcn typcn-zoom-in","data-info":"Zoom in (Ctrl/Alt+Scroll Up)"}).on("click",function(e,t){e.preventDefault(),o.setZoomLevel(o._zoomlevel*a.step,t)}),this._$zoomout=e.mk("button").attr({class:"zoom-out typcn typcn-zoom-out","data-info":"Zoom out (Ctrl/Alt+Scroll Down)"}).on("click",function(e,t){e.preventDefault(),o.setZoomLevel(o._zoomlevel/a.step,t)}),this._$actionTopLeft=e.mk("div").attr("class","actions actions-tl").append(this._$zoomin,this._$zoomout,this._$zoomfit,this._$zoomorig,this._$zoomperc).on("mousedown",function(e){e.stopPropagation(),o._$zoomperc.triggerHandler("blur")}),this._$actionsBottomLeft=e.mk("div").attr("class","actions actions-bl").append("Unused panel").on("mousedown",function(e){e.stopPropagation(),o._$zoomperc.triggerHandler("blur")}),this._$loader=e.mk("div").attr("class","loader"),$w.on("resize",this.resizeHandler),this.resizeHandler(),this._$picker.append(this._$actionTopLeft,this._$actionsBottomLeft,this._$loader,this._$imgcExpected,this._$svgWrap),$body.on("mousemove",e.throttle(50,function(t){if(o._hasImage){var i=o.getWrapPosition(),a=o.getImagePosition(),n=o.getImageSize();if(o._mousepos.top=t.pageY-i.top,o._mousepos.left=t.pageX-i.left,o._mousepos.top<a.top||o._mousepos.top>a.top+n.height||o._mousepos.left<a.left||o._mousepos.left>a.left+n.width)o._mousepos.top=NaN,o._mousepos.left=NaN,s.getInstance().setColorAt();else{o._mousepos.top=Math.floor((o._mousepos.top-Math.floor(a.top))/o._zoomlevel),o._mousepos.left=Math.floor((o._mousepos.left-Math.floor(a.left))/o._zoomlevel);var r=o._$imageCanvas[0].getContext("2d").getImageData(o._mousepos.left,o._mousepos.top,1,1).data;s.getInstance().setColorAt(e.rgb2hex({r:r[0],g:r[1],b:r[2]}))}s.getInstance().setPosition("mouse",o._mousepos)}})),$w.on("mousewheel",function(e){if(e.ctrlKey||e.altKey){e.preventDefault();var t=o.getWrapPosition(),i={top:e.pageY-t.top,left:e.pageX-t.left};e.originalEvent.deltaY>0?o._$zoomout.trigger("click",[i]):o._$zoomin.trigger("click",[i])}})}return _createClass(t,[{key:"getTopLeft",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getWrapCenterPosition(),i=e.left,a=e.top,n=o.left,s=o.top;return{top:s+t*(a-s),left:n+t*(i-n)}}},{key:"getImageSize",value:function(){return{width:this._$imageCanvas.width(),height:this._$imageCanvas.height()}}},{key:"getImagePosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._$imageCanvas.offset(),t=this.getWrapPosition();return{top:e.top-t.top,left:e.left-t.left}}},{key:"getImageCenterPosition",value:function(e,t){var o=this.getWrapPosition();return{top:e.top-o.top+t.height/2,left:e.left-o.left+t.width/2}}},{key:"getWrapCenterPosition",value:function(){return{top:this._wrapheight/2,left:this._wrapwidth/2}}},{key:"getWrapPosition",value:function(){var e=this._$picker.offset();return e.top-=(this._wrapheight-this._$picker.outerHeight())/2,e.left-=(this._wrapwidth-this._$picker.outerWidth())/2,e}},{key:"updateZoomLevel",value:function(){this._$zoomperc.text(e.roundTo(100*this._zoomlevel,2)+"%"),document.activeElement.blur(),this._$zoomout[this._zoomlevel<=a.min?"disable":"enable"](),this._$zoomin[this._zoomlevel>=a.max?"disable":"enable"]()}},{key:"updatePositions",value:function(e,t,o){if(this.updateZoomLevel(),"number"==typeof e){s.getInstance().setPosition("imageTopLeft",{top:e,left:t});var i=this.getImageCenterPosition(this._$imageCanvas.offset(),o);s.getInstance().setPosition("imageCenter",i),this._$imgcExpected.css({top:i.top-5,left:i.left-5}),s.getInstance().setPosition("pickerCenter",this.getWrapCenterPosition())}}},{key:"setZoomLevel",value:function(t,o){var i=this._$imageCanvas.data("size");if("object"===(void 0===i?"undefined":_typeof(i))){var n=e.rangeLimit(t,!1,a.min,a.max),s=void 0,r=void 0;n!==this._zoomlevel?(s=e.scaleResize(i.width,i.height,{scale:n}),r=this._zoomlevel,this._zoomlevel=s.scale):(s={width:this._$imageCanvas.width(),height:this._$imageCanvas.height()},r=this._zoomlevel);var l=this.getTopLeft(this.getImagePosition(),n/r,o);this._$imageOverlay.add(this._$imageCanvas).add(this._$svgWrap).css({top:l.top,left:l.left,width:s.width,height:s.height}),this._$svgElement.attr("viewBox","0 0 "+s.width+" "+s.height),this.updatePositions(l.top,l.left,s)}}},{key:"setZoomFit",value:function(){var t=this;this._fitImageHandler(function(o){var i=t._wrapwidth>t._wrapheight,a=o.width===o.height?i:o.width>o.height,n=e.scaleResize(o.width,o.height,a?{height:t._wrapheight}:{width:t._wrapwidth});return i&&(n.width>t._wrapwidth&&(n=e.scaleResize(n.width,n.height,{width:t._wrapwidth})),n.height>t._wrapheight&&(n=e.scaleResize(n.width,n.height,{height:t._wrapheight}))),i||(n.height>t._wrapheight&&(n=e.scaleResize(n.width,n.height,{height:t._wrapheight})),n.width>t._wrapwidth&&(n=e.scaleResize(n.width,n.height,{width:t._wrapwidth}))),n})}},{key:"setZoomOriginal",value:function(){this._fitImageHandler(function(e,t){return{width:e.width,height:e.height,scale:1}})}},{key:"_fitImageHandler",value:function(e){var t=this._$imageCanvas.data("size");if("object"===(void 0===t?"undefined":_typeof(t))){var o=e(t),i=(this._wrapheight-o.height)/2,a=(this._wrapwidth-o.width)/2;this._$imageOverlay.add(this._$imageCanvas).add(this._$svgWrap).css({top:i,left:a,width:o.width,height:o.height}),this._$svgElement.attr("viewBox","0 0 "+o.width+" "+o.height),this._zoomlevel=o.scale,this.setZoomLevel(this._zoomlevel)}}},{key:"resizeHandler",value:function(){var t=this;e.throttle(250,function(){t._wrapwidth=t._$picker.innerWidth(),t._wrapheight=t._$picker.innerHeight(),"number"==typeof t._zoomlevel&&t.setZoomLevel(t._zoomlevel),s.getInstance().setPosition("pickerCenter",t.getWrapCenterPosition()),t._$svgElement.attr("viewBox","0 0 "+t._wrapwidth+" "+t._wrapheight)})}},{key:"setImage",value:function(t,o){var i=this;if(this._$picker.hasClass("loading"))throw new Error("The picker is already loading another image");this._$picker.addClass("loading");var a=new Image;e(a).attr("src",t).on("load",function(){i._$picker.removeClass("loading"),i._$imageCanvas.css("opacity",0),i._$imageCanvas.appendTo(i._$picker).data("size",{width:a.width,height:a.height}),i._$imageCanvas[0].width=a.width,i._$imageCanvas[0].height=a.height,i._$imageCanvas[0].getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,a.width,a.height),i._$zoomfit.triggerHandler("click"),i._$imageCanvas.fadeTo(500,1);var t=void 0,n=void 0;i._movehandler=e.throttle(50,function(e){e.preventDefault();var o={top:e.pageY,left:e.pageX},a=i.getWrapPosition(),s=Math.round(Math.round((t.top+(o.top-n.top)-a.top)/i._zoomlevel)*i._zoomlevel),r=Math.round(Math.round((t.left+(o.left-n.left)-a.left)/i._zoomlevel)*i._zoomlevel);i._$imageOverlay.add(i._$imageCanvas).add(i._$svgWrap).css({top:s,left:r}),i.updatePositions(s,r,i.getImageSize())}),$body.on("mousedown",function(o){e(o.target).is(i._$imageOverlay)&&(o.preventDefault(),t=i._$imageOverlay.offset(),n={top:o.pageY,left:o.pageX},$body.on("mousemove",i._movehandler))}),$body.on("mouseup mouseleave blur",function(){$body.off("mousemove",i._movehandler)}),i._hasImage=!0,o(!0)}).on("error",function(){i._$picker.removeClass("loading"),e.Dialog.fail("Oh no","The provided image could not be loaded. This is usually caused by attempting to open a file that is, in fact, not an image."),o(!1)})}},{key:"clearImage",value:function(){this._hasImage&&("function"==typeof this._movehandler&&$body.off("mousemove",this._movehandler),this._$imageCanvas.detach(),this._$imageCanvas.removeData("size"),this._$imageCanvas[0].getContext("2d").clearRect(0,0,this._$imageCanvas[0].width,this._$imageCanvas[0].height),this._hasImage=!1,s.getInstance().setColorAt(),s.getInstance().setPosition("mouse"),this._zoomlevel=1,this.updateZoomLevel(),e.Dialog.close())}}],[{key:"getInstance",value:function(){return void 0===o.picker&&(o.picker=new t),o.picker}}]),t}();n.getInstance(),s.getInstance(),r.getInstance(),e(document).on("keydown",e.throttle(200,function(e){var t=e.target.tagName.toLowerCase();if(console.log(e.target),("input"!==t||"file"===e.target.type)&&"textarea"!==t&&null===e.target.getAttribute("contenteditable")){switch(e.keyCode){case i[0]:if(!e.ctrlKey||e.altKey)return;r.getInstance().setZoomFit().trigger("click");break;case i[1]:if(!e.ctrlKey||e.altKey)return;r.getInstance().setZoomOriginal().trigger("click");break;default:return}e.preventDefault()}})),e(document).on("paste","[contenteditable]",function(t){var o="",i=e(this);if(t.clipboardData?o=t.clipboardData.getData("text/plain"):window.clipboardData?o=window.clipboardData.getData("Text"):t.originalEvent.clipboardData&&(o=e.mk("div").text(t.originalEvent.clipboardData.getData("text"))),document.queryCommandSupported("insertText"))return document.execCommand("insertHTML",!1,e(o).html()),!1;i.find("*").each(function(){e(this).addClass("within")}),setTimeout(function(){i.find("*").each(function(){e(this).not(".within").contents().unwrap()})},1)}),$body.on("mouseenter","[data-info]",function(){s.getInstance().setInfo(e(this).attr("data-info"))}).on("mouseleave","[data-info]",function(){s.getInstance().setInfo()}),window.Plugin=o}(jQuery);
//# sourceMappingURL=/js/min/colorpicker.js.map
