{"version":3,"sources":["colorguide-manage.js"],"names":["$","reorder","$this","children","sort","a","b","regex","className","replace","innerHTML","trim","localeCompare","appendTo","createNewTag","$tag","name","title","$li","closest","$div","$tagsDiv","ponyID","attr","ponyName","text","Dialog","request","$tagEditForm","clone","$form","$ErrorNotice","handleError","html","this","message","parent","removeClass","addClass","show","find","center","append","mk","type","val","prop","document","createTextNode","on","e","preventDefault","tempdata","serializeArray","data","each","i","el","value","post","mkAjaxHandler","status","tags","qtip","window","tooltips","ctxmenus","close","call","CGEditorMaker","$group","dis","groupID","substring","$cgEditor","$label","editing","label","Colors","trigger","ponyid","$row","$ci","HEX_COLOR_PATTERN","test","colorid","hex","toUpperCase","parseInt","push","length","Error","JSON","stringify","cg","cgs","$tags","ctxmenu","icon","click","tagName","tagID","match","wait","tag","$affected","tid","removeAttr","eq","fail","confirm","sure","remove","$el","taglist","Bloodhound","datumTokenizer","tokenizers","obj","whitespace","queryTokenizer","remote","url","wildcard","insertKeys","$input","parents","filter","first","typeahead","display","source","templates","suggestion","Handlebars","compile","indexOf","keyCode","tag_name","$ponyTags","_focusedElement","focus","cancreate","new_name","nextAll","$colorGroups","color","groupName","Color","addItems","off","copy","default","parentNode","triggerItem","TAG_TYPES_ASSOC","MAX_SIZE","PRINTABLE_ASCII_REGEX","isWebkit","documentElement","style","$spriteUploadForm","uploadZone","requestKey","accept","target","href","urlToAbsolute","$uploadInput","$image_url","stopPropagation","image_url","path","forced","get","$list","info","next","$_typeSelect","$lbl","$chx","checked","siblings","hide","$colorPreview","$colorInput","class","pattern","toString","autocomplete","spellcheck","$cp","prev","valid","css","input","shortHex","f","setTimeout","$colorLabel","$colorActions","mkClrDiv","$cl","$ca","draggabilly","axis","containment","handle","pos","$colorRow","$container","$childs","draggie","ix","index","deltaY","position","y","direction","distY","Math","abs","round","$addBtn","$colors","_","empty"],"mappings":"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","file":"colorguide-manage.min.js","sourcesContent":["$(function(){\r\n\tvar Color = window.Color, color = window.color, TAG_TYPES_ASSOC = window.TAG_TYPES_ASSOC, $colorGroups,\r\n\t\tMAX_SIZE = window.MAX_SIZE, PRINTABLE_ASCII_REGEX = window.PRINTABLE_ASCII_REGEX,\r\n\t\tHEX_COLOR_PATTERN = window.HEX_COLOR_PATTERN, isWebkit = 'WebkitAppearance' in document.documentElement.style;\r\n\r\n\tvar $spriteUploadForm = $.mk('form').attr('id', 'sprite-img').html(\r\n\t\t'<p class=align-center><a href=#upload>Click here to upload a file</a> (max. '+MAX_SIZE+') or enter a URL below.</p>' +\r\n\t\t'<label><input type=text name=image_url placeholder=\"External image URL\" required></label>' +\r\n\t\t'<p class=align-center>The URL will be checked against the supported provider list, and if an image is found, it\\'ll be downloaded to the server and set as this appearance\\'s sprite image.</p>'\r\n\t);\r\n\r\n\t$('.upload-wrap').each(function(){\r\n\t\tvar $this = $(this),\r\n\t\t\tponyID = $this.closest('li').attr('id').substring(1);\r\n\r\n\t\t$this.uploadZone({\r\n\t\t\trequestKey: 'sprite',\r\n\t\t\ttitle: 'Upload sprite',\r\n\t\t\taccept: 'image/png',\r\n\t\t\ttarget: '/colorguide/setsprite/'+ponyID,\r\n\t\t}).on('uz-uploadstart',function(){\r\n\t\t\t$.Dialog.close();\r\n\t\t}).ctxmenu([\r\n\t\t\t{text: 'Open image in new tab', icon: 'arrow-forward', 'default': true, attr: {\r\n\t\t\t\thref: $this.find('img').attr('src'),\r\n\t\t\t\ttarget: '_blank',\r\n\t\t\t}},\r\n\t\t\t{text: 'Copy image URL', icon: 'clipboard', click: function(){\r\n\t\t\t\t$.copy($.urlToAbsolute($this.find('img').attr('src')));\r\n\t\t\t}},\r\n\t\t\t{text: 'Upload new sprite', icon: 'upload', click: function(){\r\n\t\t\t\tvar title = 'Upload sprite image',\r\n\t\t\t\t\tponyID = $this.closest('li').attr('id').substring(1),\r\n\t\t\t\t\t$uploadInput = $this.find('input[type=\"file\"]');\r\n\t\t\t\t$.Dialog.request(title,$spriteUploadForm.clone(),'sprite-img','Download image',function($form){\r\n\t\t\t\t\tvar $image_url = $form.find('input[name=image_url]');\r\n\t\t\t\t\t$form.find('a').on('click',function(e){\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\t\t$uploadInput.trigger('click', [true]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tvar image_url = $image_url.val();\r\n\r\n\t\t\t\t\t\t$.Dialog.wait(title, 'Downloading external image to the server');\r\n\r\n\t\t\t\t\t\t$.post('/colorguide/setsprite/'+ponyID,{image_url: image_url}, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tif (this.status) $uploadInput.trigger('set-image', [this.path]);\r\n\t\t\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}},\r\n\t\t], 'Sprite image').attr('title', isWebkit ? ' ' : '').on('click',function(e, forced){\r\n\t\t\tif (forced === true) return true;\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\t$this.data('ctxmenu-items').eq(1).children().get(0).click();\r\n\t\t});\r\n\t});\r\n\r\n\tvar $list = $('#list');\r\n\t$list.find('button.edit').on('click',function(){\r\n\t\t$.Dialog.info('Edit mode triggered', 'yay');\r\n\t}).next().on('click',function(){\r\n\t\tvar $this = $(this),\r\n\t\t\t$li = $this.closest('li'),\r\n\t\t\tponyID = $li.attr('id').substring(1),\r\n\t\t\tponyName = $this.parent().text().trim(),\r\n\t\t\ttitle = 'Deleting appearance: '+ponyName;\r\n\r\n\t\t$.Dialog.confirm(title,'Deleting this appearance will remove <strong>ALL</strong> of its color groups, the colors within them, and the sprite file, if any.<br>Delete anyway?',function(sure){\r\n\t\t\tif (!sure) return;\r\n\r\n\t\t\t$.Dialog.wait(title, 'Sending removal request');\r\n\r\n\t\t\t$.post('/colorguide/delete/'+ponyID,$.mkAjaxHandler(function(){\r\n\t\t\t\tif (this.status){\r\n\t\t\t\t\t$li.remove();\r\n\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t}));\r\n\t\t})\r\n\t});\r\n\r\n\tvar $tagEditForm = $.mk('form').attr('id', 'edit-tag');\r\n\t$tagEditForm\r\n\t\t.append('<label><span>Tag name (4-30 chars.)</span><input type=text name=name required pattern=^.{4,30}$ maxlength=30></label>');\r\n\tvar $_typeSelect = $.mk('div').addClass('type-selector');\r\n\t$.each(TAG_TYPES_ASSOC,function(type, label){\r\n\t\tvar $lbl = $.mk('label'),\r\n\t\t\t$chx = $.mk('input')\r\n\t\t\t\t.attr({\r\n\t\t\t\t\ttype: 'checkbox',\r\n\t\t\t\t\tname: 'type',\r\n\t\t\t\t\tvalue: type\r\n\t\t\t\t}).on('click keyup',function(){\r\n\t\t\t\t\tif (this.checked)\r\n\t\t\t\t\t\t$(this).parent().siblings().find('input').prop('checked', false);\r\n\t\t\t\t});\r\n\t\t$lbl.append($chx, $.mk('span').addClass('tag typ-'+type).text(label)).appendTo($_typeSelect);\r\n\t});\r\n\t$tagEditForm\r\n\t\t.append($.mk('div').addClass('align-center').append('<span>Tag type (optional)</span><br>',$_typeSelect))\r\n\t\t.append($.mk('label').append('<span>Tag description (max 255 chars., optional)</span><br><textarea name=title maxlength=255></textarea>'))\r\n\t\t.append($.mk('div').attr('class','notice').hide().html('<p></p>'));\r\n\r\n\tvar $tags = $('.tags');\r\n\tfunction reorder($this){\r\n\t\t$this.children().sort(function(a, b){\r\n\t\t\tvar regex = /^.*typ-([a-z]+).*$/;\r\n\t\t\ta = [a.className.replace(regex,'$1'), a.innerHTML.trim()];\r\n\t\t\tb = [b.className.replace(regex,'$1'), b.innerHTML.trim()];\r\n\r\n\t\t\tif (a[0] === b[0])\r\n\t\t\t\treturn a[1].localeCompare(b[1]);\r\n\t\t\treturn a[0].localeCompare(b[0]);\r\n\t\t}).appendTo($this);\r\n\t}\r\n\r\n\tfunction createNewTag($tag, name){\r\n\t\tvar title = 'Create new tag',\r\n\t\t\t$li = $tag.closest('li'),\r\n\t\t\t$div = $tag.closest('div:not([class])'),\r\n\t\t\t$tagsDiv = $div.children('.tags'),\r\n\t\t\tponyID = $li.attr('id').replace(/\\D/g, ''),\r\n\t\t\tponyName = $div.children('strong').text().trim();\r\n\r\n\t\t$.Dialog.request(title,$tagEditForm.clone(true, true),'edit-tag','Create',function($form){\r\n\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\thandleError = function(){\r\n\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t$form.find('input, texarea').attr('disabled', false);\r\n\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t};\r\n\t\t\t$form.append(\r\n\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t$.mk('input').attr({type:'checkbox',name:'addto'}).val(ponyID).prop('checked', typeof name === 'string'),\r\n\t\t\t\t\tdocument.createTextNode(' Add this tag to the appearance \"'+ponyName+'\" after creation')\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t\tif (typeof name === 'string') $form.find('input[name=name]').val(name);\r\n\t\t\t$.Dialog.center();\r\n\t\t\t$form.on('submit', function(e){\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\tvar tempdata = $form.serializeArray(), data = {};\r\n\t\t\t\t$.each(tempdata,function(i,el){\r\n\t\t\t\t\tdata[el.name] = el.value;\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$ErrorNotice.text('Creating tag...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t$.post('/colorguide/maketag',data,$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\tif (this.tags){\r\n\t\t\t\t\t\t\t$tagsDiv.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t$tagsDiv.html(this.tags);\r\n\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\tctxmenus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tvar $cgEditor = $.mk('form').attr('id','cg-editor'),\r\n\t\t$colorPreview = $.mk('span').attr('class','clrp'),\r\n\t\t$colorInput =\r\n\t\t\t$.mk('input').attr({\r\n\t\t\t\t'class': 'clri',\r\n\t\t\t\tpattern: HEX_COLOR_PATTERN.toString().replace(/\\//g,''),\r\n\t\t\t\tautocomplete: 'off',\r\n\t\t\t\tspellcheck: 'false',\r\n\t\t\t}).on('keyup change input',function(){\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t$cp = $this.prev(),\r\n\t\t\t\t\tvalid = HEX_COLOR_PATTERN.test(this.value);\r\n\t\t\t\tif (valid)\r\n\t\t\t\t\t$cp.removeClass('invalid').css('background-color', this.value.replace(HEX_COLOR_PATTERN, '#$1'));\r\n\t\t\t\telse $cp.addClass('invalid');\r\n\r\n\t\t\t\t$this.next().attr('required', valid);\r\n\t\t\t}).on('paste blur',function(e){\r\n\t\t\t\tvar input = this,\r\n\t\t\t\t\t$input = $(input),\r\n\t\t\t\t\tshortHex = /^#?([A-Fa-f0-9]{3})$/,\r\n\t\t\t\t\tf = function(){\r\n\t\t\t\t\t\tvar val = input.value;\r\n\t\t\t\t\t\tif (shortHex.test(val)){\r\n\t\t\t\t\t\t\tvar match = val.match(shortHex)[1];\r\n\t\t\t\t\t\t\tval = '#'+match[0]+match[0]+match[1]+match[1]+match[2]+match[2];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (HEX_COLOR_PATTERN.test(val)){\r\n\t\t\t\t\t\t\t$input.val(val.replace(HEX_COLOR_PATTERN, '#$1').toUpperCase()).trigger('change');\r\n\t\t\t\t\t\t\tif (e.type !== 'blur')\r\n\t\t\t\t\t\t\t\t$input.next().focus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\tif (e.type === 'paste') setTimeout(f, 10);\r\n\t\t\t\telse f();\r\n\t\t\t}),\r\n\t\t$colorLabel = $.mk('input').attr({ 'class': 'clrl', pattern: PRINTABLE_ASCII_REGEX.replace('+', '{3,30}') }),\r\n\t\t$colorActions = $.mk('div').attr('class','clra')\r\n\t\t\t.append($.mk('span').attr('class','typcn typcn-minus remove red').on('click',function(){\r\n\t\t\t\t$(this).closest('.clr').remove();\r\n\t\t\t\t$.Dialog.center();\r\n\t\t\t}))\r\n\t\t\t.append($.mk('span').attr('class','typcn typcn-arrow-move move blue')),\r\n\t\tmkClrDiv = function(color){\r\n\t\t\tvar $cp = $colorPreview.clone(),\r\n\t\t\t\t$ci = $colorInput.clone(true, true),\r\n\t\t\t\t$cl = $colorLabel.clone(),\r\n\t\t\t\t$ca = $colorActions.clone(true, true),\r\n\t\t\t\t$el = $.mk('div').attr('class','clr');\r\n\r\n\t\t\tif (typeof color === 'object'){\r\n\t\t\t\tif (color.colorid) $el.data('id', color.colorid);\r\n\t\t\t\tif (color.hex) $ci.val(color.hex);\r\n\t\t\t\tif (color.label) $cl.val(color.label);\r\n\t\t\t}\r\n\r\n\t\t\t$el.append($cp,$ci,$cl,$ca);\r\n\t\t\t$ci.trigger('change');\r\n\t\t\t$el.draggabilly({\r\n\t\t\t\taxis: 'y',\r\n\t\t\t\tcontainment: true,\r\n\t\t\t\thandle: '.move',\r\n\t\t\t});\r\n\t\t\t$el.on('dragStart dragMove dragEnd',function(e){\r\n\t\t\t\tvar $colorRow = $(this),\r\n\t\t\t\t\t$container = $colorRow.parent(),\r\n\t\t\t\t\t$childs = $container.children(),\r\n\t\t\t\t\tdraggie = $(this).data('draggabilly'),\r\n\t\t\t\t\tpos;\r\n\r\n\t\t\t\tswitch (e.type){\r\n\t\t\t\t\tcase \"dragStart\":\r\n\t\t\t\t\t\t$colorRow.addClass('moving');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"dragMove\":\r\n\t\t\t\t\t\tvar ix = $colorRow.index(),\r\n\t\t\t\t\t\t\tdeltaY = draggie.position.y,\r\n\t\t\t\t\t\t\tdirection = deltaY > 0,\r\n\t\t\t\t\t\t\tdistY = Math.abs(deltaY);\r\n\r\n\t\t\t\t\t\tpos = Math.round((distY < 14 ? 0 : distY-14)/28);\r\n\t\t\t\t\t\tpos = ix+(pos*(direction ? 1 : -1));\r\n\r\n\t\t\t\t\t\t$colorRow.data('moveto', [pos, direction]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"dragEnd\":\r\n\t\t\t\t\t\t$colorRow.removeClass('moving');\r\n\t\t\t\t\t\t$childs.removeAttr('style');\r\n\r\n\t\t\t\t\t\tvar data = $colorRow.data('moveto');\r\n\t\t\t\t\t\t$colorRow[data[1] ? 'insertAfter' : 'insertBefore']($childs.eq(data[0]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn $el;\r\n\t\t},\r\n\t\t$addBtn = $.mk('button').attr('class','typcn typcn-plus green').text('Add new color').on('click',function(e){\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar $form = $(this).parents('#cg-editor'),\r\n\t\t\t\t$colors = $form.children('.clrs');\r\n\t\t\tif (!$colors.length)\r\n\t\t\t\t$form.append($colors = $.mk('div').attr('class', 'clrs'));\r\n\t\t\tvar $div = mkClrDiv();\r\n\t\t\t$colors.append($div);\r\n\t\t\t$div.find('.clri').focus();\r\n\t\t\t$.Dialog.center();\r\n\t\t});\r\n\t$cgEditor\r\n\t\t.append('<label><span>Group name (2-30 chars.)</span><br><input name=label pattern=\"'+PRINTABLE_ASCII_REGEX.replace('+','{2,30}')+'\" required></label>')\r\n\t\t.append('<p class=align-center>The # symbol is optional, rows with invalid '+color+'s will be ignored. Each color must have a short (3-30 chars.) description of its intended use.</p>',$addBtn)\r\n\t\t.append($.mk('div').attr('class', 'clrs'))\r\n\t\t.append($.mk('div').attr('class','notice').hide().html('<p></p>'));\r\n\t$cgEditor.on('render-color-inputs',function(_, data){\r\n\t\tvar $form = $(this),\r\n\t\t\t$colors = $form.children('.clrs').empty();\r\n\r\n\t\t$.each(data, function(_, color){\r\n\t\t\t$colors.append(mkClrDiv(color));\r\n\t\t});\r\n\r\n\t\t$.Dialog.center();\r\n\t});\r\n\r\n\tfunction CGEditorMaker(title, $group){\r\n\t\tvar dis = this,\r\n\t\t\tgroupID = $group.attr('id').substring(2);\r\n\t\t$.Dialog.request(title,$cgEditor.clone(true, true),'cg-editor','Save',function($form){\r\n\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\thandleError = function(){\r\n\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t$form.find('input, texarea').attr('disabled', false);\r\n\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t},\r\n\t\t\t\t$label = $form.find('input[name=label]'),\r\n\t\t\t\tediting = typeof dis === 'object' && dis.label && dis.Colors;\r\n\t\t\tif (editing){\r\n\t\t\t\t$label.val(dis.label);\r\n\t\t\t\t$form.trigger('render-color-inputs',[dis.Colors]);\r\n\t\t\t}\r\n\t\t\t$form.on('submit',function(e){\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\tvar data = { label: $label.val(), Colors: [] };\r\n\t\t\t\tif (!editing) data.ponyid = dis.ponyid;\r\n\t\t\t\t$form.find('.clr').each(function(){\r\n\t\t\t\t\tvar $row = $(this),\r\n\t\t\t\t\t\t$ci = $row.children('.clri');\r\n\r\n\t\t\t\t\tif (!HEX_COLOR_PATTERN.test($ci.val()))\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tvar colorid = $row.data('id'),\r\n\t\t\t\t\t\tappend = { hex: $ci.val().replace(HEX_COLOR_PATTERN,'#$1').toUpperCase() };\r\n\t\t\t\t\tif (typeof colorid !== 'undefined') append.colorid = parseInt(colorid, 10);\r\n\r\n\t\t\t\t\tappend.label = $row.children('.clrl').val();\r\n\r\n\t\t\t\t\tdata.Colors.push(append);\r\n\t\t\t\t});\r\n\t\t\t\tif (data.Colors.length === 0)\r\n\t\t\t\t\tthrow new Error('You need to add at least 1 color');\r\n\t\t\t\tdata.Colors = JSON.stringify(data.Colors);\r\n\r\n\t\t\t\t$ErrorNotice.text('Saving changes...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t$.post('/colorguide/'+(editing?'set':'make')+'cg/'+groupID, data, $.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\tif (this.cg || this.cgs){\r\n\t\t\t\t\t\t\tif (this.cg){\r\n\t\t\t\t\t\t\t\t$group.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t\t$group.html(this.cg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (this.cgs)\r\n\t\t\t\t\t\t\t\t$group.parent().html(this.cgs);\r\n\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\tctxmenus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction ctxmenus(){\r\n\t\t$tags.children(':not(.ctxmenu-bound)').ctxmenu([\r\n\t\t\t{text: 'Edit tag', icon: 'pencil', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/)[1],\r\n\t\t\t\t\ttitle = 'Editing tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Retrieveing tag details from server');\r\n\r\n\t\t\t\t$.post('/colorguide/gettag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\tvar tag = this;\r\n\t\t\t\t\tif (this.status) $.Dialog.request(title,$tagEditForm.clone(true, true),'edit-tag','Save',function($form){\r\n\t\t\t\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\t\t\t\thandleError = function(){\r\n\t\t\t\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t\t\t\t$form.find('input, texarea').attr('disabled', false);\r\n\t\t\t\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t$form.find('input[name=type][value='+tag.type+']').prop('checked', true);\r\n\t\t\t\t\t\t$form.find('input[type=text][name], textarea[name]').each(function(){\r\n\t\t\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\t\t\t$this.val(tag[$this.attr('name')]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$form.on('submit', function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\tvar tempdata = $(this).serializeArray(), data = {};\r\n\t\t\t\t\t\t\t$.each(tempdata,function(i,el){\r\n\t\t\t\t\t\t\t\tdata[el.name] = el.value;\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t$ErrorNotice.text('Saving changes...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t\t\t$.post('/colorguide/settag/'+tagID,data,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\t\tvar $affected = $('.id-'+this.tid);\r\n\t\t\t\t\t\t\t\t\t$affected.qtip('destroy', true);\r\n\t\t\t\t\t\t\t\t\tif (this.title) $affected.attr('title', this.title);\r\n\t\t\t\t\t\t\t\t\telse $affected.removeAttr('title');\r\n\t\t\t\t\t\t\t\t\t$affected\r\n\t\t\t\t\t\t\t\t\t\t.attr('class', 'tag id-'+this.tid+(this.type?' typ-'+this.type:''))\r\n\t\t\t\t\t\t\t\t\t\t.text(this.name).data('ctxmenu-items').eq(0).text('Tag: '+this.name);\r\n\t\t\t\t\t\t\t\t\t$affected.parent().each(function(){\r\n\t\t\t\t\t\t\t\t\t\treorder($(this));\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t}));\r\n\t\t\t}},\r\n\t\t\t{text: 'Remove tag', icon: 'minus', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/);\r\n\r\n\t\t\t\tif (!tagID) return false;\r\n\t\t\t\ttagID = tagID[1];\r\n\r\n\t\t\t\tvar ponyID = $tag.closest('li').attr('id').replace(/\\D/g, ''),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttitle = 'Remove tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.confirm(title,\"The tag \"+tagName+\" will be removed from this appearance.<br>Are you sure?\",['Remove it','Nope'],function(sure){\r\n\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Removing tag');\r\n\r\n\t\t\t\t\t$.post('/colorguide/untag/'+ponyID,{ tag: tagID },$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t$tag.qtip('destroy', true);\r\n\t\t\t\t\t\t\t$tag.remove();\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t}},\r\n\t\t\t{text: 'Delete tag', icon: 'trash', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/)[1],\r\n\t\t\t\t\ttitle = 'Detele tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.confirm(title,\"Deleting this tag will also remove it from every appearance where it's been used.<br>Are you sure?\",['Delete it','Nope'],function(sure){\r\n\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Sending removal request');\r\n\r\n\t\t\t\t\t$.post('/colorguide/deltag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\tvar $affected = $('.id-'+tagID);\r\n\t\t\t\t\t\t\t$affected.qtip('destroy', true);\r\n\t\t\t\t\t\t\t$affected.remove();\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t}},\r\n\t\t\ttrue,\r\n\t\t\t{text: 'Create new tag', icon: 'plus', click: function(){\r\n\t\t\t\tcreateNewTag($(this));\r\n\t\t\t}},\r\n\t\t], function($el){ return 'Tag: '+$el.text().trim() });\r\n\r\n\t\tvar taglist = new Bloodhound({\r\n\t\t\tdatumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),\r\n\t\t\tqueryTokenizer: Bloodhound.tokenizers.whitespace,\r\n\t\t\tremote: {\r\n\t\t\t\turl: '/colorguide/gettags?s=%QUERY',\r\n\t\t\t\twildcard: '%QUERY'\r\n\t\t\t}\r\n\t\t}), insertKeys = [13, 188];\r\n\t\t$tags.children('.addtag').each(function(){\r\n\t\t\tvar $input = $(this),\r\n\t\t\t\tponyID = $input.parents('li').attr('id').substring(1);\r\n\t\t\t$input.data('ctxmenu-items', $input.data('ctxmenu-items').filter(':first, :last'));\r\n\t\t\t$input.data('ctxmenu-items').first().text('Tags');\r\n\t\t\t$input.typeahead(null, {\r\n\t\t\t\tname: 'tags',\r\n\t\t\t\tdisplay: 'name',\r\n\t\t\t\tsource: taglist,\r\n\t\t\t\ttemplates: {\r\n\t\t\t\t\tsuggestion: Handlebars.compile('<span class=\"tag id-{{tid}} typ-{{type}}\">{{name}}</span>')\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$input.on('keydown',function(e){\r\n\t\t\t\tif (insertKeys.indexOf(e.keyCode) !== -1){\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar tag_name = $input.val().trim(),\r\n\t\t\t\t\t\t$tagsDiv = $input.parents('.tags'),\r\n\t\t\t\t\t\t$ponyTags = $tagsDiv.children('.tag'),\r\n\t\t\t\t\t\ttitle = 'Adding tag: '+tag_name;\r\n\r\n\t\t\t\t\tif ($ponyTags.filter(function(){ return this.innerHTML.trim() === tag_name }).length > 0)\r\n\t\t\t\t\t\treturn $.Dialog.fail(title, 'This appearance already has this tag');\r\n\r\n\t\t\t\t\t$.Dialog._focusedElement = $input.attr('disabled', true);\r\n\t\t\t\t\t$input.parent().addClass('loading');\r\n\r\n\t\t\t\t\t$.post('/colorguide/tag/'+ponyID,{ tag_name: tag_name }, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t$tagsDiv.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t$tagsDiv.html(this.tags);\r\n\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\tctxmenus();\r\n\t\t\t\t\t\t\t$('#p'+ponyID).find('.addtag').focus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (typeof this.cancreate === 'string'){\r\n\t\t\t\t\t\t\tvar new_name = this.cancreate;\r\n\t\t\t\t\t\t\ttitle = title.replace(tag_name, new_name);\r\n\t\t\t\t\t\t\t$.Dialog.confirm(title, this.message, function(sure){\r\n\t\t\t\t\t\t\t\tif (!sure) return;\r\n\t\t\t\t\t\t\t\tcreateNewTag($input, new_name);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t\t$input.removeAttr('disabled').parent().removeClass('loading');\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$input.nextAll('.tt-menu').on('click', '.tag', function(){\r\n\t\t\t\t$input.trigger({\r\n\t\t\t\t\ttype: 'keydown',\r\n\t\t\t\t\tkeyCode: 13,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$colorGroups = $('ul.colors:not(.static)').children('li');\r\n\t\t$colorGroups.filter(':not(.ctxmenu-bound)').ctxmenu(\r\n\t\t\t[\r\n\t\t\t\t{text: \"Edit \"+color+\" group\", icon: 'pencil', click: function(){\r\n\t\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t\t$group = $this.closest('li'),\r\n\t\t\t\t\t\tgroupID = $group.attr('id').substring(2),\r\n\t\t\t\t\t\tgroupName = $this.children().first().text().replace(/:\\s?$/,''),\r\n\t\t\t\t\t\ttitle = 'Editing '+color+' group: '+groupName;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title, 'Retrieving '+color+' group details from server');\r\n\r\n\t\t\t\t\t$.post('/colorguide/getcg/'+groupID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tif (this.status) CGEditorMaker.call(this, title, $group);\r\n\t\t\t\t\t\t\telse throw new Error(this.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcatch(e){ handleError.call(e.message) }\r\n\t\t\t\t\t}));\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Delete \"+color+\" group\", icon: 'trash', click: function(){\r\n\t\t\t\t\tvar $group = $(this).closest('li'),\r\n\t\t\t\t\t\tgroupID = $group.attr('id').substring(2),\r\n\t\t\t\t\t\tgroupName = $group.children().first().text().replace(/:\\s?$/,''),\r\n\t\t\t\t\t\ttitle = 'Delete '+color+' group: '+groupName;\r\n\t\t\t\t\t$.Dialog.confirm(title, 'By deleting this '+color+' group, all '+color+'s within will be removed too.<br>Are you sure?',function(sure){\r\n\t\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t\t$.Dialog.wait(title, 'Sending removal request');\r\n\r\n\t\t\t\t\t\t$.post('/colorguide/delcg/'+groupID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\t$group.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t\t$group.remove();\r\n\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t});\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Create new group\", icon: 'folder-add', click: function(){\r\n\t\t\t\t\tvar $group = $(this).closest('li'),\r\n\t\t\t\t\t\tponyID = $group.parents('li').attr('id').substring(1);\r\n\t\t\t\t\tCGEditorMaker.call({ponyid:ponyID},'Create color group', $group);\r\n\t\t\t\t}},\r\n\t\t\t],\r\n\t\t\tfunction($el){ return Color+' group: '+$el.children().first().text().trim().replace(':','') }\r\n\t\t);\r\n\t\t$.ctxmenu.addItems(\r\n\t\t\t$('ul.colors').children('li').children('span:not(:first-child)').off('click').on('click',function(e){\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$.copy(this.innerHTML.trim());\r\n\t\t\t}).filter(':not(.ctxmenu-bound)').ctxmenu(\r\n\t\t\t\t[\r\n\t\t\t\t\t{text: \"Copy HEX \"+color+\" code\", icon: 'clipboard', 'default': true, click: function(){\r\n\t\t\t\t\t\t$.copy(this.innerHTML.trim());\r\n\t\t\t\t\t}},\r\n\t\t\t\t],\r\n\t\t\t\tfunction($el){ return 'Color: '+$el.attr('oldtitle') }\r\n\t\t\t).filter(function(){ return this.parentNode.parentNode.className.indexOf('static') === -1 }),\r\n\r\n\t\t\ttrue,\r\n\t\t\t{text: \"Edit \"+color+\" group\", icon: 'pencil', click: function(){\r\n\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 1);\r\n\t\t\t}},\r\n\t\t\t{text: \"Delete \"+color+\" group\", icon: 'trash', click: function(){\r\n\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 2);\r\n\t\t\t}},\r\n\t\t\t{text: \"Add new group\", icon: 'folder-add', click: function(){\r\n\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 3);\r\n\t\t\t}}\r\n\t\t);\r\n\t}\r\n\tctxmenus();\r\n\twindow.ctxmenus = function(){ctxmenus()};\r\n});\r\n"],"sourceRoot":"/source/"}