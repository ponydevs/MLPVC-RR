{"version":3,"sources":["colorguide-manage.js"],"names":["$","reorder","$this","children","sort","a","b","regex","className","replace","innerHTML","trim","localeCompare","appendTo","ctxmenus","$tags","ctxmenu","text","icon","click","$tag","this","tagName","tagID","attr","match","title","Dialog","wait","post","mkAjaxHandler","tag","status","request","$tagEditForm","clone","$form","$ErrorNotice","handleError","html","message","parent","removeClass","addClass","show","find","center","type","prop","each","val","on","e","preventDefault","tempdata","serializeArray","data","i","el","name","value","$affected","tid","qtip","removeAttr","eq","window","tooltips","close","call","fail","ponyID","closest","confirm","sure","remove","$li","$div","$tagsDiv","ponyName","append","document","createElement","tags","$el","taglist","Bloodhound","datumTokenizer","tokenizers","obj","whitespace","queryTokenizer","remote","url","wildcard","insertKeys","$input","parents","substring","typeahead","display","source","templates","suggestion","Handlebars","compile","indexOf","keyCode","tag_name","$ponyTags","filter","length","focus","removeAttribute","nextAll","trigger","$colorGroups","color","info","Color","first","off","copy","default","triggerItem","TAG_TYPES_ASSOC","isWebkit","documentElement","style","$spriteUploadForm","uploadZone","requestKey","accept","target","href","urlToAbsolute","$uploadInput","$image_url","stopPropagation","image_url","path","forced","get","$list","next","$_typeSelect","label","$lbl","$chx","checked","siblings","hide"],"mappings":"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","file":"colorguide-manage.min.js","sourcesContent":["$(function(){\r\n\tvar Color = window.Color, color = window.color, TAG_TYPES_ASSOC = window.TAG_TYPES_ASSOC, $colorGroups,\r\n\t\tisWebkit = 'WebkitAppearance' in document.documentElement.style;\r\n\r\n\tvar $spriteUploadForm = $(document.createElement('form')).attr('id', 'sprite-img').html(\r\n\t\t'<p class=align-center><a href=#upload>Click here to upload a file</a> or enter a URL below.</p>' +\r\n\t\t'<label><input type=text name=image_url placeholder=\"External image URL\" required></label>' +\r\n\t\t'<p class=align-center>The URL will be checked against the supported provider list, and if an image is found, it\\'ll be downloaded to the server and set as this appearance\\'s sprite image.</p>'\r\n\t);\r\n\r\n\t$('.upload-wrap').each(function(){\r\n\t\tvar $this = $(this),\r\n\t\t\tponyID = $this.closest('li').attr('id').substring(1);\r\n\r\n\t\t$this.uploadZone({\r\n\t\t\trequestKey: 'sprite',\r\n\t\t\ttitle: 'Upload sprite',\r\n\t\t\taccept: 'image/png',\r\n\t\t\ttarget: '/colorguide/setsprite/'+ponyID,\r\n\t\t}).on('uz-uploadstart',function(){\r\n\t\t\t$.Dialog.close();\r\n\t\t}).ctxmenu([\r\n\t\t\t{text: 'Open image in new tab', icon: 'arrow-forward', 'default': true, attr: {\r\n\t\t\t\thref: $this.find('img').attr('src'),\r\n\t\t\t\ttarget: '_blank',\r\n\t\t\t}},\r\n\t\t\t{text: 'Copy image URL', icon: 'clipboard', click: function(){\r\n\t\t\t\t$.copy($.urlToAbsolute($this.find('img').attr('src')));\r\n\t\t\t}},\r\n\t\t\t{text: 'Upload new sprite', icon: 'upload', click: function(){\r\n\t\t\t\tvar title = 'Upload sprite image',\r\n\t\t\t\t\tponyID = $this.closest('li').attr('id').substring(1),\r\n\t\t\t\t\t$uploadInput = $this.find('input[type=\"file\"]');\r\n\t\t\t\t$.Dialog.request(title,$spriteUploadForm.clone(),'sprite-img','Download image',function(){\r\n\t\t\t\t\tvar $form = $('#sprite-img'),\r\n\t\t\t\t\t\t$image_url = $form.find('input[name=image_url]');\r\n\t\t\t\t\t$form.find('a').on('click',function(e){\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\t\t$uploadInput.trigger('click', [true]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tvar image_url = $image_url.val();\r\n\r\n\t\t\t\t\t\t$.Dialog.wait(title, 'Downloading external image to the server');\r\n\r\n\t\t\t\t\t\t$.post('/colorguide/setsprite/'+ponyID,{image_url: image_url}, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tif (this.status) $uploadInput.trigger('set-image', [this.path]);\r\n\t\t\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}},\r\n\t\t], 'Sprite image').attr('title', isWebkit ? ' ' : '').on('click',function(e, forced){\r\n\t\t\tif (forced === true) return true;\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\t$this.data('ctxmenu-items').eq(1).children().get(0).click();\r\n\t\t});\r\n\t});\r\n\r\n\tvar $list = $('#list');\r\n\t$list.find('button.edit').on('click',function(){\r\n\t\t$.Dialog.info('Edit mode triggered', 'yay');\r\n\t}).next().on('click',function(){\r\n\t\tvar $this = $(this),\r\n\t\t\t$li = $this.closest('li'),\r\n\t\t\tponyID = $li.attr('id').substring(1),\r\n\t\t\tponyName = $this.parent().text().trim(),\r\n\t\t\ttitle = 'Deleting appearance: '+ponyName;\r\n\r\n\t\t$.Dialog.confirm(title,'Deleting this appearance will remove <strong>ALL</strong> of its color groups, the colors within them, and the sprite file, if any.<br>Delete anyway?',function(sure){\r\n\t\t\tif (!sure) return;\r\n\r\n\t\t\t$.Dialog.wait(title, 'Sending removal request');\r\n\r\n\t\t\t$.post('/colorguide/delete/'+ponyID,$.mkAjaxHandler(function(){\r\n\t\t\t\tif (this.status){\r\n\t\t\t\t\t$li.remove();\r\n\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t}));\r\n\t\t})\r\n\t});\r\n\r\n\tvar $tagEditForm = $(document.createElement('form')).attr('id', 'edit-tag');\r\n\t$tagEditForm\r\n\t\t.append('<label><span>Tag name (4-30 chars.)</span><input type=text name=name required pattern=^.{4,30}$ maxlength=30></label>');\r\n\tvar $_typeSelect = $(document.createElement('div')).addClass('type-selector');\r\n\t$.each(TAG_TYPES_ASSOC,function(type, label){\r\n\t\tvar $lbl = $(document.createElement('label')),\r\n\t\t\t$chx = $(document.createElement('input'))\r\n\t\t\t\t.attr({\r\n\t\t\t\t\ttype: 'checkbox',\r\n\t\t\t\t\tname: 'type',\r\n\t\t\t\t\tvalue: type\r\n\t\t\t\t}).on('click',function(){\r\n\t\t\t\t\tif (this.checked)\r\n\t\t\t\t\t\t$(this).parent().siblings().find('input').prop('checked', false);\r\n\t\t\t\t});\r\n\t\t$lbl.append($chx, $(document.createElement('span')).addClass('tag typ-'+type).text(label)).appendTo($_typeSelect);\r\n\t});\r\n\t$tagEditForm\r\n\t\t.append($(document.createElement('div')).addClass('align-center').append('<span>Tag type (optional)</span><br>',$_typeSelect))\r\n\t\t.append($(document.createElement('label')).append('<span>Tag description (max 255 chars., optional)</span><br><textarea name=title maxlength=255></textarea>'))\r\n\t\t.append($(document.createElement('div')).attr('class','notice').hide().html('<p></p>'));\r\n\r\n\tvar $tags = $('.tags');\r\n\tfunction reorder($this){\r\n\t\t$this.children().sort(function(a, b){\r\n\t\t\tvar regex = /^.*typ-([a-z]+).*$/;\r\n\t\t\ta = [a.className.replace(regex,'$1'), a.innerHTML.trim()];\r\n\t\t\tb = [b.className.replace(regex,'$1'), b.innerHTML.trim()];\r\n\r\n\t\t\tif (a[0] === b[0])\r\n\t\t\t\treturn a[1].localeCompare(b[1]);\r\n\t\t\treturn a[0].localeCompare(b[0]);\r\n\t\t}).appendTo($this);\r\n\t}\r\n\r\n\tfunction ctxmenus(){\r\n\t\t$tags.children(':not(.ctxmenu-bound)').ctxmenu([\r\n\t\t\t{text: 'Edit tag', icon: 'pencil', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/)[1],\r\n\t\t\t\t\ttitle = 'Editing tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Retrieveing tag details from server');\r\n\r\n\t\t\t\t$.post('/colorguide/gettag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\tvar tag = this;\r\n\t\t\t\t\tif (this.status) $.Dialog.request(title,$tagEditForm.clone(true, true),'edit-tag','Save',function(){\r\n\t\t\t\t\t\tvar $form = $('#edit-tag'),\r\n\t\t\t\t\t\t\t$ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\t\t\t\thandleError = function(){\r\n\t\t\t\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t\t\t\t$form.find('input, texarea').attr('disabled', false);\r\n\t\t\t\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t$form.find('input[name=type][value='+tag.type+']').prop('checked', true);\r\n\t\t\t\t\t\t$form.find('input[type=text][name], textarea[name]').each(function(){\r\n\t\t\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\t\t\t$this.val(tag[$this.attr('name')]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$form.on('submit', function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\tvar tempdata = $(this).serializeArray(), data = {};\r\n\t\t\t\t\t\t\t$.each(tempdata,function(i,el){\r\n\t\t\t\t\t\t\t\tdata[el.name] = el.value;\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t$ErrorNotice.text('Saving changes...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t\t\t$.post('/colorguide/settag/'+tagID,data,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\t\tvar $affected = $('.id-'+this.tid);\r\n\t\t\t\t\t\t\t\t\t$affected.qtip('destroy', true);\r\n\t\t\t\t\t\t\t\t\tif (this.title) $affected.attr('title', this.title);\r\n\t\t\t\t\t\t\t\t\telse $affected.removeAttr('title');\r\n\t\t\t\t\t\t\t\t\t$affected\r\n\t\t\t\t\t\t\t\t\t\t.attr('class', 'tag id-'+this.tid+(this.type?' typ-'+this.type:''))\r\n\t\t\t\t\t\t\t\t\t\t.text(this.name).data('ctxmenu-items').eq(0).text('Tag: '+this.name);\r\n\t\t\t\t\t\t\t\t\t$affected.parent().each(function(){\r\n\t\t\t\t\t\t\t\t\t\treorder($(this));\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t}));\r\n\t\t\t}},\r\n\t\t\t{text: 'Remove tag', icon: 'minus', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\tponyID = $tag.closest('li').attr('id').replace(/\\D/g, ''),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/)[1],\r\n\t\t\t\t\ttitle = 'Remove tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.confirm(title,\"The tag \"+tagName+\" will be removed from this appearance.<br>Are you sure?\",['Remove it','Nope'],function(sure){\r\n\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Removing tag');\r\n\r\n\t\t\t\t\t$.post('/colorguide/untag/'+ponyID,{ tag: tagID },$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t$tag.qtip('destroy', true);\r\n\t\t\t\t\t\t\t$tag.remove();\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t}},\r\n\t\t\t{text: 'Delete tag', icon: 'trash', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/)[1],\r\n\t\t\t\t\ttitle = 'Detele tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.confirm(title,\"By deleting this tag, it'll be removed from every appearance where it's been used.<br>Are you sure?\",['Delete it','Nope'],function(sure){\r\n\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Sending removal request');\r\n\r\n\t\t\t\t\t$.post('/colorguide/deltag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\tvar $affected = $('.id-'+tagID);\r\n\t\t\t\t\t\t\t$affected.qtip('destroy', true);\r\n\t\t\t\t\t\t\t$affected.remove();\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t}},\r\n\t\t\ttrue,\r\n\t\t\t{text: 'Create new tag', icon: 'plus', click: function(){\r\n\t\t\t\tvar title = 'Create new tag',\r\n\t\t\t\t\t$tag = $(this),\r\n\t\t\t\t\t$li = $tag.closest('li'),\r\n\t\t\t\t\t$div = $tag.closest('div:not([class])'),\r\n\t\t\t\t\t$tagsDiv = $div.children('.tags'),\r\n\t\t\t\t\tponyID = $li.attr('id').replace(/\\D/g, ''),\r\n\t\t\t\t\tponyName = $div.children('strong').text().trim();\r\n\r\n\t\t\t\t$.Dialog.request(title,$tagEditForm.clone(true, true),'edit-tag','Create',function(){\r\n\t\t\t\t\tvar $form = $('#edit-tag'),\r\n\t\t\t\t\t\t$ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\t\t\thandleError = function(){\r\n\t\t\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t\t\t$form.find('input, texarea').attr('disabled', false);\r\n\t\t\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t$form.append(\r\n\t\t\t\t\t\t$(document.createElement('label'))\r\n\t\t\t\t\t\t\t.append('<input type=checkbox name=addto value='+ponyID+'> Add this tag to the appearance \"'+ponyName+'\" after creation')\r\n\t\t\t\t\t);\r\n\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t$form.on('submit', function(e){\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tvar tempdata = $form.serializeArray(), data = {};\r\n\t\t\t\t\t\t$.each(tempdata,function(i,el){\r\n\t\t\t\t\t\t\tdata[el.name] = el.value;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t$ErrorNotice.text('Creating tag...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t\t$.post('/colorguide/maketag',data,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\tif (this.tags){\r\n\t\t\t\t\t\t\t\t\t$tagsDiv.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t\t\t$tagsDiv.html(this.tags);\r\n\t\t\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\t\t\tctxmenus();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t}},\r\n\t\t], function($el){ return 'Tag: '+$el.text().trim() });\r\n\r\n\t\tvar taglist = new Bloodhound({\r\n\t\t\tdatumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),\r\n\t\t\tqueryTokenizer: Bloodhound.tokenizers.whitespace,\r\n\t\t\tremote: {\r\n\t\t\t\turl: '/colorguide/gettags?s=%QUERY',\r\n\t\t\t\twildcard: '%QUERY'\r\n\t\t\t}\r\n\t\t}), insertKeys = [13, 188];\r\n\t\t$tags.children('.addtag').each(function(){\r\n\t\t\tvar $input = $(this),\r\n\t\t\t\tponyID = $input.parents('li').attr('id').substring(1);\r\n\t\t\t$input.typeahead(null, {\r\n\t\t\t\tname: 'tags',\r\n\t\t\t\tdisplay: 'name',\r\n\t\t\t\tsource: taglist,\r\n\t\t\t\ttemplates: {\r\n\t\t\t\t\tsuggestion: Handlebars.compile('<span class=\"tag id-{{tid}} typ-{{type}}\">{{name}}</span>')\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$input.on('keydown',function(e){\r\n\t\t\t\tif (insertKeys.indexOf(e.keyCode) !== -1){\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar tag_name = $input.val().trim(),\r\n\t\t\t\t\t\t$tagsDiv = $input.parents('.tags'),\r\n\t\t\t\t\t\t$ponyTags = $tagsDiv.children('.tag'),\r\n\t\t\t\t\t\ttitle = 'Adding tag: '+tag_name;\r\n\r\n\t\t\t\t\tif ($ponyTags.filter(function(){ return this.innerHTML.trim() === tag_name }).length > 0)\r\n\t\t\t\t\t\treturn $.Dialog.fail(title, 'This appearance already has this tag');\r\n\r\n\t\t\t\t\t$input.attr('disabled', true);\r\n\r\n\t\t\t\t\t$.post('/colorguide/tag/'+ponyID,{ tag_name: $input.val() }, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t$tagsDiv.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t$tagsDiv.html(this.tags);\r\n\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\tctxmenus();\r\n\t\t\t\t\t\t\t$('#p'+ponyID).find('.addtag').focus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t\t$input.removeAttribute('disabled').focus();\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$input.nextAll('.tt-menu').on('click', '.tag', function(){\r\n\t\t\t\t$input.trigger({\r\n\t\t\t\t\ttype: 'keydown',\r\n\t\t\t\t\tkeyCode: 13,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$colorGroups = $('ul.colors').children('li');\r\n\t\t$colorGroups.filter(':not(.ctxmenu-bound)').ctxmenu(\r\n\t\t\t[\r\n\t\t\t\t{text: \"Edit \"+color+\" group (TBI)\", icon: 'pencil', click: function(){\r\n\t\t\t\t\t$.Dialog.info('Edit '+color+' group triggered', 'yay');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t\t// TODO\r\n\t\t\t\t\t//noinspection UnreachableCodeJS\r\n\t\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t\tgroupID = $this.closest('li').attr('id').substring(2),\r\n\t\t\t\t\t\tgroupName = $this.children().first().text().replace(/:\\s?$/,''),\r\n\t\t\t\t\t\ttitle = 'Editing color group: '+groupName;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title, 'Retrieving '+color+' group details from server');\r\n\r\n\t\t\t\t\t$.post('/colorguide/getcg/'+groupID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status) $.Dialog.request(title,$cgEditor.clone(true, true),'cg-editor','Save',function(){\r\n\t\t\t\t\t\t\tvar $form = $('#cg-editor'),\r\n\t\t\t\t\t\t\t$ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\t\t\t\thandleError = function(){\r\n\t\t\t\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t\t\t\t$form.find('input, texarea').attr('disabled', false);\r\n\t\t\t\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t\tvar tempdata = $form.serializeArray(), data = {};\r\n\t\t\t\t\t\t\t\t$.each(tempdata,function(i,el){\r\n\t\t\t\t\t\t\t\t\tdata[el.name] = el.value;\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$ErrorNotice.text('Saving changes...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t\t\t\t$.post('/colorguide/setcg/'+groupID, data, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\t\t\tif (this.status);\r\n\t\t\t\t\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t\t}));\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Delete \"+color+\" group (TBI)\", icon: 'trash', click: function(){\r\n\t\t\t\t\t// TODO Confirmation\r\n\t\t\t\t\t$.Dialog.info('Delete '+color+' group triggered', 'yay');\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Add new group (TBI)\", icon: 'folder-add', click: function(){\r\n\t\t\t\t\t$.Dialog.info('Add new group triggered', 'yay');\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Add new \"+color+' (TBI)', icon: 'plus', click: function(){\r\n\t\t\t\t\t$.Dialog.info('Add new color triggered', 'yay');\r\n\t\t\t\t}}\r\n\t\t\t],\r\n\t\t\tfunction($el){ return Color+' group: '+$el.children().first().text().trim().replace(':','') }\r\n\t\t);\r\n\t\t$colorGroups.children('span:not(:first-child)').off('click').on('click',function(e){\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$.copy(this.innerHTML.trim());\r\n\t\t}).filter(':not(.ctxmenu-bound)').ctxmenu(\r\n\t\t\t[\r\n\t\t\t\t{text: \"Copy \"+color, icon: 'clipboard', 'default': true, click: function(){\r\n\t\t\t\t\t$.copy(this.innerHTML.trim());\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Edit \"+color+' (TBI)', icon: 'pencil (TBI)', click: function(){\r\n\t\t\t\t\t$.Dialog.info('Edit '+color+' triggered', 'yay');\r\n\t\t\t\t}},\r\n\t\t\t\ttrue,\r\n\t\t\t\t{text: \"Edit \"+color+\" group (TBI)\", icon: 'pencil', click: function(){\r\n\t\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 1);\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Delete \"+color+\" group (TBI)\", icon: 'trash', click: function(){\r\n\t\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 2);\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Add new group (TBI)\", icon: 'folder-add', click: function(){\r\n\t\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 3);\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Add new \"+color+' (TBI)', icon: 'plus', click: function(){\r\n\t\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 4);\r\n\t\t\t\t}}\r\n\t\t\t],\r\n\t\t\tfunction($el){ return 'Color: '+$el.attr('oldtitle') }\r\n\t\t);\r\n\t}\r\n\tctxmenus();\r\n\twindow.ctxmenus = function(){ctxmenus()};\r\n});\r\n"],"sourceRoot":"/source/"}