{"version":3,"sources":["user-manage.js"],"names":["DocReady","push","window","ROLES","$content","$","$name","children","name","text","trim","$currRole","next","currRole","$RoleForm","mk","attr","html","$OptGrp","find","$banToggle","$changeRole","each","label","append","on","title","Dialog","request","clone","$form","$currRoleOpt","filter","this","innerHTML","e","preventDefault","val","close","data","mkData","wait","post","mkAjaxHandler","already_in","status","success","message","HandleNav","reload","fail","Action","hasClass","action","toLowerCase","replace","$input"],"mappings":"AAAAA,SAASC,KAAK,WACb,GAA2B,YAAhBC,QAAOC,MAAlB,CACA,GAAIC,GAAWC,EAAE,YAChBF,EAAQD,OAAOC,MACfG,EAAQF,EAASG,SAAS,MAC1BC,EAAOF,EAAMG,OAAOC,OACpBC,EAAYL,EAAMM,OAClBC,EAAWF,EAAUJ,SAAS,QAAQE,OACtCK,EAAYT,EAAEU,GAAG,QAAQC,KAAK,KAAK,WAAWC,KAAK,yFACnDC,EAAUJ,EAAUK,KAAK,YACzBC,EAAaf,EAAE,eACfgB,EAAchB,EAAE,eAEjBA,GAAEiB,KAAKnB,EAAM,SAASK,EAAKe,GAC1BL,EAAQM,OAAO,iBAAiBhB,EAAK,IAAIe,EAAM,eAGhDF,EAAYI,GAAG,QAAQ,WACtB,GAAIC,GAAQ,cACZrB,GAAEsB,OAAOC,QAAQF,EAAMZ,EAAUe,QAAQ,UAAU,SAAS,SAASC,GACpE,GAAIC,GAAeD,EAAMX,KAAK,UAAUa,OAAO,WAAY,MAAOC,MAAKC,YAAcrB,IAAYG,KAAK,YAAY,EAClHc,GAAML,GAAG,SAAS,SAASU,GAG1B,GAFAA,EAAEC,iBAEEN,EAAMvB,SAAS,UAAU8B,QAAUN,EAAaf,KAAK,SACxD,MAAOX,GAAEsB,OAAOW,OAEjB,IAAIC,GAAOT,EAAMU,QACjBnC,GAAEsB,OAAOc,KAAKf,EAAM,gCAEpBrB,EAAEqC,KAAK,YAAYlC,EAAM+B,EAAMlC,EAAEsC,cAAc,WAC9C,MAAIV,MAAKW,cAAe,EAChBvC,EAAEsB,OAAOW,QAEZL,KAAKY,QACVxC,EAAEsB,OAAOmB,QAAQpB,EAAOO,KAAKc,aAE7BC,WAAUC,OAAO,WAChB5C,EAAEsB,OAAOW,WAJejC,EAAEsB,OAAOuB,KAAKxB,EAAMO,KAAKc,kBAUtD3B,EAAWK,GAAG,QAAQ,WACrB,GAAI0B,IAAU/B,EAAWgC,SAAS,aAAe,SAAW,OAAO,MAClEC,EAASF,EAAOG,cAChB5B,EAAQyB,EAAO,OAAO3C,GAAgB,UAAV6C,EAAqB,eAAe,GACjEhD,GAAEsB,OAAOC,QACRF,GAEY,WAAXyB,EACE,MAAMA,EAAO,OAAO3C,EAAK,gJACzB,MAAM2C,EAAO,OAAO3C,EAAK,sDAE5B,YAAY6C,EAAO,gEACuCA,EAAOE,QAAQ,OAAO,IAAI,iMAGxE,WAAXJ,EAAsB,kDAAkD,IACzEE,EAAO,QACPF,EACA,WACC,GAAIrB,GAAQzB,EAAE,IAAIgD,EAAO,SACxBG,EAAS1B,EAAMX,KAAK,QACrBqC,GAAOnB,IAAIc,EAAO,gBAClBrB,EAAML,GAAG,SAAS,SAASU,GAC1BA,EAAEC,gBAEF,IAAIG,GAAOlC,EAAE4B,MAAMO,QACnBnC,GAAEsB,OAAOc,KAAKf,EAAO,qCAErBrB,EAAEqC,KAAKW,EAAO,IAAI7C,EAAM+B,EAAMlC,EAAEsC,cAAc,WAC7C,MAAKV,MAAKY,QAEK,WAAXQ,EAAqBhD,EAAEsB,OAAOmB,QAAQpB,EAAO,2EAC5CrB,EAAEsB,OAAOmB,QAAQpB,EAAOO,KAAKc,aAElCC,WAAUC,OAAO,WAChB5C,EAAEsB,OAAOW,SACR,MAPuBjC,EAAEsB,OAAOuB,KAAKxB,EAAMO,KAAKc","file":"user-manage.min.js","sourcesContent":["DocReady.push(function UserManage(){\r\n\tif (typeof window.ROLES == null) return;\r\n\tvar $content = $('#content'),\r\n\t\tROLES = window.ROLES,\r\n\t\t$name = $content.children('h1'),\r\n\t\tname = $name.text().trim(),\r\n\t\t$currRole = $name.next(),\r\n\t\tcurrRole = $currRole.children('span').text(),\r\n\t\t$RoleForm = $.mk('form').attr('id','rolemod').html('<select name=\"newrole\" required><optgroup label=\"Possible roles\"></optgroup></select>'),\r\n\t\t$OptGrp = $RoleForm.find('optgroup'),\r\n\t\t$banToggle = $('#ban-toggle'),\r\n\t\t$changeRole = $('#change-role');\r\n\r\n\t$.each(ROLES,function(name,label){\r\n\t\t$OptGrp.append('<option value='+name+'>'+label+'</option>');\r\n\t});\r\n\r\n\t$changeRole.on('click',function(){\r\n\t\tvar title = \"Change group\";\r\n\t\t$.Dialog.request(title,$RoleForm.clone(),'rolemod','Change',function($form){\r\n\t\t\tvar $currRoleOpt = $form.find('option').filter(function(){ return this.innerHTML === currRole }).attr('selected', true);\r\n\t\t\t$form.on('submit',function(e){\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\tif ($form.children('select').val() === $currRoleOpt.attr('value'))\r\n\t\t\t\t\treturn $.Dialog.close();\r\n\r\n\t\t\t\tvar data = $form.mkData();\r\n\t\t\t\t$.Dialog.wait(title,'Moving user to the new group');\r\n\r\n\t\t\t\t$.post(\"newgroup/\"+name, data, $.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.already_in === true)\r\n\t\t\t\t\t\treturn $.Dialog.close();\r\n\r\n\t\t\t\t\tif (!this.status) return $.Dialog.fail(title,this.message);\r\n\t\t\t\t\t$.Dialog.success(title, this.message);\r\n\r\n\t\t\t\t\tHandleNav.reload(function(){\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t});\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n\t$banToggle.on('click',function(){\r\n\t\tvar Action = ($banToggle.hasClass('un-banish') ? 'Un-ban' : 'Ban')+'ish',\r\n\t\t\taction = Action.toLowerCase(),\r\n\t\t\ttitle = Action+'ing '+name+(action == 'banish' ? ' to the moon':'');\r\n\t\t$.Dialog.request(\r\n\t\t\ttitle,\r\n\t\t\t(\r\n\t\t\t\tAction === 'Banish'\r\n\t\t\t\t? '<p>'+Action+'ing '+name+' will immediately sign them out of every session and won\\'t allow them to log in again. Please, only do this if it\\'s absolutely necessary.</p>'\r\n\t\t\t\t: '<p>'+Action+'ing '+name+' will allow them to sign in to the site again.</p>'\r\n\t\t\t) +\r\n\t\t\t'<form id='+action+'-form>' +\r\n\t\t\t'   <p>You must provide a reason (5-255 chars.) for the '+action.replace(/ish$/,'')+' which will be added to the log entry and appear in the user\\'s banishment history.</p>' +\r\n\t\t\t'   <input type=\"text\" name=\"reason\" placeholder=\"Enter a reason\" required pattern=\"^.{5,255}$\">' +\r\n\t\t\t'</form>'+\r\n\t\t\t(Action === 'Banish' ? '<img src=\"/img/pre-ban.svg\" alt=\"Sad twilight\">':''),\r\n\t\t\taction+'-form',\r\n\t\t\tAction,\r\n\t\t\tfunction(){\r\n\t\t\t\tvar $form = $('#'+action+'-form'),\r\n\t\t\t\t\t$input = $form.find('input');\r\n\t\t\t\t$input.val(Action+'ing because ');\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tvar data = $(this).mkData();\r\n\t\t\t\t\t$.Dialog.wait(title, 'Gathering the Elements of Harmony');\r\n\r\n\t\t\t\t\t$.post(action+'/'+name, data, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (!this.status) return $.Dialog.fail(title,this.message);\r\n\r\n\t\t\t\t\t\tif (action === 'banish') $.Dialog.success(title, '<p>What had to be done, has been done.</p><img src=\"/img/post-ban.svg\">');\r\n\t\t\t\t\t\telse $.Dialog.success(title, this.message);\r\n\r\n\t\t\t\t\t\tHandleNav.reload(function(){\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t},2000);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t);\r\n\t});\r\n});\r\n"],"sourceRoot":"/source/"}