DocReady.push(function(){"use strict";function e(e){if("undefined"==typeof t){var n=$.mk("optgroup").attr("label","Available roles"),i=$.mk("select").attr({name:"minrole",required:!0}).append("<option value='' selected default>Select one</option>");delete l.guest,delete l.ban,$.each(l,function(e,t){n.append($.mk("option").attr("value",e).text(t))}),i.append(n),t=$.mk("form").attr("id","link-editor").append($.mk("label").append("<span>Label (3-35 chars.)</span>",$.mk("input").attr({type:"text",name:"label",maxlength:30,pattern:a.replace("+","{3,40}"),required:!0})),$.mk("label").append("<span>URL (3-255 chars.)</span>",$.mk("input").attr({type:"text",name:"url",maxlength:255,required:!0,pattern:a.replace("+","{3,255}")})),$.mk("label").append("<span>Title (optional, 3-70 chars.)</span>",$.mk("input").attr({type:"text",name:"title",maxlength:255,pattern:a.replace("+","{3,255}")})),$.mk("label").append("<span>Role required to view</span>",i)).on("submit",function(t){t.preventDefault();var n=$(this).serialize();$.Dialog.wait(!1),$.post("/admin/usefullinks/"+(e?"set/"+e:"make"),n,$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void HandleNav.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))})}return t.clone(!0,!0)}var t,n=$(".useful-links").find("ol"),i=$("#sidebar").find(".welcome .links"),a=$.attributifyRegex(window.PRINTABLE_ASCII_REGEX),l=window.ROLES_ASSOC;n.on("click",".edit-link",function(){var t=$(this).closest("[id^=ufl-]").attr("id").substring(4);$.Dialog.wait("Editing link #"+t,"Retrieving link information from server"),$.post("/admin/usefullinks/get/"+t,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var n=this;$.Dialog.request(!1,e(t),"link-editor","Save changes",function(e){e.find("input[name=label]").val(n.label),e.find("input[name=url]").val(n.url),e.find("input[name=title]").val(n.title),e.find("select[name=minrole]").val(n.minrole)})}))}),n.on("click",".delete-link",function(){var e=$(this).closest("[id^=ufl-]"),t=e.attr("id").substring(4);$.Dialog.confirm("Delete link #"+t,"Are you sure you want to delete this link?",function(n){n&&($.Dialog.wait(!1,"Removing link"),$.post("/admin/usefullinks/del/"+t,$.mkAjaxHandler(function(){return this.status?(e.remove(),$("#s-ufl-"+t).remove(),i.is(":empty")&&i.hide(),void $.Dialog.close()):$.Dialog.fail(!1,this.message)})))})}),$("#add-link").on("click",function(){$.Dialog.request("Add a link",e(),"link-editor","Add")});var o=$("#reorder-links");o.on("click",function(){if(o.hasClass("typcn-tick")){$.Dialog.wait("Re-ordering links");var e=[];n.children().each(function(){e.push($(this).find(".typcn-arrow-move").remove().end().attr("id").split("-").pop())}),$.post("/admin/usefullinks/reorder",{list:e.join(",")},$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void HandleNav.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))}else o.removeClass("typcn-arrow-unsorted darkblue").addClass("typcn-tick green").html("Save"),n.addClass("sorting").children().find(".buttons").append('<span class="btn darkblue typcn typcn-arrow-move"></span>'),new Sortable(n.get(0),{ghostClass:"moving",scroll:!0,animation:150,handle:".typcn-arrow-move"})})});
//# sourceMappingURL=admin.min.js.map
