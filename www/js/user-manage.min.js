$(function(){if(null!=typeof window.ROLES){var e=$(window),n=$("#content"),t=window.ROLES,o=n.children("h1"),a=o.text().trim(),i=n.find(".avatar-wrap").children(".badge"),r=o.next(),l=r.children("span").text(),s=$(document.createElement("form")).attr("id","rolemod").html('<select name=newrole required><optgroup label="Possible roles"></optgroup></select>'),g=s.find("optgroup"),h=$("#ban-toggle");$.each(t,function(e,n){g.append("<option value="+e+">"+n+"</option>")}),$("#change-role").on("click",function(){var n="Change group";$.Dialog.request(n,s.clone(),"rolemod","Change",function(){$("#rolemod").on("submit",function(o){o.preventDefault();var s=$(this).serializeArray(),g={};$.each(s,function(e,n){g[n.name]=n.value}),$.Dialog.wait(n,"Moving user to the new group"),$.post("newgroup/"+a,g,function(o){return"object"!=typeof o?console.log(o)&&e.trigger("ajaxerror"):void(o.status?(r.children("span").text(l=t[o.ng]),i.text(o.badge),$.Dialog.close(),h[o.canbebanned?"show":"hide"]()):$.Dialog.fail(n,o.message))})}).find("optgroup").children().filter(function(){return $(this).text()===l}).attr("selected",!0)})}),h.on("click",function(){var n=(h.hasClass("un-banish")?"Un-ban":"Ban")+"ish",t=n.toLowerCase(),o=n+"ning "+a+("banish"==t?" to the moon":"");$.Dialog.request(o,("Banish"===n?"<p>"+n+"ing "+a+" will immediately sign them out<br>of every session and won't allow them to log in again.<br>Please, only do this if it's absolutely necessary.</p>":"<p>"+n+"ing "+a+" will allow them to sign in to the site again.</p>")+"<form id="+t+"-form>   <p>Please provide a reason (5-255 chars.) for the "+t.replace(/ish$/,"")+' which will be<br>added to the log entry and appear in the user\'s ban history.</p>   <input type="text" name="reason" placeholder="Enter a reason" required pattern="^.{5,255}$"></form>'+("Banish"===n?'<img src="/img/ban-before.png" alt="Sad twilight" height=200>':""),t+"-form",n,function(){var i=$("#"+t+"-form"),r=i.find("input");r.val(n+"ing because "),i.on("submit",function(n){n.preventDefault();var i=$(this).serializeArray(),r={};$.each(i,function(e,n){r[n.name]=n.value}),$.Dialog.wait(o,"Gathering the Elements of Harmony"),$.post(t+"/"+a,r,function(n){return"object"!=typeof n?console.log(n)&&e.trigger("ajaxerror"):void(n.status?("banish"===t?$.Dialog.info(o,'<p>What had to be done, has been done.</p><img src="/img/ban-after.png">'):$.Dialog.success(o,n.message,!0),h.toggleClass("un-banish banish typcn-world typcn-weather-night")):$.Dialog.fail(o,n.message))})})})})}});