"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},_createClass=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}!function(){var e=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={linkedIds:new Set(t.props.linkedIds),query:""},console.log(t.state),t.linkedSelect=React.createRef(),t.unlinkedSelect=React.createRef(),t.searchInput=React.createRef(),t.handleLink=t.handleLink.bind(t),t.handleUnlink=t.handleUnlink.bind(t),t.handleSubmit=t.handleSubmit.bind(t),t.handleSearch=t.handleSearch.bind(t),t.handleClearSearch=t.handleClearSearch.bind(t),t}return _inherits(n,React.Component),_createClass(n,[{key:"handleLink",value:function(e){e.preventDefault(),this.handleSelection(this.unlinkedSelect,"add")}},{key:"handleUnlink",value:function(e){e.preventDefault(),this.handleSelection(this.linkedSelect,"delete")}},{key:"handleSelection",value:function(e,n){var a={linkedIds:new Set(this.state.linkedIds)};$(e.current).find(":selected").prop("selected",!1).each(function(e,t){a.linkedIds[n](Number(t.value))}),this.setState(a)}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault();var n=Array.from(this.state.linkedIds).join(",");$.Dialog.wait(!1,"Saving changes"),$.API.put(this.props.endpoint,{ids:n},$.mkAjaxHandler(function(e){if(!e.status)return $.Dialog.fail(!1,e.message);t.props.onSuccess(e)}))}},{key:"handleSearch",value:function(e){this.setQuery(e.target.value.trim())}},{key:"handleClearSearch",value:function(e){e.preventDefault(),this.searchInput.current.value="",this.setQuery("")}},{key:"setQuery",value:function(e){this.setState(_extends({},this.state,{query:e}))}},{key:"render",value:function(){var n=this,e=this.state,r=e.linkedIds,l=e.query,t=this.props,a=t.formId,i=t.groups,c=t.valueKey,s=t.displayKey,o=t.entries,u=Object.keys(i).reduce(function(e,t){return _extends({},e,_defineProperty({},t,[]))},{});o.forEach(function(e){var t=n.props.findGroup(e);u[t].push(e)});var h=[],d=[],p=""!==l,f=function(e){return React.createElement("option",{key:e[c],value:e[c]},e[s])},m=function(e){return 0<e.length?e.map(f):React.createElement("option",{disabled:!0},"(none)")};return $.each(i,function(e,t){var n=[],a=[];u[e].forEach(function(e){p&&-1===e[s].toLowerCase().indexOf(l.toLowerCase())||(r.has(e.id)?n.push(e):a.push(e))}),h.push(React.createElement("optgroup",{key:e,label:t},m(n))),d.push(React.createElement("optgroup",{key:e,label:t},m(a)))}),React.createElement("form",{id:a,onSubmit:this.handleSubmit},React.createElement("div",{className:"split-select-wrap"},React.createElement("div",{className:"filter-input"},React.createElement("input",{ref:this.searchInput,type:"text",placeholder:"Search",onChange:this.handleSearch,spellCheck:!1}),React.createElement("button",{className:"typcn typcn-times red",onClick:this.handleClearSearch,disabled:""===l},"Clear")),React.createElement("div",{className:"split-select"},React.createElement("span",null,"Linked"),React.createElement("select",{ref:this.linkedSelect,name:"listed",multiple:!0},h)),React.createElement("div",{className:"buttons"},React.createElement("button",{className:"typcn typcn-chevron-left green",title:"Link selected",onClick:this.handleLink}),React.createElement("button",{className:"typcn typcn-chevron-right red",title:"Unlink selected",onClick:this.handleUnlink})),React.createElement("div",{className:"split-select"},React.createElement("span",null,"Available"),React.createElement("select",{ref:this.unlinkedSelect,multiple:!0},d))))}}]),n}();window.reactComponents={SplitSelector:e}}();