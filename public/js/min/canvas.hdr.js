"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};
/*!
 * 'hdr2d' Canvas Context
 * Copyright (c) 2012 Brian Reavis, http://thirdroute.com/
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * 'Software'), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
/*!
 * 'hdr2d' Canvas Context
 * Copyright (c) 2012 Brian Reavis, http://thirdroute.com/
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * 'Software'), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
!function(t){var a=function(a){return void 0!==t[a]||("undefined"!=typeof console&&console.log("Warning: 'hdr2d' canvas context not supported ("+a+" needed)"),!1)};if(a("HTMLCanvasElement")&&a("ArrayBuffer")&&a("Float32Array")){t.HDR2D_BLEND_SRC=0,t.HDR2D_BLEND_DST=1,t.HDR2D_BLEND_CLEAR=2,t.HDR2D_BLEND_XOR=3,t.HDR2D_BLEND_OVER=4,t.HDR2D_BLEND_IN=5,t.HDR2D_BLEND_OUT=6,t.HDR2D_BLEND_ATOP=7,t.HDR2D_BLEND_DST_OVER=8,t.HDR2D_BLEND_DST_IN=9,t.HDR2D_BLEND_DST_OUT=10,t.HDR2D_BLEND_DST_ATOP=11,t.HDR2D_BLEND_ADD=12,t.HDR2D_BLEND_SUBTRACT=13,t.HDR2D_BLEND_MULTIPLY=14,t.HDR2D_BLEND_AVERAGE=15,t.HDR2D_BLEND_SCREEN=16,t.HDR2D_BLEND_SOFTLIGHT=17,t.HDR2D_BLEND_HARDLIGHT=18,t.HDR2D_BLEND_OVERLAY=19;var e=document.createElement("canvas");e.width=1,e.height=1;var l,D,i,n,r=e.getContext("2d").getImageData(0,0,1,1),s=function(a,t){this.width=a,this.height=t,this.data=new Float32Array(new ArrayBuffer(a*t*16))},m=(l={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0000ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},D=function(a,t,e){return e<0&&e++,1<e&&e--,6*e<1?a+(t-a)*e*6:2*e<1?t:3*e<2?a+(t-a)*(2/3-e)*6:a},function(a){if(a=a.replace(/^\s\s*/,"").replace(/\s*\s$/,"").toLowerCase(),l.hasOwnProperty(a)&&(a="#"+l[a]),"#"===a.charAt(0))return 4===a.length&&(a=["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3)].join("")),{r:parseInt(a.substring(1,3),16),g:parseInt(a.substring(3,5),16),b:parseInt(a.substring(5,7),16),a:255};var t=a.indexOf("("),e=a.indexOf(")",t),i=a.substring(0,t).replace(/\s/g,""),n=a.substring(t+1,e).split(","),h=3<n.length?255*parseFloat(n[3]):255;switch(i){case"rgb":case"rgba":return{r:parseFloat(n[0]),g:parseFloat(n[1]),b:parseFloat(n[2]),a:h};case"hsl":case"hsla":var o=parseFloat(n[0])/360,r=parseFloat(n[1])/100,d=parseFloat(n[2])/100,f=d<=.5?d*(r+1):d+r-d*r,g=2*d-f;return{r:255*D(g,f,o+1/3),g:255*D(g,f,o),b:255*D(g,f,o-1/3),a:h}}return{r:0,g:0,b:0,a:0}}),h=function(a){this.canvas=a,this.initialize()};h.prototype.fillStyle="#000000",h.prototype.globalAlpha=1,h.prototype.globalBlendMode=HDR2D_BLEND_OVER,h.prototype.range={r:{low:0,high:255},g:{low:0,high:255},b:{low:0,high:255},a:{low:0,high:255}},h.prototype.getBlendFunction=((i={})[HDR2D_BLEND_SRC]={component:function(a,t,e){return a*e},alpha:function(a){return a}},i[HDR2D_BLEND_DST]={component:function(a,t,e,i){return t*i},alpha:function(a,t){return t}},i[HDR2D_BLEND_CLEAR]={component:function(){return 0},alpha:function(){return 0}},i[HDR2D_BLEND_XOR]={component:function(a,t,e,i){return a*e*(1-i)+t*i*(1-e)},alpha:function(a,t){return a+t-2*a*t}},i[HDR2D_BLEND_OVER]={component:function(a,t,e,i){return a*e+t*i*(1-e)},alpha:function(a,t){return a+t-a*t}},i[HDR2D_BLEND_IN]={component:function(a,t,e,i){return a*e*i},alpha:function(a,t){return a*t}},i[HDR2D_BLEND_OUT]={component:function(a,t,e,i){return a*e*(1-i)},alpha:function(a,t){return a*(1-t)}},i[HDR2D_BLEND_ATOP]={component:function(a,t,e,i){return a*e*i+t*i*(1-e)},alpha:function(a,t){return t}},i[HDR2D_BLEND_DST_OVER]={component:function(a,t,e,i){return t*i+a*e*(1-i)},alpha:function(a,t){return a+t-a*t}},i[HDR2D_BLEND_DST_IN]={component:function(a,t,e,i){return t*i*e},alpha:function(a,t){return a*t}},i[HDR2D_BLEND_DST_OUT]={component:function(a,t,e,i){return t*i*(1-e)},alpha:function(a,t){return t*(1-a)}},i[HDR2D_BLEND_DST_ATOP]={component:function(a,t,e,i){return t*i*e+a*e*(1-i)},alpha:function(a){return a}},i[HDR2D_BLEND_ADD]={component:function(a,t,e,i){return t*i+a*e},alpha:i[HDR2D_BLEND_OVER].alpha},i[HDR2D_BLEND_SUBTRACT]={component:function(a,t,e,i){return t*i-a*e},alpha:i[HDR2D_BLEND_OVER].alpha},i[HDR2D_BLEND_MULTIPLY]={component:function(a,t,e,i){return a*t/255*e+t*i*(1-e)},alpha:i[HDR2D_BLEND_OVER].alpha},i[HDR2D_BLEND_AVERAGE]={component:function(a,t,e,i){return(a+t)/2*e+t*i*(1-e)},alpha:i[HDR2D_BLEND_OVER].alpha},i[HDR2D_BLEND_SCREEN]={component:function(a,t,e,i){return(255-(Math.round((255-a)*(255-t))>>8))*e+t*i*(1-e)},alpha:i[HDR2D_BLEND_OVER].alpha},i[HDR2D_BLEND_OVERLAY]={component:function(a,t,e,i){return(128<a?2*t*a/255:255-2*(255-t)*(255-a)/255)*e+t*i*(1-e)},alpha:i[HDR2D_BLEND_OVER].alpha},i[HDR2D_BLEND_SOFTLIGHT]={component:function(a,t,e,i){return(t<128?2*(64+(Math.round(a)>>1))*(t/255):255-2*(255-(64+(Math.round(a)>>1)))*(255-t)/255)*e+t*i*(1-e)},alpha:i[HDR2D_BLEND_OVER].alpha},i[HDR2D_BLEND_HARDLIGHT]={component:function(a,t,e,i){return(a<128?2*t*a/255:255-2*(255-t)*(255-a)/255)*e+t*i*(1-e)},alpha:i[HDR2D_BLEND_OVER].alpha},function(a){return i[a]}),h.prototype.initialize=function(){this._context=this.canvas.getContext("2d");try{this.getThatImageData()}catch(a){}this.imageData=new s(this.canvas.width,this.canvas.height)},h.prototype.getThatImageData=function(){this._imageData=this._context.getImageData(0,0,this.canvas.width,this.canvas.height)},h.prototype.clearRect=function(a,t,e,i){var n=void 0,h=void 0,o=void 0,r=Math.max(0,Math.min(this.imageData.width,a)),d=Math.max(0,Math.min(this.imageData.height,t)),f=Math.max(0,Math.min(this.imageData.width,a+e)),g=Math.max(0,Math.min(this.imageData.height,t+i));for(h=d;h<g;h++)for(o=r;o<f;o++)n=4*(h*this.imageData.width+o),this.imageData.data[n]=0,this.imageData.data[n+1]=0,this.imageData.data[n+2]=0,this.imageData.data[n+3]=0;this.invalidate(r,d,f-r,g-d)},h.prototype.fillRect=function(a,t,e,i){"object"!==_typeof(this.fillStyle)&&(this.fillStyle=m(this.fillStyle));var n=void 0,h=void 0,o=void 0,r=Math.max(0,Math.min(this.imageData.width,a)),d=Math.max(0,Math.min(this.imageData.height,t)),f=Math.max(0,Math.min(this.imageData.width,a+e)),g=Math.max(0,Math.min(this.imageData.height,t+i)),l=this.getBlendFunction(this.globalBlendMode);for(h=d;h<g;h++)for(o=r;o<f;o++){n=4*(h*this.imageData.width+o);var D=this.imageData.data[n+3]/255,s=this.fillStyle.a*this.globalAlpha/255;this.imageData.data[n]=l.component(this.fillStyle.r,this.imageData.data[n],s,D),this.imageData.data[n+1]=l.component(this.fillStyle.g,this.imageData.data[n+1],s,D),this.imageData.data[n+2]=l.component(this.fillStyle.b,this.imageData.data[n+2],s,D),this.imageData.data[n+3]=255*l.alpha(s,D)}this.invalidate(r,d,f-r,g-d)},h.prototype.setPixel=function(a,t,e){var i=4*(Math.round(a)+Math.round(t)*this.imageData.width),n=this.getBlendFunction(this.globalBlendMode);void 0===e.a&&(e.a=255);var h=this.imageData.data[i+3]/255,o=e.a*this.globalAlpha/255;this.imageData.data[i]=n.component(e.r,this.imageData.data[i],o,h),this.imageData.data[i+1]=n.component(e.g,this.imageData.data[i+1],o,h),this.imageData.data[i+2]=n.component(e.b,this.imageData.data[i+2],o,h),this.imageData.data[i+3]=255*n.alpha(o,h),this._imageData.data[i]=r.data[0]=(this.imageData.data[i]-this.range.r.low)/(this.range.r.high-this.range.r.low)*255,this._imageData.data[i+1]=r.data[1]=(this.imageData.data[i+1]-this.range.g.low)/(this.range.g.high-this.range.g.low)*255,this._imageData.data[i+2]=r.data[2]=(this.imageData.data[i+2]-this.range.b.low)/(this.range.b.high-this.range.b.low)*255,this._imageData.data[i+3]=r.data[3]=(this.imageData.data[i+3]-this.range.a.low)/(this.range.a.high-this.range.a.low)*255,this._context.putImageData(r,a,t,0,0,1,1)},h.prototype.getPixel=function(a,t){var e=4*(Math.round(a)+Math.round(t)*this.imageData.width);return{r:this.imageData.data[e],g:this.imageData.data[e+1],b:this.imageData.data[e+2],a:this.imageData.data[e+3]}},h.prototype.getImageData=function(a,t,e,i){if(0===a&&0===t&&e===this.imageData.width&&i===this.imageData.height)return this.imageData;var n=Math.min(e,this.imageData.width-a),h=Math.min(i,this.imageData.height-t),o=a+n,r=t+h,d=new s(n,h),f=void 0,g=void 0,l=void 0,D=0;for(g=t;g<r;g++)for(f=a;f<o;f++)l=4*(g*this.imageData.width+f),d.data[D++]=this.imageData.data[l],d.data[D++]=this.imageData.data[l+1],d.data[D++]=this.imageData.data[l+2],d.data[D++]=this.imageData.data[l+3];return d},h.prototype.setRange=function(a){var t=!1;"object"!==_typeof(a.r)||$.compareFaL(this.range.r,a.r)||(this.range.r=a.r,t=!0),"object"!==_typeof(a.g)||$.compareFaL(this.range.g,a.g)||(this.range.g=a.g,t=!0),"object"!==_typeof(a.b)||$.compareFaL(this.range.b,a.b)||(this.range.b=a.b,t=!0),"object"!==_typeof(a.a)||$.compareFaL(this.range.a,a.a)||(this.range.a=a.a,t=!0),t&&this.invalidate()},h.prototype.drawImage=function(a,t,e,i,n){var h=arguments,o=a.width,r=a.height;5<arguments.length&&(o=h[3],r=h[4],t=h[5],e=h[6],i=h[7],n=h[8]),t=t||0,e=e||0,i=i||o,n=n||r;var d=document.createElement("canvas");d.width=this.imageData.width,d.height=this.imageData.height;var f=d.getContext("2d");f.globalAlpha=1,f.drawImage.apply(f,h);var g=void 0,l=void 0,D=void 0,s=void 0,m=void 0,c=this.getBlendFunction(this.globalBlendMode),u=f.getImageData(0,0,this.imageData.width,this.imageData.height).data,p=Math.max(0,Math.floor(t)),_=Math.max(0,Math.floor(e)),b=Math.min(this.imageData.width,Math.ceil(t+i)),y=Math.min(this.imageData.height,Math.ceil(e+n));for(D=_;D<y;D++)for(l=p;l<b;l++)g=4*(D*this.imageData.width+l),m=this.imageData.data[g+3]/255,s=u[g+3]*this.globalAlpha/255,this.imageData.data[g]=c.component(u[g],this.imageData.data[g],s,m),this.imageData.data[g+1]=c.component(u[g+1],this.imageData.data[g+1],s,m),this.imageData.data[g+2]=c.component(u[g+2],this.imageData.data[g+2],s,m),this.imageData.data[g+3]=255*c.alpha(s,m);this.invalidate(p,_,b-p,y-_)},h.prototype.invalidate=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.imageData.width,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this.imageData.height,n=[this.range.r,this.range.g,this.range.b,this.range.a];if(0===a&&0===t&&e===this.imageData.width&&i===this.imageData.height)for(var h=0,o=this.imageData.data.length;h<o;h++){var r=n[h%4];this._imageData.data[h]=(this.imageData.data[h]-r.low)/(r.high-r.low)*255}else for(var d=Math.min(a+e,this.imageData.width),f=Math.min(t+i,this.imageData.height),g=t;g<f;g++)for(var l=a;l<d;l++){var D=4*(g*this.imageData.width+l);this._imageData.data[D]=(this.imageData.data[D]-n[0].low)/(n[0].high-n[0].low)*255,this._imageData.data[D+1]=(this.imageData.data[D+1]-n[1].low)/(n[1].high-n[1].low)*255,this._imageData.data[D+2]=(this.imageData.data[D+2]-n[2].low)/(n[2].high-n[2].low)*255,this._imageData.data[D+3]=(this.imageData.data[D+3]-n[3].low)/(n[3].high-n[3].low)*255}this._context.putImageData(this._imageData,0,0)},t.ImageDataHDR=s,t.CanvasRenderingContextHDR2D=h,HTMLCanvasElement.prototype.getContext=(n=HTMLCanvasElement.prototype.getContext,function(){return"hdr2d"===arguments[0]?(void 0===this.__hdr2ctx&&(this.__hdr2ctx=new h(this)),this.__hdr2ctx):n.apply(this,arguments)})}}(window);