"use strict";!function(u){var d=u.mk("div").attr("id","ctxmenu");function i(t,e){return"function"==typeof e&&(e=e(t)),t.data("ctxmenu-items")instanceof jQuery?e&&t.data("ctxmenu-items").children().first().text(e):t.data("ctxmenu-items",(new jQuery).add(u.mk("li").text(e||"Context menu"))),t}function c(e,n){if(e){var t=u.mk("li");if(e===u.ctxmenu.separator)t.addClass("sep");else{var a=u.mk("a");e.text&&a.text(e.text),e.icon&&a.addClass("typcn typcn-"+e.icon),!0===e.default&&a.addClass("default"),void 0!==e.attr&&("string"==typeof e.attr?a.attr(e.attr,!0):a.attr(e.attr)),"function"==typeof e.click&&a.on("click",function(t){t.stopPropagation(),t.preventDefault(),e.click.call(n.get(0),t),d.hide()}),a.appendTo(t)}n.data("ctxmenu-items",n.data("ctxmenu-items").add(t))}}d.appendTo($body).on("click",function(t){t.stopPropagation(),d.hide()}).on("contextmenu",function(t){var e=u(t.target);switch(t.target.nodeName.toLowerCase()){case"li":e.children("a").trigger("click");break;case"a":e.trigger("click")}return!1}),u.ctxmenu={separator:!0},u.ctxmenu.setTitle=function(){return i.apply(this,arguments)},u.fn.ctxmenu=function(t,e){return u(this).each(function(){var r=u(this);i(r,e),u.each(t,function(t,e){c(e,r)}),r.on("contextmenu",function(t){if(!t.shiftKey){t.preventDefault(),t.stopPropagation(),r.trigger("mouseleave"),d.html(r.data("ctxmenu-items").clone(!0,!0)).css({top:t.pageY,left:t.pageX,opacity:0}).show();var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),a=u(document).scrollTop(),i=d.position(),c=(i.top>n+a||i.top>n-a)&&t.pageY-d.outerHeight(),o=(i.left<0-d.width()||i.left>e)&&t.pageX-d.outerWidth();!1!==c&&d.css("top",c),!1!==o&&d.css("left",o),d.css("opacity",1)}}).addClass("ctxmenu-bound")})},u.ctxmenu.addItem=u.ctxmenu.addItems=function(t){var e=arguments.length;if(e<2)throw new Error("Invalid number of arguments ("+e+") for $.ctxmenu.addItems");var a=u.toArray(arguments);a.splice(0,1),t.each(function(){var n=u(this);if(void 0===n.data("ctxmenu-items"))return n.ctxmenu(a);i(n),u.each(a,function(t,e){return c(e,n)})})},u.ctxmenu.triggerItem=function(t,e){var n=t.data("ctxmenu-items").filter(":not(.sep)");if(e<1||n.length-1<e)throw new Error("There's no such menu option: "+e);n.eq(e).children("a").triggerHandler("click")},u.ctxmenu.setDefault=function(t,e){var n=t.data("ctxmenu-items").filter(":not(.sep)");n.find("a").removeClass("default"),n.eq(e).children("a").addClass("default")},u.ctxmenu.runDefault=function(t){return t.data("ctxmenu-items").find("a.default").trigger("click")},$body.on("click contextmenu",function(){d.hide()}),$w.on("blur resize",function(){d.hide()})}(jQuery);