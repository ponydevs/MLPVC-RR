"use strict";!function(){var a=$("#sort-by"),i=$("#full-list"),n=$("#guide-reorder"),t=$("#guide-reorder-cancel"),s=!!window.EQG;a.on("change",function(){var e=a.data("base-url"),r=a.val(),t=e+"?ajax&sort_by="+r;$.Dialog.wait("Changing sort order"),$.get(t,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);i.html(this.html),l(),n.prop("disabled",0<r.length),history.replaceState(history.state,"",this.stateUrl),$.Dialog.close()}))});var o=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){var r=e.target;o.unobserve(r);var t=new Image;t.src=r.dataset.src,$(t).on("load",function(){r.classList.contains("border")&&t.classList.add("border"),$(r).replaceWith(t).css("opacity",0).animate({opacity:1},300)})}})});function l(){i.find("section > ul .image-promise").each(function(e,r){return o.observe(r)})}l(),window.Sortable&&(i.on("click",".sort-alpha",function(){var e=$(this).closest("section").children("ul");e.children().sort(function(e,r){return $(e).text().trim().localeCompare($(r).text().trim())}).appendTo(e)}),n.on("click",function(){if(n.hasClass("typcn-tick")){$.Dialog.wait("Re-ordering appearances");var e=[];i.children().children("ul").children().each(function(){e.push($(this).children().attr("data-href").split("/").pop().replace(/^(\d+)\D.*$/,"$1"))});var r={list:e.join(","),ordering:a.val()};s&&(r.eqg=!0),$.API.post("/cg/full/reorder",r,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);i.removeClass("sorting").html(this.html),l(),n.removeClass("typcn-tick green").addClass("typcn-arrow-unsorted darkblue").html("Re-order"),t.addClass("hidden"),$.Dialog.close()}))}else n.removeClass("typcn-arrow-unsorted darkblue").addClass("typcn-tick green").html("Save"),i.addClass("sorting").children().each(function(){var e=$(this).children("ul");e.children().each(function(){var e=$(this);e.data("orig-index",e.index())}).children().moveAttr("href","data-href"),e.sortable({draggable:"li"})}),$(".sort-alpha").add(t).removeClass("hidden")}),t.on("click",function(){n.removeClass("typcn-tick green").addClass("typcn-arrow-unsorted darkblue").html("Re-order"),i.removeClass("sorting").children().each(function(){var e=$(this).children("ul");e.children().sort(function(e,r){return e=$(e).data("orig-index"),(r=$(r).data("orig-index"))<e?1:e<r?-1:0}).appendTo(e).removeData("orig-index").children().moveAttr("data-href","href"),e.sortable("destroy")}),$(".sort-alpha").add(t).addClass("hidden")}))}();